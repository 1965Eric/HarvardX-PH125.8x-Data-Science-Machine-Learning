<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Section 4 - Distance, Knn, Cross Validation, and Generative Models | Data Science Machine Learning</title>
  <meta name="description" content="5 Section 4 - Distance, Knn, Cross Validation, and Generative Models | Data Science Machine Learning" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Section 4 - Distance, Knn, Cross Validation, and Generative Models | Data Science Machine Learning" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Section 4 - Distance, Knn, Cross Validation, and Generative Models | Data Science Machine Learning" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"/>
<link rel="next" href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="learning-objectives.html"><a href="learning-objectives.html"><i class="fa fa-check"></i><b>1</b> Learning Objectives</a>
<ul>
<li class="chapter" data-level="1.1" data-path="learning-objectives.html"><a href="learning-objectives.html#course-overview"><i class="fa fa-check"></i><b>1.1</b> Course Overview</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="learning-objectives.html"><a href="learning-objectives.html#introduction-to-machine-learning"><i class="fa fa-check"></i><b>1.1.1</b> Introduction to Machine Learning</a></li>
<li class="chapter" data-level="1.1.2" data-path="learning-objectives.html"><a href="learning-objectives.html#machine-learning-basics"><i class="fa fa-check"></i><b>1.1.2</b> Machine Learning Basics</a></li>
<li class="chapter" data-level="1.1.3" data-path="learning-objectives.html"><a href="learning-objectives.html#linear-regression-for-prediction-smoothing-and-working-with-matrices"><i class="fa fa-check"></i><b>1.1.3</b> Linear Regression for Prediction, Smoothing, and Working with Matrices</a></li>
<li class="chapter" data-level="1.1.4" data-path="learning-objectives.html"><a href="learning-objectives.html#distance-knn-cross-validation-and-generative-models"><i class="fa fa-check"></i><b>1.1.4</b> Distance, Knn, Cross Validation, and Generative Models</a></li>
<li class="chapter" data-level="1.1.5" data-path="learning-objectives.html"><a href="learning-objectives.html#classification-with-more-than-two-classes-and-the-caret-package"><i class="fa fa-check"></i><b>1.1.5</b> Classification with More than Two Classes and the Caret Package</a></li>
<li class="chapter" data-level="1.1.6" data-path="learning-objectives.html"><a href="learning-objectives.html#model-fitting-and-recommendation-systems"><i class="fa fa-check"></i><b>1.1.6</b> Model Fitting and Recommendation Systems</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="section-1-introduction-to-machine-learning-overview.html"><a href="section-1-introduction-to-machine-learning-overview.html"><i class="fa fa-check"></i><b>2</b> Section 1 - Introduction to Machine Learning Overview</a>
<ul>
<li class="chapter" data-level="2.1" data-path="section-1-introduction-to-machine-learning-overview.html"><a href="section-1-introduction-to-machine-learning-overview.html#notation"><i class="fa fa-check"></i><b>2.1</b> Notation</a></li>
<li class="chapter" data-level="2.2" data-path="section-1-introduction-to-machine-learning-overview.html"><a href="section-1-introduction-to-machine-learning-overview.html#an-example"><i class="fa fa-check"></i><b>2.2</b> An Example</a></li>
<li class="chapter" data-level="2.3" data-path="section-1-introduction-to-machine-learning-overview.html"><a href="section-1-introduction-to-machine-learning-overview.html#comprehension-check---introduction-to-machine-learning"><i class="fa fa-check"></i><b>2.3</b> Comprehension Check - Introduction to Machine Learning</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="section-2-machine-learning-basics-overview.html"><a href="section-2-machine-learning-basics-overview.html"><i class="fa fa-check"></i><b>3</b> Section 2 - Machine Learning Basics Overview</a>
<ul>
<li class="chapter" data-level="3.1" data-path="section-2-machine-learning-basics-overview.html"><a href="section-2-machine-learning-basics-overview.html#caret-package-training-and-test-sets-and-overall-accuracy"><i class="fa fa-check"></i><b>3.1</b> Caret package, training and test sets, and overall accuracy</a></li>
<li class="chapter" data-level="3.2" data-path="section-2-machine-learning-basics-overview.html"><a href="section-2-machine-learning-basics-overview.html#comprehension-check---basics-of-evaluating-machine-learning-algorithms"><i class="fa fa-check"></i><b>3.2</b> Comprehension Check - Basics of Evaluating Machine Learning Algorithms</a></li>
<li class="chapter" data-level="3.3" data-path="section-2-machine-learning-basics-overview.html"><a href="section-2-machine-learning-basics-overview.html#confusion-matrix"><i class="fa fa-check"></i><b>3.3</b> Confusion matrix</a></li>
<li class="chapter" data-level="3.4" data-path="section-2-machine-learning-basics-overview.html"><a href="section-2-machine-learning-basics-overview.html#balanced-accuracy-and-f1-score"><i class="fa fa-check"></i><b>3.4</b> Balanced accuracy and F1 score</a></li>
<li class="chapter" data-level="3.5" data-path="section-2-machine-learning-basics-overview.html"><a href="section-2-machine-learning-basics-overview.html#prevalence-matters-in-practice"><i class="fa fa-check"></i><b>3.5</b> Prevalence matters in practice</a></li>
<li class="chapter" data-level="3.6" data-path="section-2-machine-learning-basics-overview.html"><a href="section-2-machine-learning-basics-overview.html#roc-and-precision-recall-curves"><i class="fa fa-check"></i><b>3.6</b> ROC and precision-recall curves</a></li>
<li class="chapter" data-level="3.7" data-path="section-2-machine-learning-basics-overview.html"><a href="section-2-machine-learning-basics-overview.html#comprehension-check---practice-with-machine-learning-part-1"><i class="fa fa-check"></i><b>3.7</b> Comprehension Check - Practice with Machine Learning, Part 1</a></li>
<li class="chapter" data-level="3.8" data-path="section-2-machine-learning-basics-overview.html"><a href="section-2-machine-learning-basics-overview.html#comprehension-check---practice-with-machine-learning-part-2"><i class="fa fa-check"></i><b>3.8</b> Comprehension Check - Practice with Machine Learning, Part 2</a></li>
<li class="chapter" data-level="3.9" data-path="section-2-machine-learning-basics-overview.html"><a href="section-2-machine-learning-basics-overview.html#conditional-probabilities"><i class="fa fa-check"></i><b>3.9</b> Conditional probabilities</a></li>
<li class="chapter" data-level="3.10" data-path="section-2-machine-learning-basics-overview.html"><a href="section-2-machine-learning-basics-overview.html#conditional-expectations-and-loss-function"><i class="fa fa-check"></i><b>3.10</b> Conditional expectations and loss function</a></li>
<li class="chapter" data-level="3.11" data-path="section-2-machine-learning-basics-overview.html"><a href="section-2-machine-learning-basics-overview.html#comprehension-check---conditional-probabilities-part-1"><i class="fa fa-check"></i><b>3.11</b> Comprehension Check - Conditional Probabilities, Part 1</a></li>
<li class="chapter" data-level="3.12" data-path="section-2-machine-learning-basics-overview.html"><a href="section-2-machine-learning-basics-overview.html#comprehension-check---conditional-probabilities-part-2"><i class="fa fa-check"></i><b>3.12</b> Comprehension Check - Conditional Probabilities, Part 2</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><i class="fa fa-check"></i><b>4</b> Section 3 - Linear Regression for Prediction, Smoothing, and Working with Matrices Overview</a>
<ul>
<li class="chapter" data-level="4.1" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#linear-regression-for-prediction"><i class="fa fa-check"></i><b>4.1</b> Linear Regression for Prediction</a></li>
<li class="chapter" data-level="4.2" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#predict-function"><i class="fa fa-check"></i><b>4.2</b> Predict Function</a></li>
<li class="chapter" data-level="4.3" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#comprehension-check---linear-regression"><i class="fa fa-check"></i><b>4.3</b> Comprehension Check - Linear Regression</a></li>
<li class="chapter" data-level="4.4" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#regression-for-a-categorical-outcome"><i class="fa fa-check"></i><b>4.4</b> Regression for a Categorical Outcome</a></li>
<li class="chapter" data-level="4.5" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#logistic-regression"><i class="fa fa-check"></i><b>4.5</b> Logistic Regression</a></li>
<li class="chapter" data-level="4.6" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#case-study-2-or-7"><i class="fa fa-check"></i><b>4.6</b> Case Study: 2 or 7</a></li>
<li class="chapter" data-level="4.7" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#comprehension-check---logistic-regression"><i class="fa fa-check"></i><b>4.7</b> Comprehension Check - Logistic Regression</a></li>
<li class="chapter" data-level="4.8" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#introduction-to-smoothing"><i class="fa fa-check"></i><b>4.8</b> Introduction to Smoothing</a></li>
<li class="chapter" data-level="4.9" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#bin-smoothing-and-kernels"><i class="fa fa-check"></i><b>4.9</b> Bin Smoothing and Kernels</a></li>
<li class="chapter" data-level="4.10" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#local-weighted-regression-loess"><i class="fa fa-check"></i><b>4.10</b> Local Weighted Regression (loess)</a></li>
<li class="chapter" data-level="4.11" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#comprehension-check---smoothing"><i class="fa fa-check"></i><b>4.11</b> Comprehension Check - Smoothing</a></li>
<li class="chapter" data-level="4.12" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#matrices"><i class="fa fa-check"></i><b>4.12</b> Matrices</a></li>
<li class="chapter" data-level="4.13" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#matrix-notation"><i class="fa fa-check"></i><b>4.13</b> Matrix Notation</a></li>
<li class="chapter" data-level="4.14" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#converting-a-vector-to-a-matrix"><i class="fa fa-check"></i><b>4.14</b> Converting a Vector to a Matrix</a></li>
<li class="chapter" data-level="4.15" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#row-and-column-summaries-and-apply"><i class="fa fa-check"></i><b>4.15</b> Row and Column Summaries and Apply</a></li>
<li class="chapter" data-level="4.16" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#filtering-columns-based-on-summaries"><i class="fa fa-check"></i><b>4.16</b> Filtering Columns Based on Summaries</a></li>
<li class="chapter" data-level="4.17" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#indexing-with-matrices-and-binarizing-the-data"><i class="fa fa-check"></i><b>4.17</b> Indexing with Matrices and Binarizing the Data</a></li>
<li class="chapter" data-level="4.18" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#vectorization-for-matrices-and-matrix-algebra-operations"><i class="fa fa-check"></i><b>4.18</b> Vectorization for Matrices and Matrix Algebra Operations</a></li>
<li class="chapter" data-level="4.19" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#comprehension-check---working-with-matrices"><i class="fa fa-check"></i><b>4.19</b> Comprehension Check - Working with Matrices</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html"><i class="fa fa-check"></i><b>5</b> Section 4 - Distance, Knn, Cross Validation, and Generative Models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#distance"><i class="fa fa-check"></i><b>5.1</b> Distance</a></li>
<li class="chapter" data-level="5.2" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#comprehension-check---distance"><i class="fa fa-check"></i><b>5.2</b> Comprehension Check - Distance</a></li>
<li class="chapter" data-level="5.3" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#knn"><i class="fa fa-check"></i><b>5.3</b> Knn</a></li>
<li class="chapter" data-level="5.4" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#over-training-and-over-smoothing"><i class="fa fa-check"></i><b>5.4</b> Over-training and Over-smoothing</a></li>
<li class="chapter" data-level="5.5" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#comprehension-check---nearest-neighbors"><i class="fa fa-check"></i><b>5.5</b> Comprehension Check - Nearest Neighbors</a></li>
<li class="chapter" data-level="5.6" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#k-fold-cross-validation"><i class="fa fa-check"></i><b>5.6</b> K-fold cross validation</a></li>
<li class="chapter" data-level="5.7" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#comprehension-check---cross-validation"><i class="fa fa-check"></i><b>5.7</b> Comprehension Check - Cross-validation</a></li>
<li class="chapter" data-level="5.8" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#bootstrap"><i class="fa fa-check"></i><b>5.8</b> Bootstrap</a></li>
<li class="chapter" data-level="5.9" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#comprehension-check---bootstrap"><i class="fa fa-check"></i><b>5.9</b> Comprehension Check - Bootstrap</a></li>
<li class="chapter" data-level="5.10" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#generative-models"><i class="fa fa-check"></i><b>5.10</b> Generative Models</a></li>
<li class="chapter" data-level="5.11" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#naive-bayes"><i class="fa fa-check"></i><b>5.11</b> Naive Bayes</a></li>
<li class="chapter" data-level="5.12" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#controlling-prevalence"><i class="fa fa-check"></i><b>5.12</b> Controlling Prevalence</a></li>
<li class="chapter" data-level="5.13" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#qda-and-lda"><i class="fa fa-check"></i><b>5.13</b> qda and lda</a></li>
<li class="chapter" data-level="5.14" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#case-study---more-than-three-classes"><i class="fa fa-check"></i><b>5.14</b> Case Study - More than Three Classes</a></li>
<li class="chapter" data-level="5.15" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#comprehension-check---generative-models"><i class="fa fa-check"></i><b>5.15</b> Comprehension Check - Generative Models</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="section-5-classification-with-more-than-two-classes-and-the-caret-package.html"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html"><i class="fa fa-check"></i><b>6</b> Section 5 - Classification with More than Two Classes and the Caret Package</a>
<ul>
<li class="chapter" data-level="6.1" data-path="section-5-classification-with-more-than-two-classes-and-the-caret-package.html"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#trees-motivation"><i class="fa fa-check"></i><b>6.1</b> Trees Motivation</a></li>
<li class="chapter" data-level="6.2" data-path="section-5-classification-with-more-than-two-classes-and-the-caret-package.html"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#classification-and-regression-trees-cart"><i class="fa fa-check"></i><b>6.2</b> Classification and Regression Trees (CART)</a></li>
<li class="chapter" data-level="6.3" data-path="section-5-classification-with-more-than-two-classes-and-the-caret-package.html"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#classification-decision-trees"><i class="fa fa-check"></i><b>6.3</b> Classification (Decision) Trees</a></li>
<li class="chapter" data-level="6.4" data-path="section-5-classification-with-more-than-two-classes-and-the-caret-package.html"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#random-forests"><i class="fa fa-check"></i><b>6.4</b> Random Forests</a></li>
<li class="chapter" data-level="6.5" data-path="section-5-classification-with-more-than-two-classes-and-the-caret-package.html"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#comprehension-check---trees-and-random-forests"><i class="fa fa-check"></i><b>6.5</b> Comprehension Check - Trees and Random Forests</a></li>
<li class="chapter" data-level="6.6" data-path="section-5-classification-with-more-than-two-classes-and-the-caret-package.html"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#caret-package"><i class="fa fa-check"></i><b>6.6</b> Caret Package</a></li>
<li class="chapter" data-level="6.7" data-path="section-5-classification-with-more-than-two-classes-and-the-caret-package.html"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#tuning-parameters-with-caret"><i class="fa fa-check"></i><b>6.7</b> Tuning Parameters with Caret</a></li>
<li class="chapter" data-level="6.8" data-path="section-5-classification-with-more-than-two-classes-and-the-caret-package.html"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#comprehension-check---caret-package"><i class="fa fa-check"></i><b>6.8</b> Comprehension Check - Caret Package</a></li>
<li class="chapter" data-level="6.9" data-path="section-5-classification-with-more-than-two-classes-and-the-caret-package.html"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#titanic-exercises---part-1"><i class="fa fa-check"></i><b>6.9</b> Titanic Exercises - Part 1</a></li>
<li class="chapter" data-level="6.10" data-path="section-5-classification-with-more-than-two-classes-and-the-caret-package.html"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#titanic-exercises---part-2"><i class="fa fa-check"></i><b>6.10</b> Titanic Exercises - Part 2</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html"><i class="fa fa-check"></i><b>7</b> Section 6 - Model Fitting and Recommendation Systems Overview</a>
<ul>
<li class="chapter" data-level="7.1" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#case-study-mnist"><i class="fa fa-check"></i><b>7.1</b> Case Study: MNIST</a></li>
<li class="chapter" data-level="7.2" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#preprocessing-mnist-data"><i class="fa fa-check"></i><b>7.2</b> Preprocessing MNIST Data</a></li>
<li class="chapter" data-level="7.3" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#model-fitting-for-mnist-data"><i class="fa fa-check"></i><b>7.3</b> Model Fitting for MNIST Data</a></li>
<li class="chapter" data-level="7.4" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#variable-importance"><i class="fa fa-check"></i><b>7.4</b> Variable Importance</a></li>
<li class="chapter" data-level="7.5" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#ensembles"><i class="fa fa-check"></i><b>7.5</b> Ensembles</a></li>
<li class="chapter" data-level="7.6" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#comprehension-check---ensembles"><i class="fa fa-check"></i><b>7.6</b> Comprehension Check - Ensembles</a></li>
<li class="chapter" data-level="7.7" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#recommendation-systems"><i class="fa fa-check"></i><b>7.7</b> Recommendation Systems</a></li>
<li class="chapter" data-level="7.8" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#building-the-recommendation-system"><i class="fa fa-check"></i><b>7.8</b> Building the Recommendation System</a></li>
<li class="chapter" data-level="7.9" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#comprehension-check---recommendation-systems"><i class="fa fa-check"></i><b>7.9</b> Comprehension Check - Recommendation Systems</a></li>
<li class="chapter" data-level="7.10" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#regularization"><i class="fa fa-check"></i><b>7.10</b> Regularization</a></li>
<li class="chapter" data-level="7.11" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#comprehension-check---regularization"><i class="fa fa-check"></i><b>7.11</b> Comprehension Check - Regularization</a></li>
<li class="chapter" data-level="7.12" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#matrix-factorization"><i class="fa fa-check"></i><b>7.12</b> Matrix Factorization</a></li>
<li class="chapter" data-level="7.13" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#svd-and-pca"><i class="fa fa-check"></i><b>7.13</b> SVD and PCA</a></li>
<li class="chapter" data-level="7.14" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#comprehension-check---matrix-factorization"><i class="fa fa-check"></i><b>7.14</b> Comprehension Check - Matrix Factorization</a></li>
<li class="chapter" data-level="7.15" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#comprehension-check---dimension-reduction"><i class="fa fa-check"></i><b>7.15</b> Comprehension Check - Dimension Reduction</a></li>
<li class="chapter" data-level="7.16" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#comprehension-check---clustering"><i class="fa fa-check"></i><b>7.16</b> Comprehension Check - Clustering</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="section-7-final-assessment.html"><a href="section-7-final-assessment.html"><i class="fa fa-check"></i><b>8</b> Section 7 - Final Assessment</a>
<ul>
<li class="chapter" data-level="8.1" data-path="section-7-final-assessment.html"><a href="section-7-final-assessment.html#breast-cancer-project---part-1"><i class="fa fa-check"></i><b>8.1</b> Breast Cancer Project - Part 1</a></li>
<li class="chapter" data-level="8.2" data-path="section-7-final-assessment.html"><a href="section-7-final-assessment.html#breast-cancer-project---part-2"><i class="fa fa-check"></i><b>8.2</b> Breast Cancer Project - Part 2</a></li>
<li class="chapter" data-level="8.3" data-path="section-7-final-assessment.html"><a href="section-7-final-assessment.html#breast-cancer-project---part-3"><i class="fa fa-check"></i><b>8.3</b> Breast Cancer Project - Part 3</a></li>
<li class="chapter" data-level="8.4" data-path="section-7-final-assessment.html"><a href="section-7-final-assessment.html#breast-cancer-project---part-4"><i class="fa fa-check"></i><b>8.4</b> Breast Cancer Project - Part 4</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Science Machine Learning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="section-4---distance-knn-cross-validation-and-generative-models" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Section 4 - Distance, Knn, Cross Validation, and Generative Models</h1>
<p>In the <strong>Distance, kNN, Cross Validation, and Generative Models</strong> section, you will learn about different types of discriminative and generative approaches for machine learning algorithms.</p>
<p>After completing this section, you will be able to:</p>
<ul>
<li>Use the <strong>k-nearest neighbors (kNN)</strong> algorithm.</li>
<li>Understand the problems of <strong>overtraining</strong> and <strong>oversmoothing</strong>.</li>
<li>Use <strong>cross-validation</strong> to reduce the <strong>true error</strong> and the <strong>apparent error</strong>.</li>
<li>Use <strong>generative models</strong> such as <strong>naive Bayes, quadratic discriminant analysis (qda),</strong> and <strong>linear discriminant analysis (lda)</strong> for machine learning.</li>
</ul>
<p>This section has three parts: <strong>nearest neighbors, cross-validation,</strong> and <strong>generative models</strong>.</p>
<div id="distance" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Distance</h2>
<p>There is a link to the relevant section of the textbook: <a href="https://rafalab.github.io/dsbook/large-datasets.html#distance" target="_blank">Distance</a></p>
<p><strong>Key points</strong></p>
<ul>
<li>Most clustering and machine learning techniques rely on being able to define distance between observations, using features or predictors.</li>
<li>With high dimensional data, a quick way to compute all the distances at once is to use the function <code>dist()</code>, which computes the distance between each row and produces an object of class <code>dist()</code>:</li>
</ul>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb319-1" aria-hidden="true"></a>d &lt;-<span class="st"> </span><span class="kw">dist</span>(x)</span></code></pre></div>
<ul>
<li>We can also compute distances between predictors. If <span class="math inline">\(N\)</span> is the number of observations, the distance between two predictors, say 1 and 2, is:</li>
</ul>
<p><span class="math inline">\(\text{dist}(1,2) = \sqrt{\sum_{i=1}^N (x_{i,1} - x_{i,2})^2}\)</span></p>
<ul>
<li>To compute the distance between all pairs of the 784 predictors, we can transpose the matrix first and then use dist():</li>
</ul>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb320-1" aria-hidden="true"></a>d &lt;-<span class="st"> </span><span class="kw">dist</span>(<span class="kw">t</span>(x))</span></code></pre></div>
<p><em>Code</em></p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb321-1" aria-hidden="true"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw">exists</span>(<span class="st">&quot;mnist&quot;</span>)) mnist &lt;-<span class="st"> </span><span class="kw">read_mnist</span>()</span>
<span id="cb321-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb321-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">0</span>) <span class="co"># if using R 3.5 or earlier</span></span>
<span id="cb321-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb321-3" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">0</span>, <span class="dt">sample.kind =</span> <span class="st">&quot;Rounding&quot;</span>) <span class="co"># if using R 3.6 or later</span></span></code></pre></div>
<pre><code>## Warning in set.seed(0, sample.kind = &quot;Rounding&quot;): non-uniform &#39;Rounding&#39; sampler used</code></pre>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb323-1" aria-hidden="true"></a>ind &lt;-<span class="st"> </span><span class="kw">which</span>(mnist<span class="op">$</span>train<span class="op">$</span>labels <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">7</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample</span>(<span class="dv">500</span>)</span>
<span id="cb323-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb323-2" aria-hidden="true"></a></span>
<span id="cb323-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb323-3" aria-hidden="true"></a><span class="co">#the predictors are in x and the labels in y</span></span>
<span id="cb323-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb323-4" aria-hidden="true"></a>x &lt;-<span class="st"> </span>mnist<span class="op">$</span>train<span class="op">$</span>images[ind,]</span>
<span id="cb323-5"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb323-5" aria-hidden="true"></a>y &lt;-<span class="st"> </span>mnist<span class="op">$</span>train<span class="op">$</span>labels[ind]</span>
<span id="cb323-6"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb323-6" aria-hidden="true"></a></span>
<span id="cb323-7"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb323-7" aria-hidden="true"></a>y[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</span></code></pre></div>
<pre><code>## [1] 7 7 2</code></pre>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb325-1" aria-hidden="true"></a>x_<span class="dv">1</span> &lt;-<span class="st"> </span>x[<span class="dv">1</span>,]</span>
<span id="cb325-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb325-2" aria-hidden="true"></a>x_<span class="dv">2</span> &lt;-<span class="st"> </span>x[<span class="dv">2</span>,]</span>
<span id="cb325-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb325-3" aria-hidden="true"></a>x_<span class="dv">3</span> &lt;-<span class="st"> </span>x[<span class="dv">3</span>,]</span>
<span id="cb325-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb325-4" aria-hidden="true"></a></span>
<span id="cb325-5"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb325-5" aria-hidden="true"></a><span class="co">#distance between two numbers</span></span>
<span id="cb325-6"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb325-6" aria-hidden="true"></a><span class="kw">sqrt</span>(<span class="kw">sum</span>((x_<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>x_<span class="dv">2</span>)<span class="op">^</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 2079.753</code></pre>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb327-1" aria-hidden="true"></a><span class="kw">sqrt</span>(<span class="kw">sum</span>((x_<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>x_<span class="dv">3</span>)<span class="op">^</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 2252.129</code></pre>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb329-1" aria-hidden="true"></a><span class="kw">sqrt</span>(<span class="kw">sum</span>((x_<span class="dv">2</span> <span class="op">-</span><span class="st"> </span>x_<span class="dv">3</span>)<span class="op">^</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 2642.906</code></pre>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb331-1" aria-hidden="true"></a><span class="co">#compute distance using matrix algebra</span></span>
<span id="cb331-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb331-2" aria-hidden="true"></a><span class="kw">sqrt</span>(<span class="kw">crossprod</span>(x_<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>x_<span class="dv">2</span>))</span></code></pre></div>
<pre><code>##          [,1]
## [1,] 2079.753</code></pre>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb333-1" aria-hidden="true"></a><span class="kw">sqrt</span>(<span class="kw">crossprod</span>(x_<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>x_<span class="dv">3</span>))</span></code></pre></div>
<pre><code>##          [,1]
## [1,] 2252.129</code></pre>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb335-1" aria-hidden="true"></a><span class="kw">sqrt</span>(<span class="kw">crossprod</span>(x_<span class="dv">2</span> <span class="op">-</span><span class="st"> </span>x_<span class="dv">3</span>))</span></code></pre></div>
<pre><code>##          [,1]
## [1,] 2642.906</code></pre>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb337-1" aria-hidden="true"></a><span class="co">#compute distance between each row</span></span>
<span id="cb337-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb337-2" aria-hidden="true"></a>d &lt;-<span class="st"> </span><span class="kw">dist</span>(x)</span>
<span id="cb337-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb337-3" aria-hidden="true"></a><span class="kw">class</span>(d)</span></code></pre></div>
<pre><code>## [1] &quot;dist&quot;</code></pre>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb339-1" aria-hidden="true"></a><span class="kw">as.matrix</span>(d)[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</span></code></pre></div>
<pre><code>##          1        2        3
## 1    0.000 2079.753 2252.129
## 2 2079.753    0.000 2642.906
## 3 2252.129 2642.906    0.000</code></pre>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb341-1" aria-hidden="true"></a><span class="co">#visualize these distances</span></span>
<span id="cb341-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb341-2" aria-hidden="true"></a><span class="kw">image</span>(<span class="kw">as.matrix</span>(d))</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-93-1.png" width="672" /></p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb342-1" aria-hidden="true"></a><span class="co">#order the distance by labels</span></span>
<span id="cb342-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb342-2" aria-hidden="true"></a><span class="kw">image</span>(<span class="kw">as.matrix</span>(d)[<span class="kw">order</span>(y), <span class="kw">order</span>(y)])</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-93-2.png" width="672" /></p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb343-1" aria-hidden="true"></a><span class="co">#compute distance between predictors</span></span>
<span id="cb343-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb343-2" aria-hidden="true"></a>d &lt;-<span class="st"> </span><span class="kw">dist</span>(<span class="kw">t</span>(x))</span>
<span id="cb343-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb343-3" aria-hidden="true"></a><span class="kw">dim</span>(<span class="kw">as.matrix</span>(d))</span></code></pre></div>
<pre><code>## [1] 784 784</code></pre>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb345-1" aria-hidden="true"></a>d_<span class="dv">492</span> &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(d)[<span class="dv">492</span>,]</span>
<span id="cb345-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb345-2" aria-hidden="true"></a></span>
<span id="cb345-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb345-3" aria-hidden="true"></a><span class="kw">image</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">28</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">28</span>, <span class="kw">matrix</span>(d_<span class="dv">492</span>, <span class="dv">28</span>, <span class="dv">28</span>))</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-93-3.png" width="672" /></p>
</div>
<div id="comprehension-check---distance" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Comprehension Check - Distance</h2>
<ol style="list-style-type: decimal">
<li>Load the following dataset:</li>
</ol>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb346-1" aria-hidden="true"></a><span class="kw">data</span>(tissue_gene_expression)</span></code></pre></div>
<p>This dataset includes a matrix <code>x</code>:</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb347-1" aria-hidden="true"></a><span class="kw">dim</span>(tissue_gene_expression<span class="op">$</span>x)</span></code></pre></div>
<pre><code>## [1] 189 500</code></pre>
<p>This matrix has the gene expression levels of 500 genes from 189 biological samples representing seven different tissues. The tissue type is stored in <code>y</code>:</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb349-1" aria-hidden="true"></a><span class="kw">table</span>(tissue_gene_expression<span class="op">$</span>y)</span></code></pre></div>
<pre><code>## 
##  cerebellum       colon endometrium hippocampus      kidney       liver    placenta 
##          38          34          15          31          39          26           6</code></pre>
<p>Which of the following lines of code computes the Euclidean distance between each observation and stores it in the object <code>d</code>?</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb351-1" aria-hidden="true"></a>d &lt;-<span class="st"> </span><span class="kw">dist</span>(tissue_gene_expression<span class="op">$</span>x)</span></code></pre></div>
<ul class="task-list">
<li><p><input type="checkbox" disabled="" />
A. <code>d &lt;- dist(tissue_gene_expression$x, distance='maximum')</code></p></li>
<li><p><input type="checkbox" disabled="" />
B. <code>d &lt;- dist(tissue_gene_expression)</code></p></li>
<li><p><input type="checkbox" disabled="" checked="" />
C. <code>d &lt;- dist(tissue_gene_expression$x)</code></p></li>
<li><p><input type="checkbox" disabled="" />
D. <code>d &lt;- cor(tissue_gene_expression$x)</code></p></li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Using the dataset from Q1, compare the distances between observations 1 and 2 (both cerebellum), observations 39 and 40 (both colon), and observations 73 and 74 (both endometrium).</li>
</ol>
<p>Distance-wise, are samples from tissues of the same type closer to each other than tissues of different type?</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb352-1" aria-hidden="true"></a>ind &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">39</span>, <span class="dv">40</span>, <span class="dv">73</span>, <span class="dv">74</span>)</span>
<span id="cb352-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb352-2" aria-hidden="true"></a><span class="kw">as.matrix</span>(d)[ind,ind]</span></code></pre></div>
<pre><code>##               cerebellum_1 cerebellum_2   colon_1   colon_2 endometrium_1 endometrium_2
## cerebellum_1      0.000000     7.005922 22.694801 22.699755      21.12763      21.78079
## cerebellum_2      7.005922     0.000000 22.384821 22.069557      20.87910      20.67480
## colon_1          22.694801    22.384821  0.000000  8.191935      14.99672      18.08921
## colon_2          22.699755    22.069557  8.191935  0.000000      14.80355      17.00446
## endometrium_1    21.127629    20.879099 14.996715 14.803545       0.00000      14.29405
## endometrium_2    21.780792    20.674802 18.089213 17.004456      14.29405       0.00000</code></pre>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. No, the samples from the same tissue type are not necessarily closer.</li>
<li><input type="checkbox" disabled="" />
B. The two colon samples are close to each other, but the samples from the other two tissues are not.</li>
<li><input type="checkbox" disabled="" />
C. The two cerebellum samples are close to each other, but the samples from the other two tissues are not.</li>
<li><input type="checkbox" disabled="" checked="" />
D. Yes, the samples from the same tissue type are closer to each other.</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Make a plot of all the distances using the image() function to see if the pattern you observed in Q2 is general.</li>
</ol>
<p>Which code would correctly make the desired plot?</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb354-1" aria-hidden="true"></a><span class="kw">image</span>(<span class="kw">as.matrix</span>(d))</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-99-1.png" width="672" /></p>
<ul class="task-list">
<li><p><input type="checkbox" disabled="" />
A. <code>image(d)</code></p></li>
<li><p><input type="checkbox" disabled="" checked="" />
B. <code>image(as.matrix(d))</code></p></li>
<li><p><input type="checkbox" disabled="" />
C. <code>d</code></p></li>
<li><p><input type="checkbox" disabled="" />
D. <code>image()</code></p></li>
</ul>
</div>
<div id="knn" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Knn</h2>
<p>There is a link to the relevant section of the textbook: <a href="https://rafalab.github.io/dsbook/examples-of-algorithms.html#k-nearest-neighbors" target="_blank">k-nearest neighbors</a></p>
<p><strong>Key points</strong></p>
<ul>
<li><strong>K-nearest neighbors (kNN)</strong> estimates the conditional probabilities in a similar way to bin smoothing. However, kNN is easier to adapt to multiple dimensions.</li>
<li>Using kNN, for any point <span class="math inline">\((x_1,x_2)\)</span> for which we want an estimate of <span class="math inline">\(p(x_1,x_2)\)</span>, we look for the <strong>k nearest points</strong> to <span class="math inline">\((x_1,x_2)\)</span> and take an average of the 0s and 1s associated with these points. We refer to the set of points used to compute the average as the <strong>neighborhood</strong>. Larger values of k result in smoother estimates, while smaller values of k result in more flexible and more wiggly estimates.</li>
<li>To implement the algorithm, we can use the <code>knn3()</code> function from the <strong>caret</strong> package. There are two ways to call this function:</li>
</ul>
<ol style="list-style-type: decimal">
<li>We need to specify a formula and a data frame. The formula looks like this: <span class="math inline">\(\text{outcome} \sim \text{predictor}_1 + \text{predictor}_2 + \text{predictor}_3\)</span>. The <code>predict()</code> function for <code>knn3</code> produces a probability for each class.</li>
<li>We can also call the function with the first argument being the matrix predictors and the second a vector of outcomes, like this:</li>
</ol>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb355-1" aria-hidden="true"></a>x &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(mnist_<span class="dv">27</span><span class="op">$</span>train[,<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>])</span>
<span id="cb355-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb355-2" aria-hidden="true"></a>y &lt;-<span class="st"> </span>mnist_<span class="dv">27</span><span class="op">$</span>train<span class="op">$</span>y</span>
<span id="cb355-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb355-3" aria-hidden="true"></a>knn_fit &lt;-<span class="st"> </span><span class="kw">knn3</span>(x,y)</span></code></pre></div>
<p><em>Code</em></p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb356-1" aria-hidden="true"></a><span class="kw">data</span>(<span class="st">&quot;mnist_27&quot;</span>)</span>
<span id="cb356-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb356-2" aria-hidden="true"></a>mnist_<span class="dv">27</span><span class="op">$</span>test <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(x_<span class="dv">1</span>, x_<span class="dv">2</span>, <span class="dt">color =</span> y)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-101-1.png" width="672" /></p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb357-1" aria-hidden="true"></a><span class="co">#logistic regression</span></span>
<span id="cb357-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb357-2" aria-hidden="true"></a><span class="kw">library</span>(caret)</span>
<span id="cb357-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb357-3" aria-hidden="true"></a>fit_glm &lt;-<span class="st"> </span><span class="kw">glm</span>(y<span class="op">~</span>x_<span class="dv">1</span><span class="op">+</span>x_<span class="dv">2</span>, <span class="dt">data=</span>mnist_<span class="dv">27</span><span class="op">$</span>train, <span class="dt">family=</span><span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb357-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb357-4" aria-hidden="true"></a>p_hat_logistic &lt;-<span class="st"> </span><span class="kw">predict</span>(fit_glm, mnist_<span class="dv">27</span><span class="op">$</span>test)</span>
<span id="cb357-5"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb357-5" aria-hidden="true"></a>y_hat_logistic &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">ifelse</span>(p_hat_logistic <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>, <span class="dv">7</span>, <span class="dv">2</span>))</span>
<span id="cb357-6"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb357-6" aria-hidden="true"></a><span class="kw">confusionMatrix</span>(<span class="dt">data =</span> y_hat_logistic, <span class="dt">reference =</span> mnist_<span class="dv">27</span><span class="op">$</span>test<span class="op">$</span>y)<span class="op">$</span>overall[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## Accuracy 
##     0.76</code></pre>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb359-1" aria-hidden="true"></a><span class="co">#fit knn model</span></span>
<span id="cb359-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb359-2" aria-hidden="true"></a>knn_fit &lt;-<span class="st"> </span><span class="kw">knn3</span>(y <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> mnist_<span class="dv">27</span><span class="op">$</span>train)</span>
<span id="cb359-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb359-3" aria-hidden="true"></a></span>
<span id="cb359-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb359-4" aria-hidden="true"></a>x &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(mnist_<span class="dv">27</span><span class="op">$</span>train[,<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>])</span>
<span id="cb359-5"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb359-5" aria-hidden="true"></a>y &lt;-<span class="st"> </span>mnist_<span class="dv">27</span><span class="op">$</span>train<span class="op">$</span>y</span>
<span id="cb359-6"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb359-6" aria-hidden="true"></a>knn_fit &lt;-<span class="st"> </span><span class="kw">knn3</span>(x, y)</span>
<span id="cb359-7"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb359-7" aria-hidden="true"></a></span>
<span id="cb359-8"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb359-8" aria-hidden="true"></a>knn_fit &lt;-<span class="st"> </span><span class="kw">knn3</span>(y <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> mnist_<span class="dv">27</span><span class="op">$</span>train, <span class="dt">k=</span><span class="dv">5</span>)</span>
<span id="cb359-9"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb359-9" aria-hidden="true"></a></span>
<span id="cb359-10"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb359-10" aria-hidden="true"></a>y_hat_knn &lt;-<span class="st"> </span><span class="kw">predict</span>(knn_fit, mnist_<span class="dv">27</span><span class="op">$</span>test, <span class="dt">type =</span> <span class="st">&quot;class&quot;</span>)</span>
<span id="cb359-11"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb359-11" aria-hidden="true"></a><span class="kw">confusionMatrix</span>(<span class="dt">data =</span> y_hat_knn, <span class="dt">reference =</span> mnist_<span class="dv">27</span><span class="op">$</span>test<span class="op">$</span>y)<span class="op">$</span>overall[<span class="st">&quot;Accuracy&quot;</span>]</span></code></pre></div>
<pre><code>## Accuracy 
##    0.815</code></pre>
</div>
<div id="over-training-and-over-smoothing" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> Over-training and Over-smoothing</h2>
<p>There is a link to the relevant sections of the textbook: <a href="https://rafalab.github.io/dsbook/cross-validation.html#over-training" target="_blank">Over-training</a> and <a href="https://rafalab.github.io/dsbook/cross-validation.html#over-smoothing" target="_blank">Over-smoothing</a></p>
<p><strong>Key points</strong></p>
<ul>
<li><strong>Over-training</strong> is the reason that we have higher accuracy in the train set compared to the test set. Over-training is at its worst when we set <span class="math inline">\(k=1\)</span>. With <span class="math inline">\(k=1\)</span>, the estimate for each <span class="math inline">\((x_1,x_2)\)</span> in the training set is obtained with just the <span class="math inline">\(y\)</span> corresponding to that point.</li>
<li>When we try a larger <span class="math inline">\(k\)</span>, the <span class="math inline">\(k\)</span> might be so large that it does not permit enough flexibility. We call this <strong>over-smoothing</strong>.</li>
<li>Note that if we use the test set to pick this <span class="math inline">\(k\)</span>, we should not expect the accompanying accuracy estimate to extrapolate to the real world. This is because even here we broke a golden rule of machine learning: <strong>we selected the <span class="math inline">\(k\)</span> using the test set. Cross validation</strong> also provides an estimate that takes this into account.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb361-1" aria-hidden="true"></a>y_hat_knn &lt;-<span class="st"> </span><span class="kw">predict</span>(knn_fit, mnist_<span class="dv">27</span><span class="op">$</span>train, <span class="dt">type =</span> <span class="st">&quot;class&quot;</span>) </span>
<span id="cb361-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb361-2" aria-hidden="true"></a><span class="kw">confusionMatrix</span>(<span class="dt">data =</span> y_hat_knn, <span class="dt">reference =</span> mnist_<span class="dv">27</span><span class="op">$</span>train<span class="op">$</span>y)<span class="op">$</span>overall[<span class="st">&quot;Accuracy&quot;</span>]</span></code></pre></div>
<pre><code>## Accuracy 
##   0.8825</code></pre>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb363-1" aria-hidden="true"></a>y_hat_knn &lt;-<span class="st"> </span><span class="kw">predict</span>(knn_fit, mnist_<span class="dv">27</span><span class="op">$</span>test, <span class="dt">type =</span> <span class="st">&quot;class&quot;</span>)  </span>
<span id="cb363-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb363-2" aria-hidden="true"></a><span class="kw">confusionMatrix</span>(<span class="dt">data =</span> y_hat_knn, <span class="dt">reference =</span> mnist_<span class="dv">27</span><span class="op">$</span>test<span class="op">$</span>y)<span class="op">$</span>overall[<span class="st">&quot;Accuracy&quot;</span>]</span></code></pre></div>
<pre><code>## Accuracy 
##    0.815</code></pre>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb365-1" aria-hidden="true"></a><span class="co">#fit knn with k=1</span></span>
<span id="cb365-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb365-2" aria-hidden="true"></a>knn_fit_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">knn3</span>(y <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> mnist_<span class="dv">27</span><span class="op">$</span>train, <span class="dt">k =</span> <span class="dv">1</span>)</span>
<span id="cb365-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb365-3" aria-hidden="true"></a>y_hat_knn_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">predict</span>(knn_fit_<span class="dv">1</span>, mnist_<span class="dv">27</span><span class="op">$</span>train, <span class="dt">type =</span> <span class="st">&quot;class&quot;</span>)</span>
<span id="cb365-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb365-4" aria-hidden="true"></a><span class="kw">confusionMatrix</span>(<span class="dt">data=</span>y_hat_knn_<span class="dv">1</span>, <span class="dt">reference=</span>mnist_<span class="dv">27</span><span class="op">$</span>train<span class="op">$</span>y)<span class="op">$</span>overall[[<span class="st">&quot;Accuracy&quot;</span>]]</span></code></pre></div>
<pre><code>## [1] 0.995</code></pre>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb367-1" aria-hidden="true"></a>y_hat_knn_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">predict</span>(knn_fit_<span class="dv">1</span>, mnist_<span class="dv">27</span><span class="op">$</span>test, <span class="dt">type =</span> <span class="st">&quot;class&quot;</span>)</span>
<span id="cb367-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb367-2" aria-hidden="true"></a><span class="kw">confusionMatrix</span>(<span class="dt">data=</span>y_hat_knn_<span class="dv">1</span>, <span class="dt">reference=</span>mnist_<span class="dv">27</span><span class="op">$</span>test<span class="op">$</span>y)<span class="op">$</span>overall[[<span class="st">&quot;Accuracy&quot;</span>]]</span></code></pre></div>
<pre><code>## [1] 0.74</code></pre>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb369-1" aria-hidden="true"></a><span class="co">#fit knn with k=401</span></span>
<span id="cb369-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb369-2" aria-hidden="true"></a>knn_fit_<span class="dv">401</span> &lt;-<span class="st"> </span><span class="kw">knn3</span>(y <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> mnist_<span class="dv">27</span><span class="op">$</span>train, <span class="dt">k =</span> <span class="dv">401</span>)</span>
<span id="cb369-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb369-3" aria-hidden="true"></a>y_hat_knn_<span class="dv">401</span> &lt;-<span class="st"> </span><span class="kw">predict</span>(knn_fit_<span class="dv">401</span>, mnist_<span class="dv">27</span><span class="op">$</span>test, <span class="dt">type =</span> <span class="st">&quot;class&quot;</span>)</span>
<span id="cb369-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb369-4" aria-hidden="true"></a><span class="kw">confusionMatrix</span>(<span class="dt">data=</span>y_hat_knn_<span class="dv">401</span>, <span class="dt">reference=</span>mnist_<span class="dv">27</span><span class="op">$</span>test<span class="op">$</span>y)<span class="op">$</span>overall[<span class="st">&quot;Accuracy&quot;</span>]</span></code></pre></div>
<pre><code>## Accuracy 
##     0.79</code></pre>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb371-1" aria-hidden="true"></a><span class="co">#pick the k in knn</span></span>
<span id="cb371-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb371-2" aria-hidden="true"></a>ks &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">3</span>, <span class="dv">251</span>, <span class="dv">2</span>)</span>
<span id="cb371-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb371-3" aria-hidden="true"></a><span class="kw">library</span>(purrr)</span>
<span id="cb371-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb371-4" aria-hidden="true"></a>accuracy &lt;-<span class="st"> </span><span class="kw">map_df</span>(ks, <span class="cf">function</span>(k){</span>
<span id="cb371-5"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb371-5" aria-hidden="true"></a>    fit &lt;-<span class="st"> </span><span class="kw">knn3</span>(y <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> mnist_<span class="dv">27</span><span class="op">$</span>train, <span class="dt">k =</span> k)</span>
<span id="cb371-6"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb371-6" aria-hidden="true"></a>    y_hat &lt;-<span class="st"> </span><span class="kw">predict</span>(fit, mnist_<span class="dv">27</span><span class="op">$</span>train, <span class="dt">type =</span> <span class="st">&quot;class&quot;</span>)</span>
<span id="cb371-7"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb371-7" aria-hidden="true"></a>    cm_train &lt;-<span class="st"> </span><span class="kw">confusionMatrix</span>(<span class="dt">data =</span> y_hat, <span class="dt">reference =</span> mnist_<span class="dv">27</span><span class="op">$</span>train<span class="op">$</span>y)</span>
<span id="cb371-8"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb371-8" aria-hidden="true"></a>    train_error &lt;-<span class="st"> </span>cm_train<span class="op">$</span>overall[<span class="st">&quot;Accuracy&quot;</span>]</span>
<span id="cb371-9"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb371-9" aria-hidden="true"></a>    y_hat &lt;-<span class="st"> </span><span class="kw">predict</span>(fit, mnist_<span class="dv">27</span><span class="op">$</span>test, <span class="dt">type =</span> <span class="st">&quot;class&quot;</span>)</span>
<span id="cb371-10"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb371-10" aria-hidden="true"></a>    cm_test &lt;-<span class="st"> </span><span class="kw">confusionMatrix</span>(<span class="dt">data =</span> y_hat, <span class="dt">reference =</span> mnist_<span class="dv">27</span><span class="op">$</span>test<span class="op">$</span>y)</span>
<span id="cb371-11"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb371-11" aria-hidden="true"></a>    test_error &lt;-<span class="st"> </span>cm_test<span class="op">$</span>overall[<span class="st">&quot;Accuracy&quot;</span>]</span>
<span id="cb371-12"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb371-12" aria-hidden="true"></a>    </span>
<span id="cb371-13"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb371-13" aria-hidden="true"></a><span class="kw">tibble</span>(<span class="dt">train =</span> train_error, <span class="dt">test =</span> test_error)</span>
<span id="cb371-14"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb371-14" aria-hidden="true"></a>})</span>
<span id="cb371-15"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb371-15" aria-hidden="true"></a></span>
<span id="cb371-16"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb371-16" aria-hidden="true"></a></span>
<span id="cb371-17"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb371-17" aria-hidden="true"></a><span class="co">#pick the k that maximizes accuracy using the estimates built on the test data</span></span>
<span id="cb371-18"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb371-18" aria-hidden="true"></a>ks[<span class="kw">which.max</span>(accuracy<span class="op">$</span>test)]</span></code></pre></div>
<pre><code>## [1] 41</code></pre>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb373-1" aria-hidden="true"></a><span class="kw">max</span>(accuracy<span class="op">$</span>test)</span></code></pre></div>
<pre><code>## [1] 0.86</code></pre>
</div>
<div id="comprehension-check---nearest-neighbors" class="section level2" number="5.5">
<h2><span class="header-section-number">5.5</span> Comprehension Check - Nearest Neighbors</h2>
<ol style="list-style-type: decimal">
<li>Previously, we used logistic regression to predict sex based on height. Now we are going to use knn to do the same. Set the seed to 1, then use the <strong>caret</strong> package to partition the <strong>dslabs</strong> <code>heights</code> data into a training and test set of equal size. Use the <code>sapply()</code> function to perform knn with <code>k</code> values of <code>seq(1, 101, 3)</code> and calculate F1 scores with the <code>F_meas()</code> function using the default value of the relevant argument.</li>
</ol>
<p>What is the max value of <code>F_1</code>?</p>
<p>At what value of <code>k</code> does the max occur?</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb375-1" aria-hidden="true"></a><span class="kw">data</span>(<span class="st">&quot;heights&quot;</span>)</span>
<span id="cb375-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb375-2" aria-hidden="true"></a></span>
<span id="cb375-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb375-3" aria-hidden="true"></a><span class="co"># set.seed(1) # if using R 3.5 or earlier</span></span>
<span id="cb375-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb375-4" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>, <span class="dt">sample.kind =</span> <span class="st">&quot;Rounding&quot;</span>) <span class="co"># if using R 3.6 or later</span></span></code></pre></div>
<pre><code>## Warning in set.seed(1, sample.kind = &quot;Rounding&quot;): non-uniform &#39;Rounding&#39; sampler used</code></pre>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb377-1" aria-hidden="true"></a>test_index &lt;-<span class="st"> </span><span class="kw">createDataPartition</span>(heights<span class="op">$</span>sex, <span class="dt">times =</span> <span class="dv">1</span>, <span class="dt">p =</span> <span class="fl">0.5</span>, <span class="dt">list =</span> <span class="ot">FALSE</span>)</span>
<span id="cb377-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb377-2" aria-hidden="true"></a>test_set &lt;-<span class="st"> </span>heights[test_index, ]</span>
<span id="cb377-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb377-3" aria-hidden="true"></a>train_set &lt;-<span class="st"> </span>heights[<span class="op">-</span>test_index, ]     </span>
<span id="cb377-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb377-4" aria-hidden="true"></a>                </span>
<span id="cb377-5"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb377-5" aria-hidden="true"></a>ks &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">101</span>, <span class="dv">3</span>)</span>
<span id="cb377-6"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb377-6" aria-hidden="true"></a>F_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">sapply</span>(ks, <span class="cf">function</span>(k){</span>
<span id="cb377-7"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb377-7" aria-hidden="true"></a>    fit &lt;-<span class="st"> </span><span class="kw">knn3</span>(sex <span class="op">~</span><span class="st"> </span>height, <span class="dt">data =</span> train_set, <span class="dt">k =</span> k)</span>
<span id="cb377-8"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb377-8" aria-hidden="true"></a>    y_hat &lt;-<span class="st"> </span><span class="kw">predict</span>(fit, test_set, <span class="dt">type =</span> <span class="st">&quot;class&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb377-9"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb377-9" aria-hidden="true"></a><span class="st">        </span><span class="kw">factor</span>(<span class="dt">levels =</span> <span class="kw">levels</span>(train_set<span class="op">$</span>sex))</span>
<span id="cb377-10"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb377-10" aria-hidden="true"></a>    <span class="kw">F_meas</span>(<span class="dt">data =</span> y_hat, <span class="dt">reference =</span> test_set<span class="op">$</span>sex)</span>
<span id="cb377-11"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb377-11" aria-hidden="true"></a>})</span>
<span id="cb377-12"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb377-12" aria-hidden="true"></a><span class="kw">plot</span>(ks, F_<span class="dv">1</span>)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-103-1.png" width="672" /></p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb378-1" aria-hidden="true"></a><span class="kw">max</span>(F_<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 0.6019417</code></pre>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb380-1" aria-hidden="true"></a>ks[<span class="kw">which.max</span>(F_<span class="dv">1</span>)]</span></code></pre></div>
<pre><code>## [1] 46</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Next we will use the same gene expression example used in the Comprehension Check: Distance exercises. You can load it like this:</li>
</ol>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb382-1" aria-hidden="true"></a><span class="kw">library</span>(dslabs)</span>
<span id="cb382-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb382-2" aria-hidden="true"></a><span class="kw">library</span>(caret)</span>
<span id="cb382-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb382-3" aria-hidden="true"></a><span class="kw">data</span>(<span class="st">&quot;tissue_gene_expression&quot;</span>)</span></code></pre></div>
<p>First, set the seed to 1 and split the data into training and test sets with <code>p = 0.5</code>. Then, report the accuracy you obtain from predicting tissue type using KNN with <code>k = seq(1, 11, 2)</code> using <code>sapply()</code> or <code>map_df()</code>. Note: use the <code>createDataPartition()</code> function outside of <code>sapply()</code> or <code>map_df()</code>.</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb383-1" aria-hidden="true"></a><span class="co"># set.seed(1) # if using R 3.5 or earlier</span></span>
<span id="cb383-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb383-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>, <span class="dt">sample.kind =</span> <span class="st">&quot;Rounding&quot;</span>) <span class="co"># if using R 3.6 or later</span></span></code></pre></div>
<pre><code>## Warning in set.seed(1, sample.kind = &quot;Rounding&quot;): non-uniform &#39;Rounding&#39; sampler used</code></pre>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb385-1" aria-hidden="true"></a>y &lt;-<span class="st"> </span>tissue_gene_expression<span class="op">$</span>y</span>
<span id="cb385-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb385-2" aria-hidden="true"></a>x &lt;-<span class="st"> </span>tissue_gene_expression<span class="op">$</span>x</span>
<span id="cb385-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb385-3" aria-hidden="true"></a>test_index &lt;-<span class="st"> </span><span class="kw">createDataPartition</span>(y, <span class="dt">list =</span> <span class="ot">FALSE</span>)</span>
<span id="cb385-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb385-4" aria-hidden="true"></a><span class="kw">sapply</span>(<span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">11</span>, <span class="dv">2</span>), <span class="cf">function</span>(k){</span>
<span id="cb385-5"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb385-5" aria-hidden="true"></a>    fit &lt;-<span class="st"> </span><span class="kw">knn3</span>(x[<span class="op">-</span>test_index,], y[<span class="op">-</span>test_index], <span class="dt">k =</span> k)</span>
<span id="cb385-6"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb385-6" aria-hidden="true"></a>    y_hat &lt;-<span class="st"> </span><span class="kw">predict</span>(fit, <span class="dt">newdata =</span> <span class="kw">data.frame</span>(<span class="dt">x=</span>x[test_index,]),</span>
<span id="cb385-7"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb385-7" aria-hidden="true"></a>                <span class="dt">type =</span> <span class="st">&quot;class&quot;</span>)</span>
<span id="cb385-8"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb385-8" aria-hidden="true"></a><span class="kw">mean</span>(y_hat <span class="op">==</span><span class="st"> </span>y[test_index])</span>
<span id="cb385-9"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb385-9" aria-hidden="true"></a>})</span></code></pre></div>
<pre><code>## [1] 0.9895833 0.9687500 0.9479167 0.9166667 0.9166667 0.9062500</code></pre>
</div>
<div id="k-fold-cross-validation" class="section level2" number="5.6">
<h2><span class="header-section-number">5.6</span> K-fold cross validation</h2>
<p>There is a link to the relevant section of the textbook: <a href="https://rafalab.github.io/dsbook/cross-validation.html#k-fold-cross-validation" target="_blank">K-fold cross validation</a></p>
<p><strong>Key points</strong></p>
<ul>
<li>For <strong><span class="math inline">\(k\)</span>-fold cross validation</strong>, we divide the dataset into a training set and a test set. We train our algorithm exclusively on the training set and use the test set only for evaluation purposes.</li>
<li>For each set of algorithm parameters being considered, we want an <strong>estimate of the MSE and then we will choose the parameters with the smallest MSE</strong>. In <span class="math inline">\(k\)</span>-fold cross validation, we randomly split the observations into <span class="math inline">\(k\)</span> non-overlapping sets, and repeat the calculation for MSE for each of these sets. Then, we compute the average MSE and obtain an estimate of our loss. Finally, we can select the optimal parameter that minimized the MSE.</li>
<li>In terms of how to select <span class="math inline">\(k\)</span> for cross validation, <strong>larger values of <span class="math inline">\(k\)</span> are preferable but they will also take much more</strong> computational time. For this reason, the choices of <span class="math inline">\(k=5\)</span> and <span class="math inline">\(k=10\)</span> are common.</li>
</ul>
</div>
<div id="comprehension-check---cross-validation" class="section level2" number="5.7">
<h2><span class="header-section-number">5.7</span> Comprehension Check - Cross-validation</h2>
<ol style="list-style-type: decimal">
<li>Generate a set of random predictors and outcomes using the following code:</li>
</ol>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb387-1" aria-hidden="true"></a><span class="co"># set.seed(1996) #if you are using R 3.5 or earlier</span></span>
<span id="cb387-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb387-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1996</span>, <span class="dt">sample.kind=</span><span class="st">&quot;Rounding&quot;</span>) <span class="co">#if you are using R 3.6 or later</span></span></code></pre></div>
<pre><code>## Warning in set.seed(1996, sample.kind = &quot;Rounding&quot;): non-uniform &#39;Rounding&#39; sampler used</code></pre>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb389-1" aria-hidden="true"></a>n &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb389-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb389-2" aria-hidden="true"></a>p &lt;-<span class="st"> </span><span class="dv">10000</span></span>
<span id="cb389-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb389-3" aria-hidden="true"></a>x &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(n<span class="op">*</span>p), n, p)</span>
<span id="cb389-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb389-4" aria-hidden="true"></a><span class="kw">colnames</span>(x) &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;x&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(x), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>)</span>
<span id="cb389-5"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb389-5" aria-hidden="true"></a>y &lt;-<span class="st"> </span><span class="kw">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">factor</span>()</span>
<span id="cb389-6"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb389-6" aria-hidden="true"></a></span>
<span id="cb389-7"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb389-7" aria-hidden="true"></a>x_subset &lt;-<span class="st"> </span>x[ ,<span class="kw">sample</span>(p, <span class="dv">100</span>)]</span></code></pre></div>
<p>Because <code>x</code> and <code>y</code> are completely independent, you should not be able to predict <code>y</code> using x with accuracy greater than 0.5. Confirm this by running cross-validation using logistic regression to fit the model. Because we have so many predictors, we selected a random sample <code>x_subset</code>. Use the subset when training the model.</p>
<p>Which code correctly performs this cross-validation?</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb390-1" aria-hidden="true"></a>fit &lt;-<span class="st"> </span><span class="kw">train</span>(x_subset, y, <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>)</span>
<span id="cb390-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb390-2" aria-hidden="true"></a>fit<span class="op">$</span>results</span></code></pre></div>
<pre><code>##   parameter  Accuracy      Kappa AccuracySD    KappaSD
## 1      none 0.5078406 0.01318925 0.02336971 0.04626366</code></pre>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A.</li>
</ul>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb392-1" aria-hidden="true"></a>fit &lt;-<span class="st"> </span><span class="kw">train</span>(x_subset, y)</span>
<span id="cb392-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb392-2" aria-hidden="true"></a>fit<span class="op">$</span>results</span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
B.</li>
</ul>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb393-1" aria-hidden="true"></a>fit &lt;-<span class="st"> </span><span class="kw">train</span>(x_subset, y, <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>)</span>
<span id="cb393-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb393-2" aria-hidden="true"></a>fit<span class="op">$</span>results</span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
C.</li>
</ul>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb394-1" aria-hidden="true"></a>fit &lt;-<span class="st"> </span><span class="kw">train</span>(y, x_subset, <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>)</span>
<span id="cb394-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb394-2" aria-hidden="true"></a>fit<span class="op">$</span>results</span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
D.</li>
</ul>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb395-1" aria-hidden="true"></a>fit &lt;-<span class="st"> </span><span class="kw">test</span>(x_subset, y, <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>)</span>
<span id="cb395-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb395-2" aria-hidden="true"></a>fit<span class="op">$</span>results</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Now, instead of using a random selection of predictors, we are going to search for those that are most predictive of the outcome. We can do this by comparing the values for the <span class="math inline">\(y=1\)</span> group to those in the <span class="math inline">\(y=0\)</span> group, for each predictor, using a t-test. You can do perform this step like this:</li>
</ol>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb396-1" aria-hidden="true"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw">require</span>(BiocManager)) <span class="kw">install.packages</span>(<span class="st">&quot;BiocManager&quot;</span>)</span>
<span id="cb396-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb396-2" aria-hidden="true"></a></span>
<span id="cb396-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb396-3" aria-hidden="true"></a>BiocManager<span class="op">::</span><span class="kw">install</span>(<span class="st">&quot;genefilter&quot;</span>)</span>
<span id="cb396-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb396-4" aria-hidden="true"></a><span class="kw">library</span>(genefilter)</span>
<span id="cb396-5"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb396-5" aria-hidden="true"></a>tt &lt;-<span class="st"> </span><span class="kw">colttests</span>(x, y)</span></code></pre></div>
<p>Which of the following lines of code correctly creates a vector of the p-values called pvals?</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb397-1" aria-hidden="true"></a>pvals &lt;-<span class="st"> </span>tt<span class="op">$</span>p.value</span></code></pre></div>
<ul class="task-list">
<li><p><input type="checkbox" disabled="" />
A. <code>pvals &lt;- tt$dm</code></p></li>
<li><p><input type="checkbox" disabled="" />
B. <code>pvals &lt;- tt$statistic</code></p></li>
<li><p><input type="checkbox" disabled="" />
C. <code>pvals &lt;- tt</code></p></li>
<li><p><input type="checkbox" disabled="" checked="" />
D. <code>pvals &lt;- tt$p.value</code></p></li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Create an index <code>ind</code> with the column numbers of the predictors that were “statistically significantly” associated with <code>y</code>. Use a p-value cutoff of 0.01 to define “statistically significantly.”</li>
</ol>
<p>How many predictors survive this cutoff?</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb398-1" aria-hidden="true"></a>ind &lt;-<span class="st"> </span><span class="kw">which</span>(pvals <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.01</span>)</span>
<span id="cb398-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb398-2" aria-hidden="true"></a><span class="kw">length</span>(ind)</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Now re-run the cross-validation after redefinining <code>x_subset</code> to be the subset of <code>x</code> defined by the columns showing “statistically significant” association with <code>y</code>.</li>
</ol>
<p>What is the accuracy now?</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb399-1" aria-hidden="true"></a>x_subset &lt;-<span class="st"> </span>x[,ind]</span>
<span id="cb399-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb399-2" aria-hidden="true"></a>fit &lt;-<span class="st"> </span><span class="kw">train</span>(x_subset, y, <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>)</span>
<span id="cb399-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb399-3" aria-hidden="true"></a>fit<span class="op">$</span>results</span></code></pre></div>
<pre><code>##   parameter  Accuracy       Kappa AccuracySD    KappaSD
## 1      none 0.5078234 0.009411212 0.02020397 0.03922244</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Re-run the cross-validation again, but this time using kNN. Try out the following grid <code>k = seq(101, 301, 25)</code> of tuning parameters. Make a plot of the resulting accuracies.</li>
</ol>
<p>Which code is correct?</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb401-1" aria-hidden="true"></a>fit &lt;-<span class="st"> </span><span class="kw">train</span>(x_subset, y, <span class="dt">method =</span> <span class="st">&quot;knn&quot;</span>, <span class="dt">tuneGrid =</span> <span class="kw">data.frame</span>(<span class="dt">k =</span> <span class="kw">seq</span>(<span class="dv">101</span>, <span class="dv">301</span>, <span class="dv">25</span>)))</span>
<span id="cb401-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb401-2" aria-hidden="true"></a><span class="kw">ggplot</span>(fit)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-116-1.png" width="672" /></p>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A.</li>
</ul>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb402-1" aria-hidden="true"></a>fit &lt;-<span class="st"> </span><span class="kw">train</span>(x_subset, y, <span class="dt">method =</span> <span class="st">&quot;knn&quot;</span>, <span class="dt">tuneGrid =</span> <span class="kw">data.frame</span>(<span class="dt">k =</span> <span class="kw">seq</span>(<span class="dv">101</span>, <span class="dv">301</span>, <span class="dv">25</span>)))</span>
<span id="cb402-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb402-2" aria-hidden="true"></a><span class="kw">ggplot</span>(fit)</span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
B.</li>
</ul>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb403-1" aria-hidden="true"></a>fit &lt;-<span class="st"> </span><span class="kw">train</span>(x_subset, y, <span class="dt">method =</span> <span class="st">&quot;knn&quot;</span>)</span>
<span id="cb403-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb403-2" aria-hidden="true"></a><span class="kw">ggplot</span>(fit)</span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
C.</li>
</ul>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb404-1" aria-hidden="true"></a>fit &lt;-<span class="st"> </span><span class="kw">train</span>(x_subset, y, <span class="dt">method =</span> <span class="st">&quot;knn&quot;</span>, <span class="dt">tuneGrid =</span> <span class="kw">data.frame</span>(<span class="dt">k =</span> <span class="kw">seq</span>(<span class="dv">103</span>, <span class="dv">301</span>, <span class="dv">25</span>)))</span>
<span id="cb404-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb404-2" aria-hidden="true"></a><span class="kw">ggplot</span>(fit)</span></code></pre></div>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
D.</li>
</ul>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb405-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb405-1" aria-hidden="true"></a>fit &lt;-<span class="st"> </span><span class="kw">train</span>(x_subset, y, <span class="dt">method =</span> <span class="st">&quot;knn&quot;</span>, <span class="dt">tuneGrid =</span> <span class="kw">data.frame</span>(<span class="dt">k =</span> <span class="kw">seq</span>(<span class="dv">101</span>, <span class="dv">301</span>, <span class="dv">5</span>)))</span>
<span id="cb405-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb405-2" aria-hidden="true"></a><span class="kw">ggplot</span>(fit)</span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>In the previous exercises, we see that despite the fact that <code>x</code> and <code>y</code> are completely independent, we were able to predict <code>y</code> with accuracy higher than 70%. We must be doing something wrong then.</li>
</ol>
<p>What is it?</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. The function <code>train()</code> estimates accuracy on the same data it uses to train the algorithm.</li>
<li><input type="checkbox" disabled="" />
B. We are overfitting the model by including 100 predictors.</li>
<li><input type="checkbox" disabled="" checked="" />
C. We used the entire dataset to select the columns used in the model.</li>
<li><input type="checkbox" disabled="" />
D. The high accuracy is just due to random variability.</li>
</ul>
<ol start="7" style="list-style-type: decimal">
<li>Use the <code>train()</code> function with kNN to select the best <code>k</code> for predicting tissue from gene expression on the <code>tissue_gene_expression</code> dataset from <strong>dslabs</strong>. Try <code>k = seq(1,7,2)</code> for tuning parameters. For this question, do not split the data into test and train sets (understand this can lead to overfitting, but ignore this for now).</li>
</ol>
<p>What value of <code>k</code> results in the highest accuracy?</p>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb406-1" aria-hidden="true"></a><span class="kw">data</span>(<span class="st">&quot;tissue_gene_expression&quot;</span>)</span>
<span id="cb406-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb406-2" aria-hidden="true"></a>fit &lt;-<span class="st"> </span><span class="kw">with</span>(tissue_gene_expression, <span class="kw">train</span>(x, y, <span class="dt">method =</span> <span class="st">&quot;knn&quot;</span>, <span class="dt">tuneGrid =</span> <span class="kw">data.frame</span>( <span class="dt">k =</span> <span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">2</span>))))</span>
<span id="cb406-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb406-3" aria-hidden="true"></a><span class="kw">ggplot</span>(fit)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-121-1.png" width="672" /></p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb407-1" aria-hidden="true"></a>fit<span class="op">$</span>results</span></code></pre></div>
<pre><code>##   k  Accuracy     Kappa AccuracySD    KappaSD
## 1 1 0.9910881 0.9892456 0.01127300 0.01349575
## 2 3 0.9820243 0.9781738 0.01389797 0.01683721
## 3 5 0.9806558 0.9765964 0.02484299 0.02995977
## 4 7 0.9720962 0.9660514 0.03007035 0.03650127</code></pre>
</div>
<div id="bootstrap" class="section level2" number="5.8">
<h2><span class="header-section-number">5.8</span> Bootstrap</h2>
<p>There is a link to the relevant section of the textbook: <a href="https://rafalab.github.io/dsbook/cross-validation.html#bootstrap" target="_blank">Bootstrap</a></p>
<p><strong>Key points</strong></p>
<ul>
<li>When we don’t have access to the entire population, we can use <strong>bootstrap</strong> to estimate the population median <span class="math inline">\(m\)</span>.</li>
<li>The bootstrap permits us to <strong>approximate a Monte Carlo simulation</strong> without access to the entire distribution. The general idea is relatively simple. We act as if the observed sample is the population. We then sample datasets (with replacement) of the same sample size as the original dataset. Then we compute the summary statistic, in this case the median, on this bootstrap sample.</li>
<li>Note that we can use ideas similar to those used in the bootstrap in <strong>cross validation</strong>: instead of dividing the data into equal partitions, we simply bootstrap many times.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb409-1" aria-hidden="true"></a>n &lt;-<span class="st"> </span><span class="dv">10</span><span class="op">^</span><span class="dv">6</span></span>
<span id="cb409-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb409-2" aria-hidden="true"></a>income &lt;-<span class="st"> </span><span class="dv">10</span><span class="op">^</span>(<span class="kw">rnorm</span>(n, <span class="kw">log10</span>(<span class="dv">45000</span>), <span class="kw">log10</span>(<span class="dv">3</span>)))</span>
<span id="cb409-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb409-3" aria-hidden="true"></a><span class="kw">qplot</span>(<span class="kw">log10</span>(income), <span class="dt">bins =</span> <span class="dv">30</span>, <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;black&quot;</span>))</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-122-1.png" width="672" /></p>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb410-1" aria-hidden="true"></a>m &lt;-<span class="st"> </span><span class="kw">median</span>(income)</span>
<span id="cb410-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb410-2" aria-hidden="true"></a>m</span></code></pre></div>
<pre><code>## [1] 44986.86</code></pre>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb412-1" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb412-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb412-2" aria-hidden="true"></a><span class="co">#use set.seed(1, sample.kind=&quot;Rounding&quot;) instead if using R 3.6 or later</span></span>
<span id="cb412-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb412-3" aria-hidden="true"></a>N &lt;-<span class="st"> </span><span class="dv">250</span></span>
<span id="cb412-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb412-4" aria-hidden="true"></a>X &lt;-<span class="st"> </span><span class="kw">sample</span>(income, N)</span>
<span id="cb412-5"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb412-5" aria-hidden="true"></a>M&lt;-<span class="st"> </span><span class="kw">median</span>(X)</span>
<span id="cb412-6"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb412-6" aria-hidden="true"></a>M</span></code></pre></div>
<pre><code>## [1] 47024.18</code></pre>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb414-1" aria-hidden="true"></a><span class="kw">library</span>(gridExtra)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;gridExtra&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     combine</code></pre>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb417-1" aria-hidden="true"></a>B &lt;-<span class="st"> </span><span class="dv">10</span><span class="op">^</span><span class="dv">5</span></span>
<span id="cb417-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb417-2" aria-hidden="true"></a>M &lt;-<span class="st"> </span><span class="kw">replicate</span>(B, {</span>
<span id="cb417-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb417-3" aria-hidden="true"></a>    X &lt;-<span class="st"> </span><span class="kw">sample</span>(income, N)</span>
<span id="cb417-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb417-4" aria-hidden="true"></a>    <span class="kw">median</span>(X)</span>
<span id="cb417-5"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb417-5" aria-hidden="true"></a>})</span>
<span id="cb417-6"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb417-6" aria-hidden="true"></a>p1 &lt;-<span class="st"> </span><span class="kw">qplot</span>(M, <span class="dt">bins =</span> <span class="dv">30</span>, <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;black&quot;</span>))</span>
<span id="cb417-7"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb417-7" aria-hidden="true"></a>p2 &lt;-<span class="st"> </span><span class="kw">qplot</span>(<span class="dt">sample =</span> <span class="kw">scale</span>(M)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_abline</span>()</span>
<span id="cb417-8"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb417-8" aria-hidden="true"></a><span class="kw">grid.arrange</span>(p1, p2, <span class="dt">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-122-2.png" width="672" /></p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb418-1" aria-hidden="true"></a><span class="kw">mean</span>(M)</span></code></pre></div>
<pre><code>## [1] 45132.14</code></pre>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb420-1" aria-hidden="true"></a><span class="kw">sd</span>(M)</span></code></pre></div>
<pre><code>## [1] 3912.368</code></pre>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb422-1" aria-hidden="true"></a>B &lt;-<span class="st"> </span><span class="dv">10</span><span class="op">^</span><span class="dv">5</span></span>
<span id="cb422-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb422-2" aria-hidden="true"></a>M_star &lt;-<span class="st"> </span><span class="kw">replicate</span>(B, {</span>
<span id="cb422-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb422-3" aria-hidden="true"></a>    X_star &lt;-<span class="st"> </span><span class="kw">sample</span>(X, N, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb422-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb422-4" aria-hidden="true"></a>    <span class="kw">median</span>(X_star)</span>
<span id="cb422-5"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb422-5" aria-hidden="true"></a>})</span>
<span id="cb422-6"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb422-6" aria-hidden="true"></a></span>
<span id="cb422-7"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb422-7" aria-hidden="true"></a><span class="kw">tibble</span>(<span class="dt">monte_carlo =</span> <span class="kw">sort</span>(M), <span class="dt">bootstrap =</span> <span class="kw">sort</span>(M_star)) <span class="op">%&gt;%</span></span>
<span id="cb422-8"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb422-8" aria-hidden="true"></a><span class="st">    </span><span class="kw">qplot</span>(monte_carlo, bootstrap, <span class="dt">data =</span> .) <span class="op">+</span><span class="st"> </span></span>
<span id="cb422-9"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb422-9" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_abline</span>()</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-122-3.png" width="672" /></p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb423-1" aria-hidden="true"></a><span class="kw">quantile</span>(M, <span class="kw">c</span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>))</span></code></pre></div>
<pre><code>##       5%      95% 
## 38996.50 51811.42</code></pre>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb425-1" aria-hidden="true"></a><span class="kw">quantile</span>(M_star, <span class="kw">c</span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>))</span></code></pre></div>
<pre><code>##       5%      95% 
## 37112.39 51462.43</code></pre>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb427-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb427-1" aria-hidden="true"></a><span class="kw">median</span>(X) <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(X) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(N) <span class="op">*</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 33154.08 60894.28</code></pre>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb429-1" aria-hidden="true"></a><span class="kw">mean</span>(M) <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(M) <span class="op">*</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 37463.90 52800.38</code></pre>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb431-1" aria-hidden="true"></a><span class="kw">mean</span>(M_star) <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(M_star) <span class="op">*</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 36913.52 53897.73</code></pre>
</div>
<div id="comprehension-check---bootstrap" class="section level2" number="5.9">
<h2><span class="header-section-number">5.9</span> Comprehension Check - Bootstrap</h2>
<ol style="list-style-type: decimal">
<li>The <code>createResample()</code> function can be used to create bootstrap samples. For example, we can create the indexes for 10 bootstrap samples for the <code>mnist_27</code> dataset like this:</li>
</ol>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb433-1" aria-hidden="true"></a><span class="kw">data</span>(mnist_<span class="dv">27</span>)</span>
<span id="cb433-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb433-2" aria-hidden="true"></a><span class="co"># set.seed(1995) # if R 3.5 or earlier</span></span>
<span id="cb433-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb433-3" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1995</span>, <span class="dt">sample.kind=</span><span class="st">&quot;Rounding&quot;</span>) <span class="co"># if R 3.6 or later</span></span></code></pre></div>
<pre><code>## Warning in set.seed(1995, sample.kind = &quot;Rounding&quot;): non-uniform &#39;Rounding&#39; sampler used</code></pre>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb435-1" aria-hidden="true"></a>indexes &lt;-<span class="st"> </span><span class="kw">createResample</span>(mnist_<span class="dv">27</span><span class="op">$</span>train<span class="op">$</span>y, <span class="dv">10</span>)</span></code></pre></div>
<p>How many times do 3, 4, and 7 appear in the first resampled index?</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb436-1" aria-hidden="true"></a><span class="kw">sum</span>(indexes[[<span class="dv">1</span>]] <span class="op">==</span><span class="st"> </span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb438-1" aria-hidden="true"></a><span class="kw">sum</span>(indexes[[<span class="dv">1</span>]] <span class="op">==</span><span class="st"> </span><span class="dv">4</span>)</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb440-1" aria-hidden="true"></a><span class="kw">sum</span>(indexes[[<span class="dv">1</span>]] <span class="op">==</span><span class="st"> </span><span class="dv">7</span>)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>We see that some numbers appear more than once and others appear no times. This has to be this way for each dataset to be independent. Repeat the exercise for all the resampled indexes.</li>
</ol>
<p>What is the total number of times that 3 appears in all of the resampled indexes?</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb442-1" aria-hidden="true"></a>x=<span class="kw">sapply</span>(indexes, <span class="cf">function</span>(ind){</span>
<span id="cb442-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb442-2" aria-hidden="true"></a>    <span class="kw">sum</span>(ind <span class="op">==</span><span class="st"> </span><span class="dv">3</span>)</span>
<span id="cb442-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb442-3" aria-hidden="true"></a>})</span>
<span id="cb442-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb442-4" aria-hidden="true"></a><span class="kw">sum</span>(x)</span></code></pre></div>
<pre><code>## [1] 11</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Generate a random dataset using the following code:</li>
</ol>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb444-1" aria-hidden="true"></a>y &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span></code></pre></div>
<p>Estimate the 75th quantile, which we know is <code>qnorm(0.75)</code>, with the sample quantile: <code>quantile(y, 0.75)</code>.</p>
<p>Now, set the seed to 1 and perform a Monte Carlo simulation with 10,000 repetitions, generating the random dataset and estimating the 75th quantile each time. What is the expected value and standard error of the 75th quantile?</p>
<p>Report all answers to at least 3 decimal digits.</p>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb445-1" aria-hidden="true"></a><span class="co"># set.seed(1) # # if R 3.5 or earlier</span></span>
<span id="cb445-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb445-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>, <span class="dt">sample.kind =</span> <span class="st">&quot;Rounding&quot;</span>) <span class="co"># if R 3.6 or later</span></span></code></pre></div>
<pre><code>## Warning in set.seed(1, sample.kind = &quot;Rounding&quot;): non-uniform &#39;Rounding&#39; sampler used</code></pre>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb447-1" aria-hidden="true"></a>B &lt;-<span class="st"> </span><span class="dv">10000</span></span>
<span id="cb447-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb447-2" aria-hidden="true"></a>q_<span class="dv">75</span> &lt;-<span class="st"> </span><span class="kw">replicate</span>(B, {</span>
<span id="cb447-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb447-3" aria-hidden="true"></a>    y &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb447-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb447-4" aria-hidden="true"></a>    <span class="kw">quantile</span>(y, <span class="fl">0.75</span>)</span>
<span id="cb447-5"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb447-5" aria-hidden="true"></a>})</span>
<span id="cb447-6"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb447-6" aria-hidden="true"></a></span>
<span id="cb447-7"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb447-7" aria-hidden="true"></a><span class="kw">mean</span>(q_<span class="dv">75</span>)</span></code></pre></div>
<pre><code>## [1] 0.6656107</code></pre>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb449-1" aria-hidden="true"></a><span class="kw">sd</span>(q_<span class="dv">75</span>)</span></code></pre></div>
<pre><code>## [1] 0.1353809</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>In practice, we can’t run a Monte Carlo simulation. Use the sample:</li>
</ol>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb451-1" aria-hidden="true"></a><span class="co"># set.seed(1) # if R 3.5 or earlier</span></span>
<span id="cb451-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb451-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>, <span class="dt">sample.kind =</span> <span class="st">&quot;Rounding&quot;</span>) <span class="co"># if R 3.6 or later</span></span></code></pre></div>
<pre><code>## Warning in set.seed(1, sample.kind = &quot;Rounding&quot;): non-uniform &#39;Rounding&#39; sampler used</code></pre>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb453-1" aria-hidden="true"></a>y &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span></code></pre></div>
<p>Set the seed to 1 again after generating <code>y</code> and use 10 bootstrap samples to estimate the expected value and standard error of the 75th quantile.</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb454-1" aria-hidden="true"></a><span class="co"># set.seed(1) # if R 3.5 or earlier</span></span>
<span id="cb454-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb454-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>, <span class="dt">sample.kind =</span> <span class="st">&quot;Rounding&quot;</span>) <span class="co"># if R 3.6 or later</span></span></code></pre></div>
<pre><code>## Warning in set.seed(1, sample.kind = &quot;Rounding&quot;): non-uniform &#39;Rounding&#39; sampler used</code></pre>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb456-1" aria-hidden="true"></a>y &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb456-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb456-2" aria-hidden="true"></a></span>
<span id="cb456-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb456-3" aria-hidden="true"></a><span class="co"># set.seed(1) # if R 3.5 or earlier</span></span>
<span id="cb456-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb456-4" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>, <span class="dt">sample.kind=</span><span class="st">&quot;Rounding&quot;</span>) <span class="co"># if R 3.6 or later</span></span></code></pre></div>
<pre><code>## Warning in set.seed(1, sample.kind = &quot;Rounding&quot;): non-uniform &#39;Rounding&#39; sampler used</code></pre>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb458-1" aria-hidden="true"></a>indexes &lt;-<span class="st"> </span><span class="kw">createResample</span>(y, <span class="dv">10</span>)</span>
<span id="cb458-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb458-2" aria-hidden="true"></a>q_<span class="dv">75</span>_star &lt;-<span class="st"> </span><span class="kw">sapply</span>(indexes, <span class="cf">function</span>(ind){</span>
<span id="cb458-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb458-3" aria-hidden="true"></a>    y_star &lt;-<span class="st"> </span>y[ind]</span>
<span id="cb458-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb458-4" aria-hidden="true"></a>    <span class="kw">quantile</span>(y_star, <span class="fl">0.75</span>)</span>
<span id="cb458-5"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb458-5" aria-hidden="true"></a>})</span>
<span id="cb458-6"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb458-6" aria-hidden="true"></a><span class="kw">mean</span>(q_<span class="dv">75</span>_star)</span></code></pre></div>
<pre><code>## [1] 0.7312648</code></pre>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb460-1" aria-hidden="true"></a><span class="kw">sd</span>(q_<span class="dv">75</span>_star)</span></code></pre></div>
<pre><code>## [1] 0.07419278</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Repeat the exercise from Q4 but with 10,000 bootstrap samples instead of 10. Set the seed to 1 first.</li>
</ol>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb462-1" aria-hidden="true"></a><span class="co"># set.seed(1) # # if R 3.5 or earlier</span></span>
<span id="cb462-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb462-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>, <span class="dt">sample.kind =</span> <span class="st">&quot;Rounding&quot;</span>) <span class="co"># if R 3.6 or later</span></span></code></pre></div>
<pre><code>## Warning in set.seed(1, sample.kind = &quot;Rounding&quot;): non-uniform &#39;Rounding&#39; sampler used</code></pre>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb464-1" aria-hidden="true"></a>indexes &lt;-<span class="st"> </span><span class="kw">createResample</span>(y, <span class="dv">10000</span>)</span>
<span id="cb464-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb464-2" aria-hidden="true"></a>q_<span class="dv">75</span>_star &lt;-<span class="st"> </span><span class="kw">sapply</span>(indexes, <span class="cf">function</span>(ind){</span>
<span id="cb464-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb464-3" aria-hidden="true"></a>    y_star &lt;-<span class="st"> </span>y[ind]</span>
<span id="cb464-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb464-4" aria-hidden="true"></a>    <span class="kw">quantile</span>(y_star, <span class="fl">0.75</span>)</span>
<span id="cb464-5"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb464-5" aria-hidden="true"></a>})</span>
<span id="cb464-6"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb464-6" aria-hidden="true"></a><span class="kw">mean</span>(q_<span class="dv">75</span>_star)</span></code></pre></div>
<pre><code>## [1] 0.6737512</code></pre>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb466-1" aria-hidden="true"></a><span class="kw">sd</span>(q_<span class="dv">75</span>_star)</span></code></pre></div>
<pre><code>## [1] 0.0930575</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>When doing bootstrap sampling, the simulated samples are drawn from the empirical distribution of the original data.</li>
</ol>
<p>True or False: The bootstrap is particularly useful in situations when we do not have access to the distribution or it is unknown.</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A. True</li>
<li><input type="checkbox" disabled="" />
B. False</li>
</ul>
</div>
<div id="generative-models" class="section level2" number="5.10">
<h2><span class="header-section-number">5.10</span> Generative Models</h2>
<p>There is a link to the relevant section of the textbook: <a href="https://rafalab.github.io/dsbook/examples-of-algorithms.html#generative-models" target="_blank">Generative models</a></p>
<p>**Key points</p>
<ul>
<li><strong>Discriminative approaches</strong> estimate the conditional probability directly and do not consider the distribution of the predictors.</li>
<li><strong>Generative models</strong> are methods that model the joint distribution and <span class="math inline">\(X\)</span> (we model how the entire data, <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, are generated).</li>
</ul>
</div>
<div id="naive-bayes" class="section level2" number="5.11">
<h2><span class="header-section-number">5.11</span> Naive Bayes</h2>
<p>There is a link to the relevant section of the textbook: <a href="https://rafalab.github.io/dsbook/examples-of-algorithms.html#naive-bayes" target="_blank">Naive Bayes</a></p>
<p><strong>Key points</strong></p>
<ul>
<li>Bayes’ rule:</li>
</ul>
<p><span class="math inline">\(p(x) = Pr(Y = 1|X = x) = \frac{f_{X|Y=1}(X)Pr(Y = 1)}{f_{X|Y=0}(X)Pr(Y = 0) + f_{X|Y=1}(X)Pr(Y = 1)}\)</span></p>
<p>with <span class="math inline">\(f_{X|Y=1}\)</span> and <span class="math inline">\(f_{X|Y=0}\)</span> representing the distribution functions of the predictor <span class="math inline">\(X\)</span> for the two classes <span class="math inline">\(Y=1\)</span> and <span class="math inline">\(Y=0\)</span>.</p>
<ul>
<li>The <strong>Naive Bayes</strong> approach is similar to the logistic regression prediction mathematically. However, we leave the demonstration to a more advanced text, such as <a href="https://web.stanford.edu/~hastie/Papers/ESLII.pdf" target="_blank">The Elements of Statistical Learning by Hastie, Tibshirani, and Friedman</a>.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb468-1" aria-hidden="true"></a><span class="co"># Generating train and test set</span></span>
<span id="cb468-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb468-2" aria-hidden="true"></a><span class="kw">data</span>(<span class="st">&quot;heights&quot;</span>)</span>
<span id="cb468-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb468-3" aria-hidden="true"></a>y &lt;-<span class="st"> </span>heights<span class="op">$</span>height</span>
<span id="cb468-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb468-4" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb468-5"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb468-5" aria-hidden="true"></a>test_index &lt;-<span class="st"> </span><span class="kw">createDataPartition</span>(y, <span class="dt">times =</span> <span class="dv">1</span>, <span class="dt">p =</span> <span class="fl">0.5</span>, <span class="dt">list =</span> <span class="ot">FALSE</span>)</span>
<span id="cb468-6"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb468-6" aria-hidden="true"></a>train_set &lt;-<span class="st"> </span>heights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(<span class="op">-</span>test_index)</span>
<span id="cb468-7"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb468-7" aria-hidden="true"></a>test_set &lt;-<span class="st"> </span>heights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(test_index)</span>
<span id="cb468-8"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb468-8" aria-hidden="true"></a></span>
<span id="cb468-9"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb468-9" aria-hidden="true"></a><span class="co"># Estimating averages and standard deviations</span></span>
<span id="cb468-10"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb468-10" aria-hidden="true"></a>params &lt;-<span class="st"> </span>train_set <span class="op">%&gt;%</span></span>
<span id="cb468-11"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb468-11" aria-hidden="true"></a><span class="st"> </span><span class="kw">group_by</span>(sex) <span class="op">%&gt;%</span></span>
<span id="cb468-12"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb468-12" aria-hidden="true"></a><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">avg =</span> <span class="kw">mean</span>(height), <span class="dt">sd =</span> <span class="kw">sd</span>(height))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb470-1" aria-hidden="true"></a>params</span></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   sex      avg    sd
##   &lt;fct&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1 Female  64.5  4.02
## 2 Male    69.3  3.52</code></pre>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb472-1" aria-hidden="true"></a><span class="co"># Estimating the prevalence</span></span>
<span id="cb472-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb472-2" aria-hidden="true"></a>pi &lt;-<span class="st"> </span>train_set <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">pi=</span><span class="kw">mean</span>(sex<span class="op">==</span><span class="st">&quot;Female&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(pi)</span>
<span id="cb472-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb472-3" aria-hidden="true"></a>pi</span></code></pre></div>
<pre><code>## [1] 0.2290076</code></pre>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb474-1" aria-hidden="true"></a><span class="co"># Getting an actual rule</span></span>
<span id="cb474-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb474-2" aria-hidden="true"></a>x &lt;-<span class="st"> </span>test_set<span class="op">$</span>height</span>
<span id="cb474-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb474-3" aria-hidden="true"></a>f0 &lt;-<span class="st"> </span><span class="kw">dnorm</span>(x, params<span class="op">$</span>avg[<span class="dv">2</span>], params<span class="op">$</span>sd[<span class="dv">2</span>])</span>
<span id="cb474-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb474-4" aria-hidden="true"></a>f1 &lt;-<span class="st"> </span><span class="kw">dnorm</span>(x, params<span class="op">$</span>avg[<span class="dv">1</span>], params<span class="op">$</span>sd[<span class="dv">1</span>])</span>
<span id="cb474-5"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb474-5" aria-hidden="true"></a>p_hat_bayes &lt;-<span class="st"> </span>f1<span class="op">*</span>pi <span class="op">/</span><span class="st"> </span>(f1<span class="op">*</span>pi <span class="op">+</span><span class="st"> </span>f0<span class="op">*</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>pi))</span></code></pre></div>
</div>
<div id="controlling-prevalence" class="section level2" number="5.12">
<h2><span class="header-section-number">5.12</span> Controlling Prevalence</h2>
<p>There is a link to the relevant section of the textbook: <a href="https://rafalab.github.io/dsbook/examples-of-algorithms.html#controlling-prevalence" target="_blank">Controlling prevalence</a></p>
<p><strong>Key points</strong></p>
<ul>
<li>The Naive Bayes approach includes a <strong>parameter to account for differences in prevalence</strong> <span class="math inline">\(\pi = Pr(Y = 1)\)</span>. If we use hats to denote the estimates, we can write <span class="math inline">\(\hat{p(x)}\)</span> as:</li>
</ul>
<p><span class="math inline">\(\hat{p}(x)= \frac{\hat{f}_{X|Y=1}(x) \hat{\pi}}{ \hat{f}_{X|Y=0}(x)(1-\hat{\pi}) + \hat{f}_{X|Y=1}(x)\hat{\pi} }\)</span></p>
<ul>
<li>The Naive Bayes approach gives us a direct way to correct the imbalance between sensitivity and specificity by simply forcing <span class="math inline">\(\hat{\pi}\)</span> to be whatever value we want it to be in order to better <strong>balance specificity and sensitivity</strong>.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb475-1" aria-hidden="true"></a><span class="co"># Computing sensitivity</span></span>
<span id="cb475-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb475-2" aria-hidden="true"></a>y_hat_bayes &lt;-<span class="st"> </span><span class="kw">ifelse</span>(p_hat_bayes <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>, <span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Male&quot;</span>)</span>
<span id="cb475-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb475-3" aria-hidden="true"></a><span class="kw">sensitivity</span>(<span class="dt">data =</span> <span class="kw">factor</span>(y_hat_bayes), <span class="dt">reference =</span> <span class="kw">factor</span>(test_set<span class="op">$</span>sex))</span></code></pre></div>
<pre><code>## [1] 0.2627119</code></pre>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb477-1" aria-hidden="true"></a><span class="co"># Computing specificity</span></span>
<span id="cb477-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb477-2" aria-hidden="true"></a><span class="kw">specificity</span>(<span class="dt">data =</span> <span class="kw">factor</span>(y_hat_bayes), <span class="dt">reference =</span> <span class="kw">factor</span>(test_set<span class="op">$</span>sex))</span></code></pre></div>
<pre><code>## [1] 0.9534314</code></pre>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb479-1" aria-hidden="true"></a><span class="co"># Changing the cutoff of the decision rule</span></span>
<span id="cb479-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb479-2" aria-hidden="true"></a>p_hat_bayes_unbiased &lt;-<span class="st"> </span>f1 <span class="op">*</span><span class="st"> </span><span class="fl">0.5</span> <span class="op">/</span><span class="st"> </span>(f1 <span class="op">*</span><span class="st"> </span><span class="fl">0.5</span> <span class="op">+</span><span class="st"> </span>f0 <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="fl">0.5</span>))</span>
<span id="cb479-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb479-3" aria-hidden="true"></a>y_hat_bayes_unbiased &lt;-<span class="st"> </span><span class="kw">ifelse</span>(p_hat_bayes_unbiased <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>, <span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Male&quot;</span>)</span>
<span id="cb479-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb479-4" aria-hidden="true"></a><span class="kw">sensitivity</span>(<span class="dt">data =</span> <span class="kw">factor</span>(y_hat_bayes_unbiased), <span class="dt">reference =</span> <span class="kw">factor</span>(test_set<span class="op">$</span>sex))</span></code></pre></div>
<pre><code>## [1] 0.7118644</code></pre>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb481-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb481-1" aria-hidden="true"></a><span class="kw">specificity</span>(<span class="dt">data =</span> <span class="kw">factor</span>(y_hat_bayes_unbiased), <span class="dt">reference =</span> <span class="kw">factor</span>(test_set<span class="op">$</span>sex))</span></code></pre></div>
<pre><code>## [1] 0.8210784</code></pre>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb483-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb483-1" aria-hidden="true"></a><span class="co"># Draw plot</span></span>
<span id="cb483-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb483-2" aria-hidden="true"></a><span class="kw">qplot</span>(x, p_hat_bayes_unbiased, <span class="dt">geom =</span> <span class="st">&quot;line&quot;</span>) <span class="op">+</span></span>
<span id="cb483-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb483-3" aria-hidden="true"></a><span class="st"> </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="fl">0.5</span>, <span class="dt">lty =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb483-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb483-4" aria-hidden="true"></a><span class="st"> </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">67</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-132-1.png" width="672" /></p>
</div>
<div id="qda-and-lda" class="section level2" number="5.13">
<h2><span class="header-section-number">5.13</span> qda and lda</h2>
<p>There is a link to the relevant sections of the textbook: <a href="https://rafalab.github.io/dsbook/examples-of-algorithms.html#quadratic-discriminant-analysis" target="_blank">Quadratic discriminant analysis</a> and <a href="https://rafalab.github.io/dsbook/examples-of-algorithms.html#linear-discriminant-analysis" target="_blank">Linear discriminant analysis</a></p>
<p><strong>Key points</strong></p>
<ul>
<li><strong>Quadratic discriminant analysis (QDA)</strong> is a version of Naive Bayes in which we assume that the distributions <span class="math inline">\(p_{X|Y=1}(x)\)</span> and <span class="math inline">\(p_{X|Y=0}(x)\)</span> are multivariate normal.</li>
<li>QDA can work well with a few predictors, but it becomes <strong>harder to use as the number of predictors increases</strong>. Once the number of parameters approaches the size of our data, the method becomes impractical due to overfitting.</li>
<li>Forcing the assumption that all predictors share the same standard deviations and correlations, the boundary will be a line, just as with logistic regression. For this reason, we call the method <strong>linear discriminant analysis (LDA)</strong>.</li>
<li>In the case of LDA, the lack of flexibility <strong>does not permit us to capture the non-linearity</strong> in the true conditional probability function.</li>
</ul>
<p><em>Code</em></p>
<p><strong>QDA</strong></p>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb484-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb484-1" aria-hidden="true"></a><span class="co"># Load data</span></span>
<span id="cb484-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb484-2" aria-hidden="true"></a><span class="kw">data</span>(<span class="st">&quot;mnist_27&quot;</span>)</span>
<span id="cb484-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb484-3" aria-hidden="true"></a></span>
<span id="cb484-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb484-4" aria-hidden="true"></a><span class="co"># Estimate parameters from the data</span></span>
<span id="cb484-5"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb484-5" aria-hidden="true"></a>params &lt;-<span class="st"> </span>mnist_<span class="dv">27</span><span class="op">$</span>train <span class="op">%&gt;%</span></span>
<span id="cb484-6"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb484-6" aria-hidden="true"></a><span class="st"> </span><span class="kw">group_by</span>(y) <span class="op">%&gt;%</span></span>
<span id="cb484-7"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb484-7" aria-hidden="true"></a><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">avg_1 =</span> <span class="kw">mean</span>(x_<span class="dv">1</span>), <span class="dt">avg_2 =</span> <span class="kw">mean</span>(x_<span class="dv">2</span>),</span>
<span id="cb484-8"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb484-8" aria-hidden="true"></a>        <span class="dt">sd_1 =</span> <span class="kw">sd</span>(x_<span class="dv">1</span>), <span class="dt">sd_2 =</span> <span class="kw">sd</span>(x_<span class="dv">2</span>),</span>
<span id="cb484-9"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb484-9" aria-hidden="true"></a>        <span class="dt">r =</span> <span class="kw">cor</span>(x_<span class="dv">1</span>, x_<span class="dv">2</span>))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb486-1" aria-hidden="true"></a><span class="co"># Contour plots</span></span>
<span id="cb486-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb486-2" aria-hidden="true"></a>mnist_<span class="dv">27</span><span class="op">$</span>train <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">y =</span> <span class="kw">factor</span>(y)) <span class="op">%&gt;%</span></span>
<span id="cb486-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb486-3" aria-hidden="true"></a><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(x_<span class="dv">1</span>, x_<span class="dv">2</span>, <span class="dt">fill =</span> y, <span class="dt">color =</span> y)) <span class="op">+</span></span>
<span id="cb486-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb486-4" aria-hidden="true"></a><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb486-5"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb486-5" aria-hidden="true"></a><span class="st"> </span><span class="kw">stat_ellipse</span>(<span class="dt">type=</span><span class="st">&quot;norm&quot;</span>, <span class="dt">lwd =</span> <span class="fl">1.5</span>)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-133-1.png" width="672" /></p>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb487-1" aria-hidden="true"></a><span class="co"># Fit model</span></span>
<span id="cb487-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb487-2" aria-hidden="true"></a><span class="kw">library</span>(caret)</span>
<span id="cb487-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb487-3" aria-hidden="true"></a>train_qda &lt;-<span class="st"> </span><span class="kw">train</span>(y <span class="op">~</span>., <span class="dt">method =</span> <span class="st">&quot;qda&quot;</span>, <span class="dt">data =</span> mnist_<span class="dv">27</span><span class="op">$</span>train)</span>
<span id="cb487-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb487-4" aria-hidden="true"></a><span class="co"># Obtain predictors and accuracy</span></span>
<span id="cb487-5"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb487-5" aria-hidden="true"></a>y_hat &lt;-<span class="st"> </span><span class="kw">predict</span>(train_qda, mnist_<span class="dv">27</span><span class="op">$</span>test)</span>
<span id="cb487-6"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb487-6" aria-hidden="true"></a><span class="kw">confusionMatrix</span>(<span class="dt">data =</span> y_hat, <span class="dt">reference =</span> mnist_<span class="dv">27</span><span class="op">$</span>test<span class="op">$</span>y)<span class="op">$</span>overall[<span class="st">&quot;Accuracy&quot;</span>]</span></code></pre></div>
<pre><code>## Accuracy 
##     0.82</code></pre>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb489-1" aria-hidden="true"></a><span class="co"># Draw separate plots for 2s and 7s</span></span>
<span id="cb489-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb489-2" aria-hidden="true"></a>mnist_<span class="dv">27</span><span class="op">$</span>train <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">y =</span> <span class="kw">factor</span>(y)) <span class="op">%&gt;%</span></span>
<span id="cb489-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb489-3" aria-hidden="true"></a><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(x_<span class="dv">1</span>, x_<span class="dv">2</span>, <span class="dt">fill =</span> y, <span class="dt">color =</span> y)) <span class="op">+</span></span>
<span id="cb489-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb489-4" aria-hidden="true"></a><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb489-5"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb489-5" aria-hidden="true"></a><span class="st"> </span><span class="kw">stat_ellipse</span>(<span class="dt">type=</span><span class="st">&quot;norm&quot;</span>) <span class="op">+</span></span>
<span id="cb489-6"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb489-6" aria-hidden="true"></a><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span>y)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-133-2.png" width="672" /></p>
<p><strong>LDA</strong></p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb490-1" aria-hidden="true"></a>params &lt;-<span class="st"> </span>mnist_<span class="dv">27</span><span class="op">$</span>train <span class="op">%&gt;%</span></span>
<span id="cb490-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb490-2" aria-hidden="true"></a><span class="st"> </span><span class="kw">group_by</span>(y) <span class="op">%&gt;%</span></span>
<span id="cb490-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb490-3" aria-hidden="true"></a><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">avg_1 =</span> <span class="kw">mean</span>(x_<span class="dv">1</span>), <span class="dt">avg_2 =</span> <span class="kw">mean</span>(x_<span class="dv">2</span>),</span>
<span id="cb490-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb490-4" aria-hidden="true"></a>        <span class="dt">sd_1 =</span> <span class="kw">sd</span>(x_<span class="dv">1</span>), <span class="dt">sd_2 =</span> <span class="kw">sd</span>(x_<span class="dv">2</span>),</span>
<span id="cb490-5"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb490-5" aria-hidden="true"></a>        <span class="dt">r =</span> <span class="kw">cor</span>(x_<span class="dv">1</span>, x_<span class="dv">2</span>))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb492-1" aria-hidden="true"></a>params &lt;-<span class="st"> </span>params <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">sd_1 =</span> <span class="kw">mean</span>(sd_<span class="dv">1</span>), <span class="dt">sd_2 =</span> <span class="kw">mean</span>(sd_<span class="dv">2</span>), <span class="dt">r =</span> <span class="kw">mean</span>(r))</span>
<span id="cb492-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb492-2" aria-hidden="true"></a>train_lda &lt;-<span class="st"> </span><span class="kw">train</span>(y <span class="op">~</span>., <span class="dt">method =</span> <span class="st">&quot;lda&quot;</span>, <span class="dt">data =</span> mnist_<span class="dv">27</span><span class="op">$</span>train)</span>
<span id="cb492-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb492-3" aria-hidden="true"></a>y_hat &lt;-<span class="st"> </span><span class="kw">predict</span>(train_lda, mnist_<span class="dv">27</span><span class="op">$</span>test)</span>
<span id="cb492-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb492-4" aria-hidden="true"></a><span class="kw">confusionMatrix</span>(<span class="dt">data =</span> y_hat, <span class="dt">reference =</span> mnist_<span class="dv">27</span><span class="op">$</span>test<span class="op">$</span>y)<span class="op">$</span>overall[<span class="st">&quot;Accuracy&quot;</span>]</span></code></pre></div>
<pre><code>## Accuracy 
##     0.75</code></pre>
</div>
<div id="case-study---more-than-three-classes" class="section level2" number="5.14">
<h2><span class="header-section-number">5.14</span> Case Study - More than Three Classes</h2>
<p>There is a link to the relevant section of the textbook: <a href="https://rafalab.github.io/dsbook/examples-of-algorithms.html#case-study-more-than-three-classes" target="_blank">Case study: more than three classes</a></p>
<p><strong>Key points</strong></p>
<ul>
<li>In this case study, we will briefly give a slightly more complex example: one with <strong>3 classes instead of 2</strong>. Then we will fit QDA, LDA, and KNN models for prediction.</li>
<li>Generative models can be very powerful, but only when we are able to <strong>successfully approximate the joint distribution</strong> of predictors conditioned on each class.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb494-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-1" aria-hidden="true"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw">exists</span>(<span class="st">&quot;mnist&quot;</span>))mnist &lt;-<span class="st"> </span><span class="kw">read_mnist</span>()</span>
<span id="cb494-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-2" aria-hidden="true"></a></span>
<span id="cb494-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-3" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">3456</span>)    <span class="co">#use set.seed(3456, sample.kind=&quot;Rounding&quot;) in R 3.6 or later</span></span>
<span id="cb494-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-4" aria-hidden="true"></a>index_<span class="dv">127</span> &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">which</span>(mnist<span class="op">$</span>train<span class="op">$</span>labels <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">7</span>)), <span class="dv">2000</span>)</span>
<span id="cb494-5"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-5" aria-hidden="true"></a>y &lt;-<span class="st"> </span>mnist<span class="op">$</span>train<span class="op">$</span>labels[index_<span class="dv">127</span>] </span>
<span id="cb494-6"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-6" aria-hidden="true"></a>x &lt;-<span class="st"> </span>mnist<span class="op">$</span>train<span class="op">$</span>images[index_<span class="dv">127</span>,]</span>
<span id="cb494-7"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-7" aria-hidden="true"></a>index_train &lt;-<span class="st"> </span><span class="kw">createDataPartition</span>(y, <span class="dt">p=</span><span class="fl">0.8</span>, <span class="dt">list =</span> <span class="ot">FALSE</span>)</span>
<span id="cb494-8"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-8" aria-hidden="true"></a></span>
<span id="cb494-9"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-9" aria-hidden="true"></a><span class="co"># get the quadrants</span></span>
<span id="cb494-10"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-10" aria-hidden="true"></a><span class="co"># temporary object to help figure out the quadrants</span></span>
<span id="cb494-11"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-11" aria-hidden="true"></a>row_column &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">row=</span><span class="dv">1</span><span class="op">:</span><span class="dv">28</span>, <span class="dt">col=</span><span class="dv">1</span><span class="op">:</span><span class="dv">28</span>)</span>
<span id="cb494-12"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-12" aria-hidden="true"></a>upper_left_ind &lt;-<span class="st"> </span><span class="kw">which</span>(row_column<span class="op">$</span>col <span class="op">&lt;=</span><span class="st"> </span><span class="dv">14</span> <span class="op">&amp;</span><span class="st"> </span>row_column<span class="op">$</span>row <span class="op">&lt;=</span><span class="st"> </span><span class="dv">14</span>)</span>
<span id="cb494-13"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-13" aria-hidden="true"></a>lower_right_ind &lt;-<span class="st"> </span><span class="kw">which</span>(row_column<span class="op">$</span>col <span class="op">&gt;</span><span class="st"> </span><span class="dv">14</span> <span class="op">&amp;</span><span class="st"> </span>row_column<span class="op">$</span>row <span class="op">&gt;</span><span class="st"> </span><span class="dv">14</span>)</span>
<span id="cb494-14"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-14" aria-hidden="true"></a></span>
<span id="cb494-15"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-15" aria-hidden="true"></a><span class="co"># binarize the values. Above 200 is ink, below is no ink</span></span>
<span id="cb494-16"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-16" aria-hidden="true"></a>x &lt;-<span class="st"> </span>x <span class="op">&gt;</span><span class="st"> </span><span class="dv">200</span> </span>
<span id="cb494-17"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-17" aria-hidden="true"></a></span>
<span id="cb494-18"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-18" aria-hidden="true"></a><span class="co"># cbind proportion of pixels in upper right quadrant and proportion of pixels in lower right quadrant</span></span>
<span id="cb494-19"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-19" aria-hidden="true"></a>x &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">rowSums</span>(x[ ,upper_left_ind])<span class="op">/</span><span class="kw">rowSums</span>(x),</span>
<span id="cb494-20"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-20" aria-hidden="true"></a>           <span class="kw">rowSums</span>(x[ ,lower_right_ind])<span class="op">/</span><span class="kw">rowSums</span>(x)) </span>
<span id="cb494-21"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-21" aria-hidden="true"></a></span>
<span id="cb494-22"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-22" aria-hidden="true"></a>train_set &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">y =</span> <span class="kw">factor</span>(y[index_train]),</span>
<span id="cb494-23"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-23" aria-hidden="true"></a>                        <span class="dt">x_1 =</span> x[index_train,<span class="dv">1</span>],</span>
<span id="cb494-24"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-24" aria-hidden="true"></a>                        <span class="dt">x_2 =</span> x[index_train,<span class="dv">2</span>])</span>
<span id="cb494-25"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-25" aria-hidden="true"></a></span>
<span id="cb494-26"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-26" aria-hidden="true"></a>test_set &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">y =</span> <span class="kw">factor</span>(y[<span class="op">-</span>index_train]),</span>
<span id="cb494-27"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-27" aria-hidden="true"></a>                       <span class="dt">x_1 =</span> x[<span class="op">-</span>index_train,<span class="dv">1</span>],</span>
<span id="cb494-28"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-28" aria-hidden="true"></a>                       <span class="dt">x_2 =</span> x[<span class="op">-</span>index_train,<span class="dv">2</span>])</span>
<span id="cb494-29"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-29" aria-hidden="true"></a></span>
<span id="cb494-30"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb494-30" aria-hidden="true"></a>train_set <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(x_<span class="dv">1</span>, x_<span class="dv">2</span>, <span class="dt">color=</span>y)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-135-1.png" width="672" /></p>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb495-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb495-1" aria-hidden="true"></a>train_qda &lt;-<span class="st"> </span><span class="kw">train</span>(y <span class="op">~</span><span class="st"> </span>., <span class="dt">method =</span> <span class="st">&quot;qda&quot;</span>, <span class="dt">data =</span> train_set)</span>
<span id="cb495-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb495-2" aria-hidden="true"></a><span class="kw">predict</span>(train_qda, test_set, <span class="dt">type =</span> <span class="st">&quot;prob&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</span></code></pre></div>
<pre><code>##            1         2          7
## 1 0.22232613 0.6596410 0.11803290
## 2 0.19256640 0.4535212 0.35391242
## 3 0.62749331 0.3220448 0.05046191
## 4 0.04623381 0.1008304 0.85293583
## 5 0.21671529 0.6229295 0.16035523
## 6 0.12669776 0.3349700 0.53833219</code></pre>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb497-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb497-1" aria-hidden="true"></a><span class="kw">predict</span>(train_qda, test_set) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</span></code></pre></div>
<pre><code>## [1] 2 2 1 7 2 7
## Levels: 1 2 7</code></pre>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb499-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb499-1" aria-hidden="true"></a><span class="kw">confusionMatrix</span>(<span class="kw">predict</span>(train_qda, test_set), test_set<span class="op">$</span>y)<span class="op">$</span>table</span></code></pre></div>
<pre><code>##           Reference
## Prediction   1   2   7
##          1 111  17   7
##          2  14  80  17
##          7  19  25 109</code></pre>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb501-1" aria-hidden="true"></a><span class="kw">confusionMatrix</span>(<span class="kw">predict</span>(train_qda, test_set), test_set<span class="op">$</span>y)<span class="op">$</span>overall[<span class="st">&quot;Accuracy&quot;</span>]</span></code></pre></div>
<pre><code>##  Accuracy 
## 0.7518797</code></pre>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb503-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb503-1" aria-hidden="true"></a>train_lda &lt;-<span class="st"> </span><span class="kw">train</span>(y <span class="op">~</span><span class="st"> </span>., <span class="dt">method =</span> <span class="st">&quot;lda&quot;</span>, <span class="dt">data =</span> train_set)</span>
<span id="cb503-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb503-2" aria-hidden="true"></a><span class="kw">confusionMatrix</span>(<span class="kw">predict</span>(train_lda, test_set), test_set<span class="op">$</span>y)<span class="op">$</span>overall[<span class="st">&quot;Accuracy&quot;</span>]</span></code></pre></div>
<pre><code>##  Accuracy 
## 0.6641604</code></pre>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb505-1" aria-hidden="true"></a>train_knn &lt;-<span class="st"> </span><span class="kw">train</span>(y <span class="op">~</span><span class="st"> </span>., <span class="dt">method =</span> <span class="st">&quot;knn&quot;</span>, <span class="dt">tuneGrid =</span> <span class="kw">data.frame</span>(<span class="dt">k =</span> <span class="kw">seq</span>(<span class="dv">15</span>, <span class="dv">51</span>, <span class="dv">2</span>)),</span>
<span id="cb505-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb505-2" aria-hidden="true"></a>    <span class="dt">data =</span> train_set)</span>
<span id="cb505-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb505-3" aria-hidden="true"></a><span class="kw">confusionMatrix</span>(<span class="kw">predict</span>(train_knn, test_set), test_set<span class="op">$</span>y)<span class="op">$</span>overall[<span class="st">&quot;Accuracy&quot;</span>]</span></code></pre></div>
<pre><code>##  Accuracy 
## 0.7719298</code></pre>
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb507-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb507-1" aria-hidden="true"></a>train_set <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">y =</span> <span class="kw">factor</span>(y)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(x_<span class="dv">1</span>, x_<span class="dv">2</span>, <span class="dt">fill =</span> y, <span class="dt">color=</span>y)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span><span class="kw">stat_ellipse</span>(<span class="dt">type=</span><span class="st">&quot;norm&quot;</span>)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-135-2.png" width="672" /></p>
</div>
<div id="comprehension-check---generative-models" class="section level2" number="5.15">
<h2><span class="header-section-number">5.15</span> Comprehension Check - Generative Models</h2>
<p>In the following exercises, we are going to apply LDA and QDA to the <code>tissue_gene_expression</code> dataset from <strong>dslabs</strong>. We will start with simple examples based on this dataset and then develop a realistic example.</p>
<ol style="list-style-type: decimal">
<li>Create a dataset of samples from just cerebellum and hippocampus, two parts of the brain, and a predictor matrix with 10 randomly selected columns using the following code:</li>
</ol>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb508-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb508-1" aria-hidden="true"></a><span class="kw">data</span>(<span class="st">&quot;tissue_gene_expression&quot;</span>)</span>
<span id="cb508-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb508-2" aria-hidden="true"></a>      </span>
<span id="cb508-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb508-3" aria-hidden="true"></a><span class="co"># set.seed(1993) #if using R 3.5 or earlier</span></span>
<span id="cb508-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb508-4" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1993</span>, <span class="dt">sample.kind=</span><span class="st">&quot;Rounding&quot;</span>) <span class="co"># if using R 3.6 or later</span></span></code></pre></div>
<pre><code>## Warning in set.seed(1993, sample.kind = &quot;Rounding&quot;): non-uniform &#39;Rounding&#39; sampler used</code></pre>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb510-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb510-1" aria-hidden="true"></a>ind &lt;-<span class="st"> </span><span class="kw">which</span>(tissue_gene_expression<span class="op">$</span>y <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;cerebellum&quot;</span>, <span class="st">&quot;hippocampus&quot;</span>))</span>
<span id="cb510-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb510-2" aria-hidden="true"></a>y &lt;-<span class="st"> </span><span class="kw">droplevels</span>(tissue_gene_expression<span class="op">$</span>y[ind])</span>
<span id="cb510-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb510-3" aria-hidden="true"></a>x &lt;-<span class="st"> </span>tissue_gene_expression<span class="op">$</span>x[ind, ]</span>
<span id="cb510-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb510-4" aria-hidden="true"></a>x &lt;-<span class="st"> </span>x[, <span class="kw">sample</span>(<span class="kw">ncol</span>(x), <span class="dv">10</span>)]</span></code></pre></div>
<p>Use the <code>train()</code> function to estimate the accuracy of LDA. For this question, use the version of <code>x</code> and <code>y</code> created with the code above: do not split them or <code>tissue_gene_expression</code> into training and test sets (understand this can lead to overfitting). Report the accuracy from the <code>train()</code> results (do not make predictions).</p>
<p>What is the accuracy? Enter your answer as a percentage or decimal (eg “50%” or “0.50”) to at least the thousandths place.</p>
<div class="sourceCode" id="cb511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb511-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb511-1" aria-hidden="true"></a>fit_lda &lt;-<span class="st"> </span><span class="kw">train</span>(x, y, <span class="dt">method =</span> <span class="st">&quot;lda&quot;</span>)</span>
<span id="cb511-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb511-2" aria-hidden="true"></a>fit_lda<span class="op">$</span>results[<span class="st">&quot;Accuracy&quot;</span>]</span></code></pre></div>
<pre><code>##    Accuracy
## 1 0.8707879</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>In this case, LDA fits two 10-dimensional normal distributions. Look at the fitted model by looking at the <code>finalModel</code> component of the result of <code>train()</code>. Notice there is a component called <code>means</code> that includes the estimated means of both distributions. Plot the mean vectors against each other and determine which predictors (genes) appear to be driving the algorithm.</li>
</ol>
<p>Which TWO genes appear to be driving the algorithm (i.e. the two genes with the highest means)?</p>
<div class="sourceCode" id="cb513"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb513-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb513-1" aria-hidden="true"></a><span class="kw">t</span>(fit_lda<span class="op">$</span>finalModel<span class="op">$</span>means) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb513-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb513-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">predictor_name =</span> <span class="kw">rownames</span>(.)) <span class="op">%&gt;%</span></span>
<span id="cb513-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb513-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(cerebellum, hippocampus, <span class="dt">label =</span> predictor_name)) <span class="op">+</span></span>
<span id="cb513-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb513-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb513-5"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb513-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_text</span>() <span class="op">+</span></span>
<span id="cb513-6"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb513-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_abline</span>()</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-138-1.png" width="672" /></p>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. PLCB1</li>
<li><input type="checkbox" disabled="" checked="" />
B. RAB1B</li>
<li><input type="checkbox" disabled="" />
C. MSH4</li>
<li><input type="checkbox" disabled="" checked="" />
D. OAZ2</li>
<li><input type="checkbox" disabled="" />
E. SPI1</li>
<li><input type="checkbox" disabled="" />
F. SAPCD1</li>
<li><input type="checkbox" disabled="" />
G. HEMK1</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Repeat the exercise in Q1 with QDA.</li>
</ol>
<p>Create a dataset of samples from just cerebellum and hippocampus, two parts of the brain, and a predictor matrix with 10 randomly selected columns using the following code:</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb514-1" aria-hidden="true"></a><span class="kw">data</span>(<span class="st">&quot;tissue_gene_expression&quot;</span>)</span>
<span id="cb514-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb514-2" aria-hidden="true"></a>      </span>
<span id="cb514-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb514-3" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1993</span>) <span class="co">#set.seed(1993, sample.kind=&quot;Rounding&quot;) if using R 3.6 or later</span></span>
<span id="cb514-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb514-4" aria-hidden="true"></a>ind &lt;-<span class="st"> </span><span class="kw">which</span>(tissue_gene_expression<span class="op">$</span>y <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;cerebellum&quot;</span>, <span class="st">&quot;hippocampus&quot;</span>))</span>
<span id="cb514-5"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb514-5" aria-hidden="true"></a>y &lt;-<span class="st"> </span><span class="kw">droplevels</span>(tissue_gene_expression<span class="op">$</span>y[ind])</span>
<span id="cb514-6"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb514-6" aria-hidden="true"></a>x &lt;-<span class="st"> </span>tissue_gene_expression<span class="op">$</span>x[ind, ]</span>
<span id="cb514-7"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb514-7" aria-hidden="true"></a>x &lt;-<span class="st"> </span>x[, <span class="kw">sample</span>(<span class="kw">ncol</span>(x), <span class="dv">10</span>)]</span></code></pre></div>
<p>Use the <code>train()</code> function to estimate the accuracy of QDA. For this question, use the version of <code>x</code> and <code>y</code> created above instead of the default from <code>tissue_gene_expression</code>. Do not split them into training and test sets (understand this can lead to overfitting).</p>
<p>What is the accuracy?</p>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb515-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb515-1" aria-hidden="true"></a>fit_qda &lt;-<span class="st"> </span><span class="kw">train</span>(x, y, <span class="dt">method =</span> <span class="st">&quot;qda&quot;</span>)</span>
<span id="cb515-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb515-2" aria-hidden="true"></a>fit_qda<span class="op">$</span>results[<span class="st">&quot;Accuracy&quot;</span>]</span></code></pre></div>
<pre><code>##    Accuracy
## 1 0.8147954</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Which TWO genes drive the algorithm when using QDA instead of LDA (i.e. the two genes with the highest means)?</li>
</ol>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb517-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb517-1" aria-hidden="true"></a><span class="kw">t</span>(fit_qda<span class="op">$</span>finalModel<span class="op">$</span>means) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb517-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb517-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">predictor_name =</span> <span class="kw">rownames</span>(.)) <span class="op">%&gt;%</span></span>
<span id="cb517-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb517-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(cerebellum, hippocampus, <span class="dt">label =</span> predictor_name)) <span class="op">+</span></span>
<span id="cb517-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb517-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb517-5"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb517-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_text</span>() <span class="op">+</span></span>
<span id="cb517-6"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb517-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_abline</span>()</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-141-1.png" width="672" /></p>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. PLCB1</li>
<li><input type="checkbox" disabled="" checked="" />
B. RAB1B</li>
<li><input type="checkbox" disabled="" />
C. MSH4</li>
<li><input type="checkbox" disabled="" checked="" />
D. OAZ2</li>
<li><input type="checkbox" disabled="" />
E. SPI1</li>
<li><input type="checkbox" disabled="" />
F. SAPCD1</li>
<li><input type="checkbox" disabled="" />
G. HEMK1</li>
</ul>
<ol start="5" style="list-style-type: decimal">
<li>One thing we saw in the previous plots is that the values of the predictors correlate in both groups: some predictors are low in both groups and others high in both groups. The mean value of each predictor found in <code>colMeans(x)</code> is not informative or useful for prediction and often for purposes of interpretation, it is useful to center or scale each column. This can be achieved with the <code>preProcess</code> argument in <code>train()</code>. Re-run LDA with <code>preProcess = "center"</code>. Note that accuracy does not change, but it is now easier to identify the predictors that differ more between groups than based on the plot made in Q2.</li>
</ol>
<p>Which TWO genes drive the algorithm after performing the scaling?</p>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb518-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb518-1" aria-hidden="true"></a>fit_lda &lt;-<span class="st"> </span><span class="kw">train</span>(x, y, <span class="dt">method =</span> <span class="st">&quot;lda&quot;</span>, <span class="dt">preProcess =</span> <span class="st">&quot;center&quot;</span>)</span>
<span id="cb518-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb518-2" aria-hidden="true"></a>fit_lda<span class="op">$</span>results[<span class="st">&quot;Accuracy&quot;</span>]</span></code></pre></div>
<pre><code>##    Accuracy
## 1 0.8595389</code></pre>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb520-1" aria-hidden="true"></a><span class="kw">t</span>(fit_lda<span class="op">$</span>finalModel<span class="op">$</span>means) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb520-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb520-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">predictor_name =</span> <span class="kw">rownames</span>(.)) <span class="op">%&gt;%</span></span>
<span id="cb520-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb520-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(predictor_name, hippocampus)) <span class="op">+</span></span>
<span id="cb520-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb520-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb520-5"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb520-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">coord_flip</span>()</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-142-1.png" width="672" /></p>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. C21orf62</li>
<li><input type="checkbox" disabled="" />
B. PLCB1</li>
<li><input type="checkbox" disabled="" />
C. RAB1B</li>
<li><input type="checkbox" disabled="" />
D. MSH4</li>
<li><input type="checkbox" disabled="" checked="" />
E. OAZ2</li>
<li><input type="checkbox" disabled="" checked="" />
F. SPI1</li>
<li><input type="checkbox" disabled="" />
G. SAPCD1</li>
<li><input type="checkbox" disabled="" />
H. IL18R1</li>
</ul>
<p>You can see that it is different genes driving the algorithm now. This is because the predictor means change.
In the previous exercises we saw that both LDA and QDA approaches worked well. For further exploration of the data, you can plot the predictor values for the two genes with the largest differences between the two groups in a scatter plot to see how they appear to follow a bivariate distribution as assumed by the LDA and QDA approaches, coloring the points by the outcome, using the following code:</p>
<div class="sourceCode" id="cb521"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb521-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb521-1" aria-hidden="true"></a>d &lt;-<span class="st"> </span><span class="kw">apply</span>(fit_lda<span class="op">$</span>finalModel<span class="op">$</span>means, <span class="dv">2</span>, diff)</span>
<span id="cb521-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb521-2" aria-hidden="true"></a>ind &lt;-<span class="st"> </span><span class="kw">order</span>(<span class="kw">abs</span>(d), <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]</span>
<span id="cb521-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb521-3" aria-hidden="true"></a><span class="kw">plot</span>(x[, ind], <span class="dt">col =</span> y)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-143-1.png" width="672" /></p>
<ol start="6" style="list-style-type: decimal">
<li>Now we are going to increase the complexity of the challenge slightly. Repeat the LDA analysis from Q5 but using all tissue types. Use the following code to create your dataset:</li>
</ol>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb522-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb522-1" aria-hidden="true"></a><span class="kw">data</span>(<span class="st">&quot;tissue_gene_expression&quot;</span>)</span>
<span id="cb522-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb522-2" aria-hidden="true"></a>           </span>
<span id="cb522-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb522-3" aria-hidden="true"></a><span class="co"># set.seed(1993) # if using R 3.5 or earlier</span></span>
<span id="cb522-4"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb522-4" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1993</span>, <span class="dt">sample.kind=</span><span class="st">&quot;Rounding&quot;</span>) <span class="co"># if using R 3.6 or later</span></span></code></pre></div>
<pre><code>## Warning in set.seed(1993, sample.kind = &quot;Rounding&quot;): non-uniform &#39;Rounding&#39; sampler used</code></pre>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb524-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb524-1" aria-hidden="true"></a>y &lt;-<span class="st"> </span>tissue_gene_expression<span class="op">$</span>y</span>
<span id="cb524-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb524-2" aria-hidden="true"></a>x &lt;-<span class="st"> </span>tissue_gene_expression<span class="op">$</span>x</span>
<span id="cb524-3"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb524-3" aria-hidden="true"></a>x &lt;-<span class="st"> </span>x[, <span class="kw">sample</span>(<span class="kw">ncol</span>(x), <span class="dv">10</span>)]</span></code></pre></div>
<p>What is the accuracy using LDA?</p>
<div class="sourceCode" id="cb525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb525-1"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb525-1" aria-hidden="true"></a>fit_lda &lt;-<span class="st"> </span><span class="kw">train</span>(x, y, <span class="dt">method =</span> <span class="st">&quot;lda&quot;</span>, <span class="dt">preProcess =</span> <span class="kw">c</span>(<span class="st">&quot;center&quot;</span>))</span>
<span id="cb525-2"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#cb525-2" aria-hidden="true"></a>fit_lda<span class="op">$</span>results[<span class="st">&quot;Accuracy&quot;</span>]</span></code></pre></div>
<pre><code>##    Accuracy
## 1 0.8194837</code></pre>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
