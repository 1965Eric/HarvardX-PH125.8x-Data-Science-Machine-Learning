<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Section 5 - Classification with More than Two Classes and the Caret Package | Data Science Machine Learning</title>
  <meta name="description" content="6 Section 5 - Classification with More than Two Classes and the Caret Package | Data Science Machine Learning" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Section 5 - Classification with More than Two Classes and the Caret Package | Data Science Machine Learning" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Section 5 - Classification with More than Two Classes and the Caret Package | Data Science Machine Learning" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="section-4-distance-knn-cross-validation-and-generative-models.html"/>
<link rel="next" href="section-6-model-fitting-and-recommendation-systems-overview.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="learning-objectives.html"><a href="learning-objectives.html"><i class="fa fa-check"></i><b>1</b> Learning Objectives</a>
<ul>
<li class="chapter" data-level="1.1" data-path="learning-objectives.html"><a href="learning-objectives.html#course-overview"><i class="fa fa-check"></i><b>1.1</b> Course Overview</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="learning-objectives.html"><a href="learning-objectives.html#introduction-to-machine-learning"><i class="fa fa-check"></i><b>1.1.1</b> Introduction to Machine Learning</a></li>
<li class="chapter" data-level="1.1.2" data-path="learning-objectives.html"><a href="learning-objectives.html#machine-learning-basics"><i class="fa fa-check"></i><b>1.1.2</b> Machine Learning Basics</a></li>
<li class="chapter" data-level="1.1.3" data-path="learning-objectives.html"><a href="learning-objectives.html#linear-regression-for-prediction-smoothing-and-working-with-matrices"><i class="fa fa-check"></i><b>1.1.3</b> Linear Regression for Prediction, Smoothing, and Working with Matrices</a></li>
<li class="chapter" data-level="1.1.4" data-path="learning-objectives.html"><a href="learning-objectives.html#distance-knn-cross-validation-and-generative-models"><i class="fa fa-check"></i><b>1.1.4</b> Distance, Knn, Cross Validation, and Generative Models</a></li>
<li class="chapter" data-level="1.1.5" data-path="learning-objectives.html"><a href="learning-objectives.html#classification-with-more-than-two-classes-and-the-caret-package"><i class="fa fa-check"></i><b>1.1.5</b> Classification with More than Two Classes and the Caret Package</a></li>
<li class="chapter" data-level="1.1.6" data-path="learning-objectives.html"><a href="learning-objectives.html#model-fitting-and-recommendation-systems"><i class="fa fa-check"></i><b>1.1.6</b> Model Fitting and Recommendation Systems</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="section-1-introduction-to-machine-learning-overview.html"><a href="section-1-introduction-to-machine-learning-overview.html"><i class="fa fa-check"></i><b>2</b> Section 1 - Introduction to Machine Learning Overview</a>
<ul>
<li class="chapter" data-level="2.1" data-path="section-1-introduction-to-machine-learning-overview.html"><a href="section-1-introduction-to-machine-learning-overview.html#notation"><i class="fa fa-check"></i><b>2.1</b> Notation</a></li>
<li class="chapter" data-level="2.2" data-path="section-1-introduction-to-machine-learning-overview.html"><a href="section-1-introduction-to-machine-learning-overview.html#an-example"><i class="fa fa-check"></i><b>2.2</b> An Example</a></li>
<li class="chapter" data-level="2.3" data-path="section-1-introduction-to-machine-learning-overview.html"><a href="section-1-introduction-to-machine-learning-overview.html#comprehension-check---introduction-to-machine-learning"><i class="fa fa-check"></i><b>2.3</b> Comprehension Check - Introduction to Machine Learning</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="section-2-machine-learning-basics-overview.html"><a href="section-2-machine-learning-basics-overview.html"><i class="fa fa-check"></i><b>3</b> Section 2 - Machine Learning Basics Overview</a>
<ul>
<li class="chapter" data-level="3.1" data-path="section-2-machine-learning-basics-overview.html"><a href="section-2-machine-learning-basics-overview.html#caret-package-training-and-test-sets-and-overall-accuracy"><i class="fa fa-check"></i><b>3.1</b> Caret package, training and test sets, and overall accuracy</a></li>
<li class="chapter" data-level="3.2" data-path="section-2-machine-learning-basics-overview.html"><a href="section-2-machine-learning-basics-overview.html#comprehension-check---basics-of-evaluating-machine-learning-algorithms"><i class="fa fa-check"></i><b>3.2</b> Comprehension Check - Basics of Evaluating Machine Learning Algorithms</a></li>
<li class="chapter" data-level="3.3" data-path="section-2-machine-learning-basics-overview.html"><a href="section-2-machine-learning-basics-overview.html#confusion-matrix"><i class="fa fa-check"></i><b>3.3</b> Confusion matrix</a></li>
<li class="chapter" data-level="3.4" data-path="section-2-machine-learning-basics-overview.html"><a href="section-2-machine-learning-basics-overview.html#balanced-accuracy-and-f1-score"><i class="fa fa-check"></i><b>3.4</b> Balanced accuracy and F1 score</a></li>
<li class="chapter" data-level="3.5" data-path="section-2-machine-learning-basics-overview.html"><a href="section-2-machine-learning-basics-overview.html#prevalence-matters-in-practice"><i class="fa fa-check"></i><b>3.5</b> Prevalence matters in practice</a></li>
<li class="chapter" data-level="3.6" data-path="section-2-machine-learning-basics-overview.html"><a href="section-2-machine-learning-basics-overview.html#roc-and-precision-recall-curves"><i class="fa fa-check"></i><b>3.6</b> ROC and precision-recall curves</a></li>
<li class="chapter" data-level="3.7" data-path="section-2-machine-learning-basics-overview.html"><a href="section-2-machine-learning-basics-overview.html#comprehension-check---practice-with-machine-learning-part-1"><i class="fa fa-check"></i><b>3.7</b> Comprehension Check - Practice with Machine Learning, Part 1</a></li>
<li class="chapter" data-level="3.8" data-path="section-2-machine-learning-basics-overview.html"><a href="section-2-machine-learning-basics-overview.html#comprehension-check---practice-with-machine-learning-part-2"><i class="fa fa-check"></i><b>3.8</b> Comprehension Check - Practice with Machine Learning, Part 2</a></li>
<li class="chapter" data-level="3.9" data-path="section-2-machine-learning-basics-overview.html"><a href="section-2-machine-learning-basics-overview.html#conditional-probabilities"><i class="fa fa-check"></i><b>3.9</b> Conditional probabilities</a></li>
<li class="chapter" data-level="3.10" data-path="section-2-machine-learning-basics-overview.html"><a href="section-2-machine-learning-basics-overview.html#conditional-expectations-and-loss-function"><i class="fa fa-check"></i><b>3.10</b> Conditional expectations and loss function</a></li>
<li class="chapter" data-level="3.11" data-path="section-2-machine-learning-basics-overview.html"><a href="section-2-machine-learning-basics-overview.html#comprehension-check---conditional-probabilities-part-1"><i class="fa fa-check"></i><b>3.11</b> Comprehension Check - Conditional Probabilities, Part 1</a></li>
<li class="chapter" data-level="3.12" data-path="section-2-machine-learning-basics-overview.html"><a href="section-2-machine-learning-basics-overview.html#comprehension-check---conditional-probabilities-part-2"><i class="fa fa-check"></i><b>3.12</b> Comprehension Check - Conditional Probabilities, Part 2</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><i class="fa fa-check"></i><b>4</b> Section 3 - Linear Regression for Prediction, Smoothing, and Working with Matrices Overview</a>
<ul>
<li class="chapter" data-level="4.1" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#linear-regression-for-prediction"><i class="fa fa-check"></i><b>4.1</b> Linear Regression for Prediction</a></li>
<li class="chapter" data-level="4.2" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#predict-function"><i class="fa fa-check"></i><b>4.2</b> Predict Function</a></li>
<li class="chapter" data-level="4.3" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#comprehension-check---linear-regression"><i class="fa fa-check"></i><b>4.3</b> Comprehension Check - Linear Regression</a></li>
<li class="chapter" data-level="4.4" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#regression-for-a-categorical-outcome"><i class="fa fa-check"></i><b>4.4</b> Regression for a Categorical Outcome</a></li>
<li class="chapter" data-level="4.5" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#logistic-regression"><i class="fa fa-check"></i><b>4.5</b> Logistic Regression</a></li>
<li class="chapter" data-level="4.6" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#case-study-2-or-7"><i class="fa fa-check"></i><b>4.6</b> Case Study: 2 or 7</a></li>
<li class="chapter" data-level="4.7" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#comprehension-check---logistic-regression"><i class="fa fa-check"></i><b>4.7</b> Comprehension Check - Logistic Regression</a></li>
<li class="chapter" data-level="4.8" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#introduction-to-smoothing"><i class="fa fa-check"></i><b>4.8</b> Introduction to Smoothing</a></li>
<li class="chapter" data-level="4.9" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#bin-smoothing-and-kernels"><i class="fa fa-check"></i><b>4.9</b> Bin Smoothing and Kernels</a></li>
<li class="chapter" data-level="4.10" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#local-weighted-regression-loess"><i class="fa fa-check"></i><b>4.10</b> Local Weighted Regression (loess)</a></li>
<li class="chapter" data-level="4.11" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#comprehension-check---smoothing"><i class="fa fa-check"></i><b>4.11</b> Comprehension Check - Smoothing</a></li>
<li class="chapter" data-level="4.12" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#matrices"><i class="fa fa-check"></i><b>4.12</b> Matrices</a></li>
<li class="chapter" data-level="4.13" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#matrix-notation"><i class="fa fa-check"></i><b>4.13</b> Matrix Notation</a></li>
<li class="chapter" data-level="4.14" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#converting-a-vector-to-a-matrix"><i class="fa fa-check"></i><b>4.14</b> Converting a Vector to a Matrix</a></li>
<li class="chapter" data-level="4.15" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#row-and-column-summaries-and-apply"><i class="fa fa-check"></i><b>4.15</b> Row and Column Summaries and Apply</a></li>
<li class="chapter" data-level="4.16" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#filtering-columns-based-on-summaries"><i class="fa fa-check"></i><b>4.16</b> Filtering Columns Based on Summaries</a></li>
<li class="chapter" data-level="4.17" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#indexing-with-matrices-and-binarizing-the-data"><i class="fa fa-check"></i><b>4.17</b> Indexing with Matrices and Binarizing the Data</a></li>
<li class="chapter" data-level="4.18" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#vectorization-for-matrices-and-matrix-algebra-operations"><i class="fa fa-check"></i><b>4.18</b> Vectorization for Matrices and Matrix Algebra Operations</a></li>
<li class="chapter" data-level="4.19" data-path="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html"><a href="section-3-linear-regression-for-prediction-smoothing-and-working-with-matrices-overview.html#comprehension-check---working-with-matrices"><i class="fa fa-check"></i><b>4.19</b> Comprehension Check - Working with Matrices</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html"><i class="fa fa-check"></i><b>5</b> Section 4 - Distance, Knn, Cross Validation, and Generative Models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#distance"><i class="fa fa-check"></i><b>5.1</b> Distance</a></li>
<li class="chapter" data-level="5.2" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#comprehension-check---distance"><i class="fa fa-check"></i><b>5.2</b> Comprehension Check - Distance</a></li>
<li class="chapter" data-level="5.3" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#knn"><i class="fa fa-check"></i><b>5.3</b> Knn</a></li>
<li class="chapter" data-level="5.4" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#over-training-and-over-smoothing"><i class="fa fa-check"></i><b>5.4</b> Over-training and Over-smoothing</a></li>
<li class="chapter" data-level="5.5" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#comprehension-check---nearest-neighbors"><i class="fa fa-check"></i><b>5.5</b> Comprehension Check - Nearest Neighbors</a></li>
<li class="chapter" data-level="5.6" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#k-fold-cross-validation"><i class="fa fa-check"></i><b>5.6</b> K-fold cross validation</a></li>
<li class="chapter" data-level="5.7" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#comprehension-check---cross-validation"><i class="fa fa-check"></i><b>5.7</b> Comprehension Check - Cross-validation</a></li>
<li class="chapter" data-level="5.8" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#bootstrap"><i class="fa fa-check"></i><b>5.8</b> Bootstrap</a></li>
<li class="chapter" data-level="5.9" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#comprehension-check---bootstrap"><i class="fa fa-check"></i><b>5.9</b> Comprehension Check - Bootstrap</a></li>
<li class="chapter" data-level="5.10" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#generative-models"><i class="fa fa-check"></i><b>5.10</b> Generative Models</a></li>
<li class="chapter" data-level="5.11" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#naive-bayes"><i class="fa fa-check"></i><b>5.11</b> Naive Bayes</a></li>
<li class="chapter" data-level="5.12" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#controlling-prevalence"><i class="fa fa-check"></i><b>5.12</b> Controlling Prevalence</a></li>
<li class="chapter" data-level="5.13" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#qda-and-lda"><i class="fa fa-check"></i><b>5.13</b> qda and lda</a></li>
<li class="chapter" data-level="5.14" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#case-study---more-than-three-classes"><i class="fa fa-check"></i><b>5.14</b> Case Study - More than Three Classes</a></li>
<li class="chapter" data-level="5.15" data-path="section-4-distance-knn-cross-validation-and-generative-models.html"><a href="section-4-distance-knn-cross-validation-and-generative-models.html#comprehension-check---generative-models"><i class="fa fa-check"></i><b>5.15</b> Comprehension Check - Generative Models</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="section-5-classification-with-more-than-two-classes-and-the-caret-package.html"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html"><i class="fa fa-check"></i><b>6</b> Section 5 - Classification with More than Two Classes and the Caret Package</a>
<ul>
<li class="chapter" data-level="6.1" data-path="section-5-classification-with-more-than-two-classes-and-the-caret-package.html"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#trees-motivation"><i class="fa fa-check"></i><b>6.1</b> Trees Motivation</a></li>
<li class="chapter" data-level="6.2" data-path="section-5-classification-with-more-than-two-classes-and-the-caret-package.html"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#classification-and-regression-trees-cart"><i class="fa fa-check"></i><b>6.2</b> Classification and Regression Trees (CART)</a></li>
<li class="chapter" data-level="6.3" data-path="section-5-classification-with-more-than-two-classes-and-the-caret-package.html"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#classification-decision-trees"><i class="fa fa-check"></i><b>6.3</b> Classification (Decision) Trees</a></li>
<li class="chapter" data-level="6.4" data-path="section-5-classification-with-more-than-two-classes-and-the-caret-package.html"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#random-forests"><i class="fa fa-check"></i><b>6.4</b> Random Forests</a></li>
<li class="chapter" data-level="6.5" data-path="section-5-classification-with-more-than-two-classes-and-the-caret-package.html"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#comprehension-check---trees-and-random-forests"><i class="fa fa-check"></i><b>6.5</b> Comprehension Check - Trees and Random Forests</a></li>
<li class="chapter" data-level="6.6" data-path="section-5-classification-with-more-than-two-classes-and-the-caret-package.html"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#caret-package"><i class="fa fa-check"></i><b>6.6</b> Caret Package</a></li>
<li class="chapter" data-level="6.7" data-path="section-5-classification-with-more-than-two-classes-and-the-caret-package.html"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#tuning-parameters-with-caret"><i class="fa fa-check"></i><b>6.7</b> Tuning Parameters with Caret</a></li>
<li class="chapter" data-level="6.8" data-path="section-5-classification-with-more-than-two-classes-and-the-caret-package.html"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#comprehension-check---caret-package"><i class="fa fa-check"></i><b>6.8</b> Comprehension Check - Caret Package</a></li>
<li class="chapter" data-level="6.9" data-path="section-5-classification-with-more-than-two-classes-and-the-caret-package.html"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#titanic-exercises---part-1"><i class="fa fa-check"></i><b>6.9</b> Titanic Exercises - Part 1</a></li>
<li class="chapter" data-level="6.10" data-path="section-5-classification-with-more-than-two-classes-and-the-caret-package.html"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#titanic-exercises---part-2"><i class="fa fa-check"></i><b>6.10</b> Titanic Exercises - Part 2</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html"><i class="fa fa-check"></i><b>7</b> Section 6 - Model Fitting and Recommendation Systems Overview</a>
<ul>
<li class="chapter" data-level="7.1" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#case-study-mnist"><i class="fa fa-check"></i><b>7.1</b> Case Study: MNIST</a></li>
<li class="chapter" data-level="7.2" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#preprocessing-mnist-data"><i class="fa fa-check"></i><b>7.2</b> Preprocessing MNIST Data</a></li>
<li class="chapter" data-level="7.3" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#model-fitting-for-mnist-data"><i class="fa fa-check"></i><b>7.3</b> Model Fitting for MNIST Data</a></li>
<li class="chapter" data-level="7.4" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#variable-importance"><i class="fa fa-check"></i><b>7.4</b> Variable Importance</a></li>
<li class="chapter" data-level="7.5" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#ensembles"><i class="fa fa-check"></i><b>7.5</b> Ensembles</a></li>
<li class="chapter" data-level="7.6" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#comprehension-check---ensembles"><i class="fa fa-check"></i><b>7.6</b> Comprehension Check - Ensembles</a></li>
<li class="chapter" data-level="7.7" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#recommendation-systems"><i class="fa fa-check"></i><b>7.7</b> Recommendation Systems</a></li>
<li class="chapter" data-level="7.8" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#building-the-recommendation-system"><i class="fa fa-check"></i><b>7.8</b> Building the Recommendation System</a></li>
<li class="chapter" data-level="7.9" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#comprehension-check---recommendation-systems"><i class="fa fa-check"></i><b>7.9</b> Comprehension Check - Recommendation Systems</a></li>
<li class="chapter" data-level="7.10" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#regularization"><i class="fa fa-check"></i><b>7.10</b> Regularization</a></li>
<li class="chapter" data-level="7.11" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#comprehension-check---regularization"><i class="fa fa-check"></i><b>7.11</b> Comprehension Check - Regularization</a></li>
<li class="chapter" data-level="7.12" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#matrix-factorization"><i class="fa fa-check"></i><b>7.12</b> Matrix Factorization</a></li>
<li class="chapter" data-level="7.13" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#svd-and-pca"><i class="fa fa-check"></i><b>7.13</b> SVD and PCA</a></li>
<li class="chapter" data-level="7.14" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#comprehension-check---matrix-factorization"><i class="fa fa-check"></i><b>7.14</b> Comprehension Check - Matrix Factorization</a></li>
<li class="chapter" data-level="7.15" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#comprehension-check---dimension-reduction"><i class="fa fa-check"></i><b>7.15</b> Comprehension Check - Dimension Reduction</a></li>
<li class="chapter" data-level="7.16" data-path="section-6-model-fitting-and-recommendation-systems-overview.html"><a href="section-6-model-fitting-and-recommendation-systems-overview.html#comprehension-check---clustering"><i class="fa fa-check"></i><b>7.16</b> Comprehension Check - Clustering</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="section-7-final-assessment.html"><a href="section-7-final-assessment.html"><i class="fa fa-check"></i><b>8</b> Section 7 - Final Assessment</a>
<ul>
<li class="chapter" data-level="8.1" data-path="section-7-final-assessment.html"><a href="section-7-final-assessment.html#breast-cancer-project---part-1"><i class="fa fa-check"></i><b>8.1</b> Breast Cancer Project - Part 1</a></li>
<li class="chapter" data-level="8.2" data-path="section-7-final-assessment.html"><a href="section-7-final-assessment.html#breast-cancer-project---part-2"><i class="fa fa-check"></i><b>8.2</b> Breast Cancer Project - Part 2</a></li>
<li class="chapter" data-level="8.3" data-path="section-7-final-assessment.html"><a href="section-7-final-assessment.html#breast-cancer-project---part-3"><i class="fa fa-check"></i><b>8.3</b> Breast Cancer Project - Part 3</a></li>
<li class="chapter" data-level="8.4" data-path="section-7-final-assessment.html"><a href="section-7-final-assessment.html#breast-cancer-project---part-4"><i class="fa fa-check"></i><b>8.4</b> Breast Cancer Project - Part 4</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Science Machine Learning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="section-5---classification-with-more-than-two-classes-and-the-caret-package" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Section 5 - Classification with More than Two Classes and the Caret Package</h1>
<p>In the <strong>Classification with More than Two Classes and the Caret Package</strong> section, you will learn how to overcome the curse of dimensionality using methods that adapt to higher dimensions and how to use the caret package to implement many different machine learning algorithms.</p>
<p>After completing this section, you will be able to:</p>
<ul>
<li>Use <strong>classification and regression trees</strong>.</li>
<li>Use <strong>classification (decision) trees</strong>.</li>
<li>Apply <strong>random forests</strong> to address the shortcomings of decision trees.</li>
<li>Use the <strong>caret</strong> package to implement a variety of machine learning algorithms.</li>
</ul>
<p>This section has three parts: <strong>classification with more than two classes, caret package</strong>, and a <strong>set of exercises</strong> on the Titanic.</p>
<div id="trees-motivation" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Trees Motivation</h2>
<p>There is a link to the relevant section of the textbook: <a href="https://rafalab.github.io/dsbook/examples-of-algorithms.html#the-curse-of-dimensionality" target="_blank">The curse of dimensionality</a></p>
<p><strong>Key points</strong></p>
<ul>
<li>LDA and QDA are not <strong>meant to be used with many predictors <span class="math inline">\(p\)</span></strong> because the number of parameters needed to be estimated becomes too large.</li>
<li><strong>Curse of dimensionality:</strong> For kernel methods such as kNN or local regression, when they have multiple predictors used, the span/neighborhood/window made to include a given percentage of the data become large. With larger neighborhoods, our methods lose flexibility. The dimension here refers to the fact that when we have <span class="math inline">\(p\)</span> predictors, the distance between two observations is computed in <span class="math inline">\(p\)</span>-dimensional space.</li>
</ul>
</div>
<div id="classification-and-regression-trees-cart" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Classification and Regression Trees (CART)</h2>
<p>There is a link to the relevant sections of the textbook: <a href="https://rafalab.github.io/dsbook/examples-of-algorithms.html#cart-motivation" target="_blank">CART motivation</a> and <a href="https://rafalab.github.io/dsbook/examples-of-algorithms.html#regression-trees" target="_blank">Regression trees</a></p>
<p><strong>Key points</strong></p>
<ul>
<li>A tree is basically a <strong>flow chart of yes or no questions</strong>. The general idea of the methods we are describing is to define an algorithm that uses data to create these trees with predictions at the ends, referred to as nodes.</li>
<li>When the outcome is continuous, we call the decision tree method a <strong>regression tree</strong>.</li>
<li>Regression and decision trees operate by predicting an outcome variable <span class="math inline">\(Y\)</span> by <strong>partitioning the predictors</strong>.</li>
<li>The general idea here is to <strong>build a decision tree</strong> and, at end of each node, obtain a predictor <span class="math inline">\(\hat{y}\)</span>. Mathematically, we are <strong>partitioning the predictor space</strong> into <span class="math inline">\(J\)</span> non-overlapping regions, <span class="math inline">\(R_{1}\)</span>, <span class="math inline">\(R_{2}\)</span>, …, <span class="math inline">\(R_{J}\)</span> and then for any predictor <span class="math inline">\(x\)</span> that falls within region <span class="math inline">\(R_{j}\)</span>, estimate <span class="math inline">\(f(x)\)</span> with the average of the training observations <span class="math inline">\(y_{i}\)</span> for which the associated predictor <span class="math inline">\(x_{i}\)</span> in also in <span class="math inline">\(R_{j}\)</span>.</li>
<li>To pick <span class="math inline">\(j\)</span> and its value <span class="math inline">\(s\)</span>, we find the pair that <strong>minimizes the residual sum of squares (RSS)</strong>:</li>
</ul>
<p><span class="math inline">\(\sum_{i: x_{i}R_{1}(j,s)}(y_{i} - \hat{y}_{R_{1}})^2 + \sum_{i: x_{i}R_{2}(j,s)}(y_{i} - \hat{y}_{R_{2}})^2\)</span></p>
<ul>
<li>To fit the regression tree model, we can use the <code>rpart()</code> function in the <strong>rpart</strong> package.</li>
<li>Two common parameters used for partition decision are the <strong>complexity parameter</strong> (<code>cp</code>) and the <strong>minimum number of observations required in a partition</strong> before partitioning it further (<code>minsplit</code> in the <strong>rpart</strong> package).</li>
<li>If we already have a tree and want to apply a higher <code>cp</code> value, we can use the <code>prune()</code> function. We call this pruning a tree because we are snipping off partitions that do not meet a cp criterion.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb527"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb527-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb527-1" aria-hidden="true"></a><span class="co"># Load data</span></span>
<span id="cb527-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb527-2" aria-hidden="true"></a><span class="kw">data</span>(<span class="st">&quot;olive&quot;</span>)</span>
<span id="cb527-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb527-3" aria-hidden="true"></a>olive <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 572 x 10
##    region         area         palmitic palmitoleic stearic oleic linoleic linolenic arachidic eicosenoic
##    &lt;fct&gt;          &lt;fct&gt;           &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
##  1 Southern Italy North-Apulia    10.8        0.75     2.26  78.2     6.72      0.36      0.6       0.290
##  2 Southern Italy North-Apulia    10.9        0.73     2.24  77.1     7.81      0.31      0.61      0.290
##  3 Southern Italy North-Apulia     9.11       0.54     2.46  81.1     5.49      0.31      0.63      0.290
##  4 Southern Italy North-Apulia     9.66       0.570    2.4   79.5     6.19      0.5       0.78      0.35 
##  5 Southern Italy North-Apulia    10.5        0.67     2.59  77.7     6.72      0.5       0.8       0.46 
##  6 Southern Italy North-Apulia     9.11       0.49     2.68  79.2     6.78      0.51      0.7       0.44 
##  7 Southern Italy North-Apulia     9.22       0.66     2.64  79.9     6.18      0.49      0.56      0.290
##  8 Southern Italy North-Apulia    11          0.61     2.35  77.3     7.34      0.39      0.64      0.35 
##  9 Southern Italy North-Apulia    10.8        0.6      2.39  77.4     7.09      0.46      0.83      0.33 
## 10 Southern Italy North-Apulia    10.4        0.55     2.13  79.4     6.33      0.26      0.52      0.3  
## # … with 562 more rows</code></pre>
<div class="sourceCode" id="cb529"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb529-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb529-1" aria-hidden="true"></a><span class="kw">table</span>(olive<span class="op">$</span>region)</span></code></pre></div>
<pre><code>## 
## Northern Italy       Sardinia Southern Italy 
##            151             98            323</code></pre>
<div class="sourceCode" id="cb531"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb531-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb531-1" aria-hidden="true"></a>olive &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(olive, <span class="op">-</span>area)</span>
<span id="cb531-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb531-2" aria-hidden="true"></a></span>
<span id="cb531-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb531-3" aria-hidden="true"></a><span class="co"># Predict region using KNN</span></span>
<span id="cb531-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb531-4" aria-hidden="true"></a>fit &lt;-<span class="st"> </span><span class="kw">train</span>(region <span class="op">~</span><span class="st"> </span>.,  <span class="dt">method =</span> <span class="st">&quot;knn&quot;</span>, </span>
<span id="cb531-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb531-5" aria-hidden="true"></a>             <span class="dt">tuneGrid =</span> <span class="kw">data.frame</span>(<span class="dt">k =</span> <span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">15</span>, <span class="dv">2</span>)), </span>
<span id="cb531-6"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb531-6" aria-hidden="true"></a>             <span class="dt">data =</span> olive)</span>
<span id="cb531-7"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb531-7" aria-hidden="true"></a><span class="kw">ggplot</span>(fit)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-146-1.png" width="672" /></p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb532-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb532-1" aria-hidden="true"></a><span class="co"># Plot distribution of each predictor stratified by region</span></span>
<span id="cb532-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb532-2" aria-hidden="true"></a>olive <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(fatty_acid, percentage, <span class="op">-</span>region) <span class="op">%&gt;%</span></span>
<span id="cb532-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb532-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(region, percentage, <span class="dt">fill =</span> region)) <span class="op">+</span></span>
<span id="cb532-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb532-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span></span>
<span id="cb532-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb532-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>fatty_acid, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span></span>
<span id="cb532-6"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb532-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_blank</span>())</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-146-2.png" width="672" /></p>
<div class="sourceCode" id="cb533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb533-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb533-1" aria-hidden="true"></a><span class="co"># plot values for eicosenoic and linoleic</span></span>
<span id="cb533-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb533-2" aria-hidden="true"></a>p &lt;-<span class="st"> </span>olive <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb533-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb533-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(eicosenoic, linoleic, <span class="dt">color =</span> region)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb533-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb533-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>()</span>
<span id="cb533-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb533-5" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="fl">0.065</span>, <span class="dt">lty =</span> <span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb533-6"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb533-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_segment</span>(<span class="dt">x =</span> <span class="fl">-0.2</span>, <span class="dt">y =</span> <span class="fl">10.54</span>, <span class="dt">xend =</span> <span class="fl">0.065</span>, <span class="dt">yend =</span> <span class="fl">10.54</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-146-3.png" width="672" /></p>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb534-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb534-1" aria-hidden="true"></a><span class="co"># load data for regression tree</span></span>
<span id="cb534-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb534-2" aria-hidden="true"></a><span class="kw">data</span>(<span class="st">&quot;polls_2008&quot;</span>)</span>
<span id="cb534-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb534-3" aria-hidden="true"></a><span class="kw">qplot</span>(day, margin, <span class="dt">data =</span> polls_<span class="dv">2008</span>)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-146-4.png" width="672" /></p>
<div class="sourceCode" id="cb535"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb535-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb535-1" aria-hidden="true"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw">require</span>(rpart)) <span class="kw">install.packages</span>(<span class="st">&quot;rpart&quot;</span>)</span></code></pre></div>
<pre><code>## Loading required package: rpart</code></pre>
<div class="sourceCode" id="cb537"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb537-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb537-1" aria-hidden="true"></a><span class="kw">library</span>(rpart)</span>
<span id="cb537-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb537-2" aria-hidden="true"></a>fit &lt;-<span class="st"> </span><span class="kw">rpart</span>(margin <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> polls_<span class="dv">2008</span>)</span>
<span id="cb537-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb537-3" aria-hidden="true"></a></span>
<span id="cb537-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb537-4" aria-hidden="true"></a><span class="co"># visualize the splits </span></span>
<span id="cb537-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb537-5" aria-hidden="true"></a><span class="kw">plot</span>(fit, <span class="dt">margin =</span> <span class="fl">0.1</span>)</span>
<span id="cb537-6"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb537-6" aria-hidden="true"></a><span class="kw">text</span>(fit, <span class="dt">cex =</span> <span class="fl">0.75</span>)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-146-5.png" width="672" /></p>
<div class="sourceCode" id="cb538"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb538-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb538-1" aria-hidden="true"></a>polls_<span class="dv">2008</span> <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb538-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb538-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y_hat =</span> <span class="kw">predict</span>(fit)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb538-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb538-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb538-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb538-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(day, margin)) <span class="op">+</span></span>
<span id="cb538-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb538-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_step</span>(<span class="kw">aes</span>(day, y_hat), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-146-6.png" width="672" /></p>
<div class="sourceCode" id="cb539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb539-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb539-1" aria-hidden="true"></a><span class="co"># change parameters</span></span>
<span id="cb539-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb539-2" aria-hidden="true"></a>fit &lt;-<span class="st"> </span><span class="kw">rpart</span>(margin <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> polls_<span class="dv">2008</span>, <span class="dt">control =</span> <span class="kw">rpart.control</span>(<span class="dt">cp =</span> <span class="dv">0</span>, <span class="dt">minsplit =</span> <span class="dv">2</span>))</span>
<span id="cb539-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb539-3" aria-hidden="true"></a>polls_<span class="dv">2008</span> <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb539-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb539-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y_hat =</span> <span class="kw">predict</span>(fit)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb539-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb539-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb539-6"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb539-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(day, margin)) <span class="op">+</span></span>
<span id="cb539-7"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb539-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_step</span>(<span class="kw">aes</span>(day, y_hat), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-146-7.png" width="672" /></p>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb540-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb540-1" aria-hidden="true"></a><span class="co"># use cross validation to choose cp</span></span>
<span id="cb540-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb540-2" aria-hidden="true"></a>train_rpart &lt;-<span class="st"> </span><span class="kw">train</span>(margin <span class="op">~</span><span class="st"> </span>., <span class="dt">method =</span> <span class="st">&quot;rpart&quot;</span>, <span class="dt">tuneGrid =</span> <span class="kw">data.frame</span>(<span class="dt">cp =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="dt">len =</span> <span class="dv">25</span>)), <span class="dt">data =</span> polls_<span class="dv">2008</span>)</span>
<span id="cb540-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb540-3" aria-hidden="true"></a><span class="kw">ggplot</span>(train_rpart)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-146-8.png" width="672" /></p>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb541-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb541-1" aria-hidden="true"></a><span class="co"># access the final model and plot it</span></span>
<span id="cb541-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb541-2" aria-hidden="true"></a><span class="kw">plot</span>(train_rpart<span class="op">$</span>finalModel, <span class="dt">margin =</span> <span class="fl">0.1</span>)</span>
<span id="cb541-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb541-3" aria-hidden="true"></a><span class="kw">text</span>(train_rpart<span class="op">$</span>finalModel, <span class="dt">cex =</span> <span class="fl">0.75</span>)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-146-9.png" width="672" /></p>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb542-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb542-1" aria-hidden="true"></a>polls_<span class="dv">2008</span> <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb542-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb542-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y_hat =</span> <span class="kw">predict</span>(train_rpart)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb542-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb542-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb542-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb542-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(day, margin)) <span class="op">+</span></span>
<span id="cb542-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb542-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_step</span>(<span class="kw">aes</span>(day, y_hat), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-146-10.png" width="672" /></p>
<div class="sourceCode" id="cb543"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb543-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb543-1" aria-hidden="true"></a><span class="co"># prune the tree </span></span>
<span id="cb543-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb543-2" aria-hidden="true"></a>pruned_fit &lt;-<span class="st"> </span><span class="kw">prune</span>(fit, <span class="dt">cp =</span> <span class="fl">0.01</span>)</span></code></pre></div>
</div>
<div id="classification-decision-trees" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> Classification (Decision) Trees</h2>
<p>There is a link to the relevant section of the textbook: <a href="https://rafalab.github.io/dsbook/examples-of-algorithms.html#classification-decision-trees" target="_blank">Classification (decision) trees</a></p>
<p><strong>Key points</strong></p>
<ul>
<li><strong>Classification trees</strong>, or decision trees, are used in prediction problems where the <strong>outcome is categorical</strong>.</li>
<li>Decision trees form predictions by calculating <strong>which class is the most common</strong> among the training set observations within the partition, rather than taking the average in each partition.</li>
<li>Two of the more popular metrics to choose the partitions are the <strong>Gini index</strong> and <strong>entropy</strong>.</li>
</ul>
<p><span class="math inline">\(\text{Gini}(j) = \sum_{k=1}^K\hat{p}_{j,k}(1 - \hat{p}_{j,k})\)</span></p>
<p><span class="math inline">\(\text{entropy}(j) = - \sum_{k=1}^K\hat{p}_{j,k}log(\hat{p}_{j,k}), \text{with } 0 \times \log(0) \text{defined as } 0\)</span></p>
<ul>
<li>Pros: Classification trees are highly interpretable and easy to visualize.They can model human decision processes and don’t require use of dummy predictors for categorical variables.</li>
<li>Cons: The approach via recursive partitioning can easily over-train and is therefore a bit harder to train than. Furthermore, in terms of accuracy, it is rarely the best performing method since it is not very flexible and is highly unstable to changes in training data.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb544-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb544-1" aria-hidden="true"></a><span class="co"># fit a classification tree and plot it</span></span>
<span id="cb544-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb544-2" aria-hidden="true"></a>train_rpart &lt;-<span class="st"> </span><span class="kw">train</span>(y <span class="op">~</span><span class="st"> </span>.,</span>
<span id="cb544-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb544-3" aria-hidden="true"></a>              <span class="dt">method =</span> <span class="st">&quot;rpart&quot;</span>,</span>
<span id="cb544-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb544-4" aria-hidden="true"></a>              <span class="dt">tuneGrid =</span> <span class="kw">data.frame</span>(<span class="dt">cp =</span> <span class="kw">seq</span>(<span class="fl">0.0</span>, <span class="fl">0.1</span>, <span class="dt">len =</span> <span class="dv">25</span>)),</span>
<span id="cb544-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb544-5" aria-hidden="true"></a>              <span class="dt">data =</span> mnist_<span class="dv">27</span><span class="op">$</span>train)</span>
<span id="cb544-6"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb544-6" aria-hidden="true"></a><span class="kw">plot</span>(train_rpart)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-147-1.png" width="672" /></p>
<div class="sourceCode" id="cb545"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb545-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb545-1" aria-hidden="true"></a><span class="co"># compute accuracy</span></span>
<span id="cb545-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb545-2" aria-hidden="true"></a><span class="kw">confusionMatrix</span>(<span class="kw">predict</span>(train_rpart, mnist_<span class="dv">27</span><span class="op">$</span>test), mnist_<span class="dv">27</span><span class="op">$</span>test<span class="op">$</span>y)<span class="op">$</span>overall[<span class="st">&quot;Accuracy&quot;</span>]</span></code></pre></div>
<pre><code>## Accuracy 
##     0.82</code></pre>
</div>
<div id="random-forests" class="section level2" number="6.4">
<h2><span class="header-section-number">6.4</span> Random Forests</h2>
<p>There is a link to the relevant section of the textbook: <a href="https://rafalab.github.io/dsbook/examples-of-algorithms.html#random-forests" target="_blank">Random forests</a></p>
<p><strong>Key points</strong></p>
<ul>
<li><strong>Random forests</strong> are a very popular machine learning approach that addresses the shortcomings of decision trees. The goal is to improve prediction performance and reduce instability by <strong>averaging multiple decision trees</strong> (a forest of trees constructed with randomness).</li>
<li>The general idea of random forests is to generate many predictors, each using regression or classification trees, and then <strong>forming a final prediction based on the average prediction of all these trees</strong>. To assure that the individual trees are not the same, we use the <strong>bootstrap to induce randomness</strong>.</li>
<li>A <strong>disadvantage</strong> of random forests is that we <strong>lose interpretability</strong>.</li>
<li>An approach that helps with interpretability is to examine <strong>variable importance</strong>. To define variable importance we <strong>count how often a predictor is used in the individual trees</strong>. The <strong>caret</strong> package includes the function <code>varImp</code> that extracts variable importance from any model in which the calculation is implemented.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb547"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb547-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb547-1" aria-hidden="true"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw">require</span>(randomForest)) <span class="kw">install.packages</span>(<span class="st">&quot;randomForest&quot;</span>)</span></code></pre></div>
<pre><code>## Loading required package: randomForest</code></pre>
<pre><code>## randomForest 4.6-14</code></pre>
<pre><code>## Type rfNews() to see new features/changes/bug fixes.</code></pre>
<pre><code>## 
## Attaching package: &#39;randomForest&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:gridExtra&#39;:
## 
##     combine</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     combine</code></pre>
<pre><code>## The following object is masked from &#39;package:ggplot2&#39;:
## 
##     margin</code></pre>
<div class="sourceCode" id="cb555"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb555-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb555-1" aria-hidden="true"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw">require</span>(Rborist)) <span class="kw">install.packages</span>(<span class="st">&quot;Rborist&quot;</span>)</span></code></pre></div>
<pre><code>## Loading required package: Rborist</code></pre>
<pre><code>## Rborist 0.2-3</code></pre>
<pre><code>## Type RboristNews() to see new features/changes/bug fixes.</code></pre>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb559-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb559-1" aria-hidden="true"></a><span class="kw">library</span>(randomForest)</span>
<span id="cb559-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb559-2" aria-hidden="true"></a>fit &lt;-<span class="st"> </span><span class="kw">randomForest</span>(margin<span class="op">~</span>., <span class="dt">data =</span> polls_<span class="dv">2008</span>) </span>
<span id="cb559-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb559-3" aria-hidden="true"></a><span class="kw">plot</span>(fit)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-148-1.png" width="672" /></p>
<div class="sourceCode" id="cb560"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb560-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb560-1" aria-hidden="true"></a>polls_<span class="dv">2008</span> <span class="op">%&gt;%</span></span>
<span id="cb560-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb560-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y_hat =</span> <span class="kw">predict</span>(fit, <span class="dt">newdata =</span> polls_<span class="dv">2008</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb560-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb560-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb560-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb560-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(day, margin)) <span class="op">+</span></span>
<span id="cb560-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb560-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(day, y_hat), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-148-2.png" width="672" /></p>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb561-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb561-1" aria-hidden="true"></a>train_rf &lt;-<span class="st"> </span><span class="kw">randomForest</span>(y <span class="op">~</span><span class="st"> </span>., <span class="dt">data=</span>mnist_<span class="dv">27</span><span class="op">$</span>train)</span>
<span id="cb561-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb561-2" aria-hidden="true"></a><span class="kw">confusionMatrix</span>(<span class="kw">predict</span>(train_rf, mnist_<span class="dv">27</span><span class="op">$</span>test), mnist_<span class="dv">27</span><span class="op">$</span>test<span class="op">$</span>y)<span class="op">$</span>overall[<span class="st">&quot;Accuracy&quot;</span>]</span></code></pre></div>
<pre><code>## Accuracy 
##    0.785</code></pre>
<div class="sourceCode" id="cb563"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb563-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb563-1" aria-hidden="true"></a><span class="co"># use cross validation to choose parameter</span></span>
<span id="cb563-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb563-2" aria-hidden="true"></a>train_rf_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">train</span>(y <span class="op">~</span><span class="st"> </span>.,</span>
<span id="cb563-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb563-3" aria-hidden="true"></a>      <span class="dt">method =</span> <span class="st">&quot;Rborist&quot;</span>,</span>
<span id="cb563-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb563-4" aria-hidden="true"></a>      <span class="dt">tuneGrid =</span> <span class="kw">data.frame</span>(<span class="dt">predFixed =</span> <span class="dv">2</span>, <span class="dt">minNode =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">50</span>)),</span>
<span id="cb563-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb563-5" aria-hidden="true"></a>      <span class="dt">data =</span> mnist_<span class="dv">27</span><span class="op">$</span>train)</span>
<span id="cb563-6"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb563-6" aria-hidden="true"></a><span class="kw">confusionMatrix</span>(<span class="kw">predict</span>(train_rf_<span class="dv">2</span>, mnist_<span class="dv">27</span><span class="op">$</span>test), mnist_<span class="dv">27</span><span class="op">$</span>test<span class="op">$</span>y)<span class="op">$</span>overall[<span class="st">&quot;Accuracy&quot;</span>]</span></code></pre></div>
<pre><code>## Accuracy 
##      0.8</code></pre>
</div>
<div id="comprehension-check---trees-and-random-forests" class="section level2" number="6.5">
<h2><span class="header-section-number">6.5</span> Comprehension Check - Trees and Random Forests</h2>
<ol style="list-style-type: decimal">
<li>Create a simple dataset where the outcome grows 0.75 units on average for every increase in a predictor, using this code:</li>
</ol>
<div class="sourceCode" id="cb565"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb565-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb565-1" aria-hidden="true"></a>n &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb565-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb565-2" aria-hidden="true"></a>sigma &lt;-<span class="st"> </span><span class="fl">0.25</span></span>
<span id="cb565-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb565-3" aria-hidden="true"></a><span class="co"># set.seed(1) # if using R 3.5 or ealier</span></span>
<span id="cb565-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb565-4" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>, <span class="dt">sample.kind =</span> <span class="st">&quot;Rounding&quot;</span>) <span class="co"># if using R 3.6 or later</span></span></code></pre></div>
<pre><code>## Warning in set.seed(1, sample.kind = &quot;Rounding&quot;): non-uniform &#39;Rounding&#39; sampler used</code></pre>
<div class="sourceCode" id="cb567"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb567-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb567-1" aria-hidden="true"></a>x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb567-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb567-2" aria-hidden="true"></a>y &lt;-<span class="st"> </span><span class="fl">0.75</span> <span class="op">*</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dv">0</span>, sigma)</span>
<span id="cb567-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb567-3" aria-hidden="true"></a>dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)</span></code></pre></div>
<p>Which code correctly uses rpart() to fit a regression tree and saves the result to fit?</p>
<ul class="task-list">
<li><p><input type="checkbox" disabled="" />
A. <code>fit &lt;- rpart(y ~ .)</code></p></li>
<li><p><input type="checkbox" disabled="" />
B. <code>fit &lt;- rpart(y, ., data = dat)</code></p></li>
<li><p><input type="checkbox" disabled="" />
C. <code>fit &lt;- rpart(x ~ ., data = dat)</code></p></li>
<li><p><input type="checkbox" disabled="" checked="" />
D. <code>fit &lt;- rpart(y ~ ., data = dat)</code></p></li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Which of the following plots has the same tree shape obtained in Q1?</li>
</ol>
<div class="sourceCode" id="cb568"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb568-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb568-1" aria-hidden="true"></a>fit &lt;-<span class="st"> </span><span class="kw">rpart</span>(y <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> dat)</span>
<span id="cb568-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb568-2" aria-hidden="true"></a><span class="kw">plot</span>(fit)</span>
<span id="cb568-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb568-3" aria-hidden="true"></a><span class="kw">text</span>(fit)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-150-1.png" width="672" /></p>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A.</li>
</ul>
<p><img src="images/Trees_1.png" /></p>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
B.</li>
</ul>
<p><img src="images/Trees_2.png" /></p>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
C.</li>
</ul>
<p><img src="images/Trees_3.png" /></p>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
D.</li>
</ul>
<p><img src="images/Trees_4.png" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Below is most of the code to make a scatter plot of <code>y</code> versus <code>x</code> along with the predicted values based on the fit.</li>
</ol>
<div class="sourceCode" id="cb569"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb569-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb569-1" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb569-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb569-2" aria-hidden="true"></a><span class="kw">mutate</span>(<span class="dt">y_hat =</span> <span class="kw">predict</span>(fit)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb569-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb569-3" aria-hidden="true"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb569-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb569-4" aria-hidden="true"></a><span class="kw">geom_point</span>(<span class="kw">aes</span>(x, y)) <span class="op">+</span></span>
<span id="cb569-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb569-5" aria-hidden="true"></a><span class="co">#BLANK</span></span></code></pre></div>
<p>Which line of code should be used to replace #BLANK in the code above?</p>
<div class="sourceCode" id="cb570"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb570-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb570-1" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb570-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb570-2" aria-hidden="true"></a><span class="kw">mutate</span>(<span class="dt">y_hat =</span> <span class="kw">predict</span>(fit)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb570-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb570-3" aria-hidden="true"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb570-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb570-4" aria-hidden="true"></a><span class="kw">geom_point</span>(<span class="kw">aes</span>(x, y)) <span class="op">+</span></span>
<span id="cb570-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb570-5" aria-hidden="true"></a><span class="kw">geom_step</span>(<span class="kw">aes</span>(x, y_hat), <span class="dt">col=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-152-1.png" width="672" /></p>
<ul class="task-list">
<li><p><input type="checkbox" disabled="" checked="" />
A. <code>geom_step(aes(x, y_hat), col=2)</code></p></li>
<li><p><input type="checkbox" disabled="" />
B. <code>geom_smooth(aes(y_hat, x), col=2)</code></p></li>
<li><p><input type="checkbox" disabled="" />
C. <code>geom_quantile(aes(x, y_hat), col=2)</code></p></li>
<li><p><input type="checkbox" disabled="" />
D. <code>geom_step(aes(y_hat, x), col=2)</code></p></li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>Now run Random Forests instead of a regression tree using <code>randomForest()</code> from the <strong>randomForest</strong> package, and remake the scatterplot with the prediction line. Part of the code is provided for you below.</li>
</ol>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb571-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb571-1" aria-hidden="true"></a><span class="kw">library</span>(randomForest)</span>
<span id="cb571-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb571-2" aria-hidden="true"></a>fit &lt;-<span class="st"> </span><span class="co">#BLANK </span></span>
<span id="cb571-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb571-3" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb571-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb571-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">y_hat =</span> <span class="kw">predict</span>(fit)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb571-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb571-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb571-6"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb571-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(x, y)) <span class="op">+</span></span>
<span id="cb571-7"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb571-7" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_step</span>(<span class="kw">aes</span>(x, y_hat), <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p>What code should replace #BLANK in the provided code?</p>
<div class="sourceCode" id="cb572"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb572-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb572-1" aria-hidden="true"></a><span class="kw">library</span>(randomForest)</span>
<span id="cb572-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb572-2" aria-hidden="true"></a>fit &lt;-<span class="st"> </span><span class="kw">randomForest</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> dat) </span>
<span id="cb572-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb572-3" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb572-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb572-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">y_hat =</span> <span class="kw">predict</span>(fit)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb572-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb572-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb572-6"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb572-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(x, y)) <span class="op">+</span></span>
<span id="cb572-7"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb572-7" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_step</span>(<span class="kw">aes</span>(x, y_hat), <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-154-1.png" width="672" /></p>
<ul class="task-list">
<li><p><input type="checkbox" disabled="" checked="" />
A. <code>randomForest(y ~ x, data = dat)</code></p></li>
<li><p><input type="checkbox" disabled="" />
B. <code>randomForest(x ~ y, data = dat)</code></p></li>
<li><p><input type="checkbox" disabled="" />
C. <code>randomForest(y ~ x, data = data)</code></p></li>
<li><p><input type="checkbox" disabled="" />
D. <code>randomForest(x ~ y)</code></p></li>
</ul>
<ol start="5" style="list-style-type: decimal">
<li>Use the <code>plot()</code> function to see if the Random Forest from Q4 has converged or if we need more trees.</li>
</ol>
<p>Which of these graphs is most similar to the one produced by plotting the random forest? Note that there may be slight differences due to the seed not being set.</p>
<div class="sourceCode" id="cb573"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb573-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb573-1" aria-hidden="true"></a><span class="kw">plot</span>(fit)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-155-1.png" width="672" /></p>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A.</li>
</ul>
<p><img src="images/Trees_Plot1.png" /></p>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
B.</li>
</ul>
<p><img src="images/Trees_Plot2.png" /></p>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
C.</li>
</ul>
<p><img src="images/Trees_Plot3.png" /></p>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
D.</li>
</ul>
<p><img src="images/Trees_Plot4.png" /></p>
<ol start="6" style="list-style-type: decimal">
<li>It seems that the default values for the Random Forest result in an estimate that is too flexible (unsmooth). Re-run the Random Forest but this time with a node size of 50 and a maximum of 25 nodes. Remake the plot.</li>
</ol>
<p>Part of the code is provided for you below.</p>
<div class="sourceCode" id="cb574"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb574-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb574-1" aria-hidden="true"></a><span class="kw">library</span>(randomForest)</span>
<span id="cb574-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb574-2" aria-hidden="true"></a>fit &lt;-<span class="st"> </span><span class="co">#BLANK</span></span>
<span id="cb574-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb574-3" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb574-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb574-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">y_hat =</span> <span class="kw">predict</span>(fit)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb574-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb574-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb574-6"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb574-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(x, y)) <span class="op">+</span></span>
<span id="cb574-7"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb574-7" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_step</span>(<span class="kw">aes</span>(x, y_hat), <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p>What code should replace #BLANK in the provided code?</p>
<div class="sourceCode" id="cb575"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb575-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb575-1" aria-hidden="true"></a><span class="kw">library</span>(randomForest)</span>
<span id="cb575-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb575-2" aria-hidden="true"></a>fit &lt;-<span class="st"> </span><span class="kw">randomForest</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> dat, <span class="dt">nodesize =</span> <span class="dv">50</span>, <span class="dt">maxnodes =</span> <span class="dv">25</span>)</span>
<span id="cb575-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb575-3" aria-hidden="true"></a>dat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb575-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb575-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">y_hat =</span> <span class="kw">predict</span>(fit)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb575-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb575-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb575-6"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb575-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(x, y)) <span class="op">+</span></span>
<span id="cb575-7"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb575-7" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_step</span>(<span class="kw">aes</span>(x, y_hat), <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-157-1.png" width="672" /></p>
<ul class="task-list">
<li><p><input type="checkbox" disabled="" />
A. <code>randomForest(y ~ x, data = dat, nodesize = 25, maxnodes = 25)</code></p></li>
<li><p><input type="checkbox" disabled="" />
B. <code>randomForest(y ~ x, data = dat, nodes = 50, max = 25)</code></p></li>
<li><p><input type="checkbox" disabled="" />
C. <code>randomForest(x ~ y, data = dat, nodes = 50, max = 25)</code></p></li>
<li><p><input type="checkbox" disabled="" checked="" />
D. <code>randomForest(y ~ x, data = dat, nodesize = 50, maxnodes = 25)</code></p></li>
<li><p><input type="checkbox" disabled="" />
E. <code>randomForest(x ~ y, data = dat, nodesize = 50, maxnodes = 25)</code></p></li>
</ul>
</div>
<div id="caret-package" class="section level2" number="6.6">
<h2><span class="header-section-number">6.6</span> Caret Package</h2>
<p>There is a link to the relevant section of the textbook: <a href="https://rafalab.github.io/dsbook/caret.html" target="_blank">The caret package</a></p>
<p><strong>Caret package links</strong></p>
<p><a href="http://topepo.github.io/caret/available-models.html" target="_blank">http://topepo.github.io/caret/available-models.html</a></p>
<p><a href="http://topepo.github.io/caret/train-models-by-tag.html" target="_blank">http://topepo.github.io/caret/train-models-by-tag.html</a></p>
<p><strong>Key points</strong></p>
<ul>
<li>The <strong>caret</strong> package helps provides a uniform interface and standardized syntax for the many different machine learning packages in R. Note that <strong>caret</strong> does not automatically install the packages needed.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb576"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb576-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb576-1" aria-hidden="true"></a><span class="kw">data</span>(<span class="st">&quot;mnist_27&quot;</span>)</span>
<span id="cb576-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb576-2" aria-hidden="true"></a></span>
<span id="cb576-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb576-3" aria-hidden="true"></a>train_glm &lt;-<span class="st"> </span><span class="kw">train</span>(y <span class="op">~</span><span class="st"> </span>., <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>, <span class="dt">data =</span> mnist_<span class="dv">27</span><span class="op">$</span>train)</span>
<span id="cb576-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb576-4" aria-hidden="true"></a>train_knn &lt;-<span class="st"> </span><span class="kw">train</span>(y <span class="op">~</span><span class="st"> </span>., <span class="dt">method =</span> <span class="st">&quot;knn&quot;</span>, <span class="dt">data =</span> mnist_<span class="dv">27</span><span class="op">$</span>train)</span>
<span id="cb576-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb576-5" aria-hidden="true"></a></span>
<span id="cb576-6"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb576-6" aria-hidden="true"></a>y_hat_glm &lt;-<span class="st"> </span><span class="kw">predict</span>(train_glm, mnist_<span class="dv">27</span><span class="op">$</span>test, <span class="dt">type =</span> <span class="st">&quot;raw&quot;</span>)</span>
<span id="cb576-7"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb576-7" aria-hidden="true"></a>y_hat_knn &lt;-<span class="st"> </span><span class="kw">predict</span>(train_knn, mnist_<span class="dv">27</span><span class="op">$</span>test, <span class="dt">type =</span> <span class="st">&quot;raw&quot;</span>)</span>
<span id="cb576-8"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb576-8" aria-hidden="true"></a></span>
<span id="cb576-9"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb576-9" aria-hidden="true"></a><span class="kw">confusionMatrix</span>(y_hat_glm, mnist_<span class="dv">27</span><span class="op">$</span>test<span class="op">$</span>y)<span class="op">$</span>overall[[<span class="st">&quot;Accuracy&quot;</span>]]</span></code></pre></div>
<pre><code>## [1] 0.75</code></pre>
<div class="sourceCode" id="cb578"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb578-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb578-1" aria-hidden="true"></a><span class="kw">confusionMatrix</span>(y_hat_knn, mnist_<span class="dv">27</span><span class="op">$</span>test<span class="op">$</span>y)<span class="op">$</span>overall[[<span class="st">&quot;Accuracy&quot;</span>]]</span></code></pre></div>
<pre><code>## [1] 0.84</code></pre>
</div>
<div id="tuning-parameters-with-caret" class="section level2" number="6.7">
<h2><span class="header-section-number">6.7</span> Tuning Parameters with Caret</h2>
<p>There is a link to the relevant section of the textbook: <a href="https://rafalab.github.io/dsbook/caret.html#caret-cv" target="_blank">Cross validation</a></p>
<p><strong>Key points</strong></p>
<ul>
<li>The <code>train()</code> function automatically uses cross-validation to decide among a few default values of a tuning parameter.</li>
<li>The <code>getModelInfo()</code> and <code>modelLookup()</code> functions can be used to learn more about a model and the parameters that can be optimized.</li>
<li>We can use the <code>tunegrid()</code> parameter in the <code>train()</code> function to select a grid of values to be compared.</li>
<li>The <code>trControl</code> parameter and <code>trainControl()</code> function can be used to change the way cross-validation is performed.</li>
<li>Note that <strong>not all parameters in machine learning algorithms are tuned</strong>. We use the <code>train()</code> function to only optimize parameters that are tunable.</li>
</ul>
<p><em>Code</em></p>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb580-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb580-1" aria-hidden="true"></a><span class="kw">getModelInfo</span>(<span class="st">&quot;knn&quot;</span>)</span></code></pre></div>
<pre><code>## $kknn
## $kknn$label
## [1] &quot;k-Nearest Neighbors&quot;
## 
## $kknn$library
## [1] &quot;kknn&quot;
## 
## $kknn$loop
## NULL
## 
## $kknn$type
## [1] &quot;Regression&quot;     &quot;Classification&quot;
## 
## $kknn$parameters
##   parameter     class           label
## 1      kmax   numeric Max. #Neighbors
## 2  distance   numeric        Distance
## 3    kernel character          Kernel
## 
## $kknn$grid
## function(x, y, len = NULL, search = &quot;grid&quot;) {
##                     if(search == &quot;grid&quot;) {
##                       out &lt;- data.frame(kmax = (5:((2 * len)+4))[(5:((2 * len)+4))%%2 &gt; 0], 
##                                         distance = 2, 
##                                         kernel = &quot;optimal&quot;)
##                     } else {
##                       by_val &lt;- if(is.factor(y)) length(levels(y)) else 1
##                       kerns &lt;- c(&quot;rectangular&quot;, &quot;triangular&quot;, &quot;epanechnikov&quot;, &quot;biweight&quot;, &quot;triweight&quot;, 
##                                  &quot;cos&quot;, &quot;inv&quot;, &quot;gaussian&quot;)
##                       out &lt;- data.frame(kmax = sample(seq(1, floor(nrow(x)/3), by = by_val), size = len, replace = TRUE),
##                                         distance = runif(len, min = 0, max = 3),
##                                         kernel = sample(kerns, size = len, replace = TRUE))
##                     }
##                     out
##                   }
## 
## $kknn$fit
## function(x, y, wts, param, lev, last, classProbs, ...) {
##                     dat &lt;- if(is.data.frame(x)) x else as.data.frame(x, stringsAsFactors = TRUE)
##                     dat$.outcome &lt;- y
##                     kknn::train.kknn(.outcome ~ ., data = dat,
##                                kmax = param$kmax,
##                                distance = param$distance,
##                                kernel = as.character(param$kernel), ...)
##                   }
## 
## $kknn$predict
## function(modelFit, newdata, submodels = NULL) {
##                     if(!is.data.frame(newdata)) newdata &lt;- as.data.frame(newdata, stringsAsFactors = TRUE)
##                     predict(modelFit, newdata)
##                   }
## 
## $kknn$levels
## function(x) x$obsLevels
## 
## $kknn$tags
## [1] &quot;Prototype Models&quot;
## 
## $kknn$prob
## function(modelFit, newdata, submodels = NULL) {
##                     if(!is.data.frame(newdata)) newdata &lt;- as.data.frame(newdata, stringsAsFactors = TRUE)
##                     predict(modelFit, newdata, type = &quot;prob&quot;)
##                   }
## 
## $kknn$sort
## function(x) x[order(-x[,1]),]
## 
## 
## $knn
## $knn$label
## [1] &quot;k-Nearest Neighbors&quot;
## 
## $knn$library
## NULL
## 
## $knn$loop
## NULL
## 
## $knn$type
## [1] &quot;Classification&quot; &quot;Regression&quot;    
## 
## $knn$parameters
##   parameter   class      label
## 1         k numeric #Neighbors
## 
## $knn$grid
## function(x, y, len = NULL, search = &quot;grid&quot;){
##                     if(search == &quot;grid&quot;) {
##                       out &lt;- data.frame(k = (5:((2 * len)+4))[(5:((2 * len)+4))%%2 &gt; 0])
##                     } else {
##                       by_val &lt;- if(is.factor(y)) length(levels(y)) else 1
##                       out &lt;- data.frame(k = sample(seq(1, floor(nrow(x)/3), by = by_val), size = len, replace = TRUE))
##                     }
##                   }
## 
## $knn$fit
## function(x, y, wts, param, lev, last, classProbs, ...) {
##                     if(is.factor(y))
##                     {
##                       knn3(as.matrix(x), y, k = param$k, ...)
##                     } else {
##                       knnreg(as.matrix(x), y, k = param$k, ...)
##                     }
##                   }
## 
## $knn$predict
## function(modelFit, newdata, submodels = NULL) {
##                     if(modelFit$problemType == &quot;Classification&quot;)
##                     {
##                       out &lt;- predict(modelFit, newdata,  type = &quot;class&quot;)
##                     } else {
##                       out &lt;- predict(modelFit, newdata)
##                     }
##                     out
##                   }
## 
## $knn$predictors
## function(x, ...) colnames(x$learn$X)
## 
## $knn$tags
## [1] &quot;Prototype Models&quot;
## 
## $knn$prob
## function(modelFit, newdata, submodels = NULL)
##                     predict(modelFit, newdata, type = &quot;prob&quot;)
## 
## $knn$levels
## function(x) levels(x$learn$y)
## 
## $knn$sort
## function(x) x[order(-x[,1]),]</code></pre>
<div class="sourceCode" id="cb582"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb582-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb582-1" aria-hidden="true"></a><span class="kw">modelLookup</span>(<span class="st">&quot;knn&quot;</span>)</span></code></pre></div>
<pre><code>##   model parameter      label forReg forClass probModel
## 1   knn         k #Neighbors   TRUE     TRUE      TRUE</code></pre>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb584-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb584-1" aria-hidden="true"></a>train_knn &lt;-<span class="st"> </span><span class="kw">train</span>(y <span class="op">~</span><span class="st"> </span>., <span class="dt">method =</span> <span class="st">&quot;knn&quot;</span>, <span class="dt">data =</span> mnist_<span class="dv">27</span><span class="op">$</span>train)</span>
<span id="cb584-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb584-2" aria-hidden="true"></a><span class="kw">ggplot</span>(train_knn, <span class="dt">highlight =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-159-1.png" width="672" /></p>
<div class="sourceCode" id="cb585"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb585-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb585-1" aria-hidden="true"></a>train_knn &lt;-<span class="st"> </span><span class="kw">train</span>(y <span class="op">~</span><span class="st"> </span>., <span class="dt">method =</span> <span class="st">&quot;knn&quot;</span>, </span>
<span id="cb585-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb585-2" aria-hidden="true"></a>                   <span class="dt">data =</span> mnist_<span class="dv">27</span><span class="op">$</span>train,</span>
<span id="cb585-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb585-3" aria-hidden="true"></a>                   <span class="dt">tuneGrid =</span> <span class="kw">data.frame</span>(<span class="dt">k =</span> <span class="kw">seq</span>(<span class="dv">9</span>, <span class="dv">71</span>, <span class="dv">2</span>)))</span>
<span id="cb585-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb585-4" aria-hidden="true"></a><span class="kw">ggplot</span>(train_knn, <span class="dt">highlight =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-159-2.png" width="672" /></p>
<div class="sourceCode" id="cb586"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb586-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb586-1" aria-hidden="true"></a>train_knn<span class="op">$</span>bestTune</span></code></pre></div>
<pre><code>##     k
## 18 43</code></pre>
<div class="sourceCode" id="cb588"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb588-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb588-1" aria-hidden="true"></a>train_knn<span class="op">$</span>finalModel</span></code></pre></div>
<pre><code>## 43-nearest neighbor model
## Training set outcome distribution:
## 
##   2   7 
## 379 421</code></pre>
<div class="sourceCode" id="cb590"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb590-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb590-1" aria-hidden="true"></a><span class="kw">confusionMatrix</span>(<span class="kw">predict</span>(train_knn, mnist_<span class="dv">27</span><span class="op">$</span>test, <span class="dt">type =</span> <span class="st">&quot;raw&quot;</span>),</span>
<span id="cb590-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb590-2" aria-hidden="true"></a>                mnist_<span class="dv">27</span><span class="op">$</span>test<span class="op">$</span>y)<span class="op">$</span>overall[<span class="st">&quot;Accuracy&quot;</span>]</span></code></pre></div>
<pre><code>## Accuracy 
##    0.855</code></pre>
<div class="sourceCode" id="cb592"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb592-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb592-1" aria-hidden="true"></a>control &lt;-<span class="st"> </span><span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">10</span>, <span class="dt">p =</span> <span class="fl">.9</span>)</span>
<span id="cb592-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb592-2" aria-hidden="true"></a>train_knn_cv &lt;-<span class="st"> </span><span class="kw">train</span>(y <span class="op">~</span><span class="st"> </span>., <span class="dt">method =</span> <span class="st">&quot;knn&quot;</span>, </span>
<span id="cb592-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb592-3" aria-hidden="true"></a>                      <span class="dt">data =</span> mnist_<span class="dv">27</span><span class="op">$</span>train,</span>
<span id="cb592-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb592-4" aria-hidden="true"></a>                      <span class="dt">tuneGrid =</span> <span class="kw">data.frame</span>(<span class="dt">k =</span> <span class="kw">seq</span>(<span class="dv">9</span>, <span class="dv">71</span>, <span class="dv">2</span>)),</span>
<span id="cb592-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb592-5" aria-hidden="true"></a>                      <span class="dt">trControl =</span> control)</span>
<span id="cb592-6"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb592-6" aria-hidden="true"></a><span class="kw">ggplot</span>(train_knn_cv, <span class="dt">highlight =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-159-3.png" width="672" /></p>
<div class="sourceCode" id="cb593"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb593-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb593-1" aria-hidden="true"></a>train_knn<span class="op">$</span>results <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb593-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb593-2" aria-hidden="true"></a><span class="st">     </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> k, <span class="dt">y =</span> Accuracy)) <span class="op">+</span></span>
<span id="cb593-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb593-3" aria-hidden="true"></a><span class="st">     </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb593-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb593-4" aria-hidden="true"></a><span class="st">     </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb593-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb593-5" aria-hidden="true"></a><span class="st">     </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">x =</span> k, </span>
<span id="cb593-6"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb593-6" aria-hidden="true"></a>                       <span class="dt">ymin =</span> Accuracy <span class="op">-</span><span class="st"> </span>AccuracySD,</span>
<span id="cb593-7"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb593-7" aria-hidden="true"></a>                       <span class="dt">ymax =</span> Accuracy <span class="op">+</span><span class="st"> </span>AccuracySD))</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-159-4.png" width="672" /></p>
<div class="sourceCode" id="cb594"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb594-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb594-1" aria-hidden="true"></a>plot_cond_prob &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">p_hat=</span><span class="ot">NULL</span>){</span>
<span id="cb594-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb594-2" aria-hidden="true"></a>     tmp &lt;-<span class="st"> </span>mnist_<span class="dv">27</span><span class="op">$</span>true_p</span>
<span id="cb594-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb594-3" aria-hidden="true"></a>     <span class="cf">if</span>(<span class="op">!</span><span class="kw">is.null</span>(p_hat)){</span>
<span id="cb594-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb594-4" aria-hidden="true"></a>          tmp &lt;-<span class="st"> </span><span class="kw">mutate</span>(tmp, <span class="dt">p=</span>p_hat)</span>
<span id="cb594-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb594-5" aria-hidden="true"></a>     }</span>
<span id="cb594-6"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb594-6" aria-hidden="true"></a>     tmp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(x_<span class="dv">1</span>, x_<span class="dv">2</span>, <span class="dt">z=</span>p, <span class="dt">fill=</span>p)) <span class="op">+</span></span>
<span id="cb594-7"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb594-7" aria-hidden="true"></a><span class="st">     </span><span class="kw">geom_raster</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb594-8"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb594-8" aria-hidden="true"></a><span class="st">          </span><span class="kw">scale_fill_gradientn</span>(<span class="dt">colors=</span><span class="kw">c</span>(<span class="st">&quot;#F8766D&quot;</span>,<span class="st">&quot;white&quot;</span>,<span class="st">&quot;#00BFC4&quot;</span>)) <span class="op">+</span></span>
<span id="cb594-9"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb594-9" aria-hidden="true"></a><span class="st">          </span><span class="kw">stat_contour</span>(<span class="dt">breaks=</span><span class="kw">c</span>(<span class="fl">0.5</span>),<span class="dt">color=</span><span class="st">&quot;black&quot;</span>)</span>
<span id="cb594-10"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb594-10" aria-hidden="true"></a>}</span>
<span id="cb594-11"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb594-11" aria-hidden="true"></a></span>
<span id="cb594-12"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb594-12" aria-hidden="true"></a><span class="kw">plot_cond_prob</span>(<span class="kw">predict</span>(train_knn, mnist_<span class="dv">27</span><span class="op">$</span>true_p, <span class="dt">type =</span> <span class="st">&quot;prob&quot;</span>)[,<span class="dv">2</span>])</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-159-5.png" width="672" /></p>
<div class="sourceCode" id="cb595"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb595-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb595-1" aria-hidden="true"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw">require</span>(gam)) <span class="kw">install.packages</span>(<span class="st">&quot;gam&quot;</span>)</span></code></pre></div>
<pre><code>## Loading required package: gam</code></pre>
<pre><code>## Loading required package: splines</code></pre>
<pre><code>## Loading required package: foreach</code></pre>
<pre><code>## 
## Attaching package: &#39;foreach&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:purrr&#39;:
## 
##     accumulate, when</code></pre>
<pre><code>## Loaded gam 1.20</code></pre>
<div class="sourceCode" id="cb602"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb602-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb602-1" aria-hidden="true"></a><span class="kw">modelLookup</span>(<span class="st">&quot;gamLoess&quot;</span>)</span></code></pre></div>
<pre><code>##      model parameter  label forReg forClass probModel
## 1 gamLoess      span   Span   TRUE     TRUE      TRUE
## 2 gamLoess    degree Degree   TRUE     TRUE      TRUE</code></pre>
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb604-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb604-1" aria-hidden="true"></a>grid &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">span =</span> <span class="kw">seq</span>(<span class="fl">0.15</span>, <span class="fl">0.65</span>, <span class="dt">len =</span> <span class="dv">10</span>), <span class="dt">degree =</span> <span class="dv">1</span>)</span>
<span id="cb604-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb604-2" aria-hidden="true"></a></span>
<span id="cb604-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb604-3" aria-hidden="true"></a>train_loess &lt;-<span class="st"> </span><span class="kw">train</span>(y <span class="op">~</span><span class="st"> </span>., </span>
<span id="cb604-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb604-4" aria-hidden="true"></a>               <span class="dt">method =</span> <span class="st">&quot;gamLoess&quot;</span>,</span>
<span id="cb604-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb604-5" aria-hidden="true"></a>               <span class="dt">tuneGrid=</span>grid,</span>
<span id="cb604-6"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb604-6" aria-hidden="true"></a>               <span class="dt">data =</span> mnist_<span class="dv">27</span><span class="op">$</span>train)</span>
<span id="cb604-7"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb604-7" aria-hidden="true"></a><span class="kw">ggplot</span>(train_loess, <span class="dt">highlight =</span> <span class="ot">TRUE</span>)</span>
<span id="cb604-8"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb604-8" aria-hidden="true"></a></span>
<span id="cb604-9"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb604-9" aria-hidden="true"></a><span class="kw">confusionMatrix</span>(<span class="dt">data =</span> <span class="kw">predict</span>(train_loess, mnist_<span class="dv">27</span><span class="op">$</span>test), </span>
<span id="cb604-10"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb604-10" aria-hidden="true"></a>                <span class="dt">reference =</span> mnist_<span class="dv">27</span><span class="op">$</span>test<span class="op">$</span>y)<span class="op">$</span>overall[<span class="st">&quot;Accuracy&quot;</span>]</span>
<span id="cb604-11"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb604-11" aria-hidden="true"></a></span>
<span id="cb604-12"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb604-12" aria-hidden="true"></a>p1 &lt;-<span class="st"> </span><span class="kw">plot_cond_prob</span>(<span class="kw">predict</span>(train_loess, mnist_<span class="dv">27</span><span class="op">$</span>true_p, <span class="dt">type =</span> <span class="st">&quot;prob&quot;</span>)[,<span class="dv">2</span>])</span>
<span id="cb604-13"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb604-13" aria-hidden="true"></a>p1</span></code></pre></div>
</div>
<div id="comprehension-check---caret-package" class="section level2" number="6.8">
<h2><span class="header-section-number">6.8</span> Comprehension Check - Caret Package</h2>
<ol style="list-style-type: decimal">
<li>Load the <strong>rpart</strong> package and then use the <code>caret::train()</code> function with <code>method = "rpart"</code> to fit a classification tree to the <code>tissue_gene_expression</code> dataset. Try out <code>cp</code> values of <code>seq(0, 0.1, 0.01)</code>. Plot the accuracies to report the results of the best model. Set the seed to 1991.</li>
</ol>
<p>Which value of cp gives the highest accuracy? <code>0</code></p>
<div class="sourceCode" id="cb605"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb605-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb605-1" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1991</span>, <span class="dt">sample.kind =</span> <span class="st">&quot;Rounding&quot;</span>) <span class="co"># if using R 3.6 or later</span></span></code></pre></div>
<pre><code>## Warning in set.seed(1991, sample.kind = &quot;Rounding&quot;): non-uniform &#39;Rounding&#39; sampler used</code></pre>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb607-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb607-1" aria-hidden="true"></a><span class="kw">data</span>(<span class="st">&quot;tissue_gene_expression&quot;</span>)</span>
<span id="cb607-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb607-2" aria-hidden="true"></a>    </span>
<span id="cb607-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb607-3" aria-hidden="true"></a>fit &lt;-<span class="st"> </span><span class="kw">with</span>(tissue_gene_expression, </span>
<span id="cb607-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb607-4" aria-hidden="true"></a>                <span class="kw">train</span>(x, y, <span class="dt">method =</span> <span class="st">&quot;rpart&quot;</span>,</span>
<span id="cb607-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb607-5" aria-hidden="true"></a>                      <span class="dt">tuneGrid =</span> <span class="kw">data.frame</span>(<span class="dt">cp =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.01</span>))))</span>
<span id="cb607-6"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb607-6" aria-hidden="true"></a>    </span>
<span id="cb607-7"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb607-7" aria-hidden="true"></a><span class="kw">ggplot</span>(fit)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-161-1.png" width="672" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Note that there are only 6 placentas in the dataset. By default, <code>rpart</code> requires 20 observations before splitting a node. That means that it is difficult to have a node in which placentas are the majority. Rerun the analysis you did in Q1 with <code>caret::train()</code>, but this time with <code>method = "rpart"</code> and allow it to split any node by using the argument <code>control = rpart.control(minsplit = 0)</code>. Look at the confusion matrix again to determine whether the accuracy increases. Again, set the seed to 1991.</li>
</ol>
<p>What is the accuracy now?</p>
<div class="sourceCode" id="cb608"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb608-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb608-1" aria-hidden="true"></a><span class="co"># set.seed(1991) # if using R 3.5 or earlier</span></span>
<span id="cb608-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb608-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1991</span>, <span class="dt">sample.kind =</span> <span class="st">&quot;Rounding&quot;</span>) <span class="co"># if using R 3.6 or later</span></span></code></pre></div>
<pre><code>## Warning in set.seed(1991, sample.kind = &quot;Rounding&quot;): non-uniform &#39;Rounding&#39; sampler used</code></pre>
<div class="sourceCode" id="cb610"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb610-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb610-1" aria-hidden="true"></a>fit_rpart &lt;-<span class="st"> </span><span class="kw">with</span>(tissue_gene_expression, </span>
<span id="cb610-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb610-2" aria-hidden="true"></a>                      <span class="kw">train</span>(x, y, <span class="dt">method =</span> <span class="st">&quot;rpart&quot;</span>,</span>
<span id="cb610-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb610-3" aria-hidden="true"></a>                            <span class="dt">tuneGrid =</span> <span class="kw">data.frame</span>(<span class="dt">cp =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">0.10</span>, <span class="fl">0.01</span>)),</span>
<span id="cb610-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb610-4" aria-hidden="true"></a>                            <span class="dt">control =</span> <span class="kw">rpart.control</span>(<span class="dt">minsplit =</span> <span class="dv">0</span>)))</span>
<span id="cb610-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb610-5" aria-hidden="true"></a><span class="kw">ggplot</span>(fit_rpart)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-162-1.png" width="672" /></p>
<div class="sourceCode" id="cb611"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb611-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb611-1" aria-hidden="true"></a><span class="kw">confusionMatrix</span>(fit_rpart)</span></code></pre></div>
<pre><code>## Bootstrapped (25 reps) Confusion Matrix 
## 
## (entries are percentual average cell counts across resamples)
##  
##              Reference
## Prediction    cerebellum colon endometrium hippocampus kidney liver placenta
##   cerebellum        19.5   0.0         0.2         0.9    0.4   0.0      0.1
##   colon              0.3  16.5         0.1         0.0    0.1   0.0      0.1
##   endometrium        0.1   0.2         6.4         0.1    0.9   0.1      0.5
##   hippocampus        0.2   0.0         0.0        15.6    0.1   0.0      0.0
##   kidney             0.3   0.3         0.9         0.1   19.1   0.5      0.3
##   liver              0.0   0.0         0.3         0.0    0.3  12.6      0.2
##   placenta           0.1   0.1         0.5         0.0    0.6   0.1      1.8
##                             
##  Accuracy (average) : 0.9141</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Plot the tree from the best fitting model of the analysis you ran in Q2.</li>
</ol>
<p>Which gene is at the first split?</p>
<div class="sourceCode" id="cb613"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb613-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb613-1" aria-hidden="true"></a><span class="kw">plot</span>(fit_rpart<span class="op">$</span>finalModel)</span>
<span id="cb613-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb613-2" aria-hidden="true"></a><span class="kw">text</span>(fit_rpart<span class="op">$</span>finalModel)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-163-1.png" width="672" /></p>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. B3GNT4</li>
<li><input type="checkbox" disabled="" />
B. CAPN3</li>
<li><input type="checkbox" disabled="" />
C. CES2</li>
<li><input type="checkbox" disabled="" />
D. CFHR4</li>
<li><input type="checkbox" disabled="" />
E. CLIP3</li>
<li><input type="checkbox" disabled="" checked="" />
F. GPA33</li>
<li><input type="checkbox" disabled="" />
G. HRH1</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>We can see that with just seven genes, we are able to predict the tissue type. Now let’s see if we can predict the tissue type with even fewer genes using a Random Forest. Use the <code>train()</code> function and the <code>rf</code> method to train a Random Forest model and save it to an object called <code>fit</code>. Try out values of <code>mtry</code> ranging from <code>seq(50, 200, 25)</code> (you can also explore other values on your own). What <code>mtry</code> value maximizes accuracy? To permit small <code>nodesize</code> to grow as we did with the classification trees, use the following argument: <code>nodesize = 1</code>.</li>
</ol>
<p>Note: This exercise will take some time to run. If you want to test out your code first, try using smaller values with <code>ntree</code>. Set the seed to 1991 again.</p>
<p>What value of mtry maximizes accuracy? <code>100</code></p>
<div class="sourceCode" id="cb614"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb614-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb614-1" aria-hidden="true"></a><span class="co"># set.seed(1991) # if using R 3.5 or earlier</span></span>
<span id="cb614-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb614-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1991</span>, <span class="dt">sample.kind =</span> <span class="st">&quot;Rounding&quot;</span>) <span class="co"># if using R 3.6 or later</span></span></code></pre></div>
<pre><code>## Warning in set.seed(1991, sample.kind = &quot;Rounding&quot;): non-uniform &#39;Rounding&#39; sampler used</code></pre>
<div class="sourceCode" id="cb616"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb616-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb616-1" aria-hidden="true"></a><span class="kw">library</span>(randomForest)</span>
<span id="cb616-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb616-2" aria-hidden="true"></a>fit &lt;-<span class="st"> </span><span class="kw">with</span>(tissue_gene_expression, </span>
<span id="cb616-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb616-3" aria-hidden="true"></a>                <span class="kw">train</span>(x, y, <span class="dt">method =</span> <span class="st">&quot;rf&quot;</span>, </span>
<span id="cb616-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb616-4" aria-hidden="true"></a>                      <span class="dt">nodesize =</span> <span class="dv">1</span>,</span>
<span id="cb616-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb616-5" aria-hidden="true"></a>                      <span class="dt">tuneGrid =</span> <span class="kw">data.frame</span>(<span class="dt">mtry =</span> <span class="kw">seq</span>(<span class="dv">50</span>, <span class="dv">200</span>, <span class="dv">25</span>))))</span>
<span id="cb616-6"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb616-6" aria-hidden="true"></a>    </span>
<span id="cb616-7"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb616-7" aria-hidden="true"></a><span class="kw">ggplot</span>(fit)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-164-1.png" width="672" /></p>
<ol start="5" style="list-style-type: decimal">
<li>Use the function <code>varImp()</code> on the output of <code>train()</code> and save it to an object called <code>imp</code>:</li>
</ol>
<div class="sourceCode" id="cb617"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb617-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb617-1" aria-hidden="true"></a>imp &lt;-<span class="st"> </span><span class="co">#BLANK</span></span>
<span id="cb617-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb617-2" aria-hidden="true"></a>imp</span></code></pre></div>
<p>What should replace #BLANK in the code above?</p>
<div class="sourceCode" id="cb618"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb618-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb618-1" aria-hidden="true"></a>imp &lt;-<span class="st"> </span><span class="kw">varImp</span>(fit)</span>
<span id="cb618-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb618-2" aria-hidden="true"></a>imp</span></code></pre></div>
<pre><code>## rf variable importance
## 
##   only 20 most important variables shown (out of 500)
## 
##          Overall
## GPA33     100.00
## BIN1       64.65
## GPM6B      62.35
## KIF2C      62.15
## CLIP3      52.09
## COLGALT2   46.48
## CFHR4      35.03
## SHANK2     34.90
## TFR2       33.61
## GALNT11    30.70
## CEP55      30.49
## TCN2       27.96
## CAPN3      27.52
## CYP4F11    25.74
## GTF2IRD1   24.89
## KCTD2      24.34
## FCN3       22.68
## SUSD6      22.24
## DOCK4      22.02
## RARRES2    21.53</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>The <code>rpart()</code> model we ran above in Q2 produced a tree that used just seven predictors. Extracting the predictor names is not straightforward, but can be done. If the output of the call to train was <code>fit_rpart</code>, we can extract the names like this:
1/1 point (graded)</li>
</ol>
<div class="sourceCode" id="cb620"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb620-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb620-1" aria-hidden="true"></a>tree_terms &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">unique</span>(fit_rpart<span class="op">$</span>finalModel<span class="op">$</span>frame<span class="op">$</span>var[<span class="op">!</span>(fit_rpart<span class="op">$</span>finalModel<span class="op">$</span>frame<span class="op">$</span>var <span class="op">==</span><span class="st"> &quot;&lt;leaf&gt;&quot;</span>)]))</span>
<span id="cb620-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb620-2" aria-hidden="true"></a>tree_terms</span></code></pre></div>
<pre><code>## [1] &quot;GPA33&quot;  &quot;CLIP3&quot;  &quot;CAPN3&quot;  &quot;CFHR4&quot;  &quot;CES2&quot;   &quot;HRH1&quot;   &quot;B3GNT4&quot;</code></pre>
<p>Calculate the variable importance in the Random Forest call from Q4 for these seven predictors and examine where they rank.</p>
<p>What is the importance of the CFHR4 gene in the Random Forest call? <code>35.0</code></p>
<p>What is the rank of the CFHR4 gene in the Random Forest call? <code>7</code></p>
<div class="sourceCode" id="cb622"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb622-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb622-1" aria-hidden="true"></a><span class="kw">data_frame</span>(<span class="dt">term =</span> <span class="kw">rownames</span>(imp<span class="op">$</span>importance), </span>
<span id="cb622-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb622-2" aria-hidden="true"></a>       <span class="dt">importance =</span> imp<span class="op">$</span>importance<span class="op">$</span>Overall) <span class="op">%&gt;%</span></span>
<span id="cb622-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb622-3" aria-hidden="true"></a><span class="kw">mutate</span>(<span class="dt">rank =</span> <span class="kw">rank</span>(<span class="op">-</span>importance)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(importance)) <span class="op">%&gt;%</span></span>
<span id="cb622-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb622-4" aria-hidden="true"></a><span class="kw">filter</span>(term <span class="op">%in%</span><span class="st"> </span>tree_terms)</span></code></pre></div>
<pre><code>## # A tibble: 7 x 3
##   term   importance  rank
##   &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;
## 1 GPA33     100         1
## 2 CLIP3      52.1       5
## 3 CFHR4      35.0       7
## 4 CAPN3      27.5      13
## 5 CES2       20.0      22
## 6 HRH1        2.35     97
## 7 B3GNT4      0.136   343</code></pre>
</div>
<div id="titanic-exercises---part-1" class="section level2" number="6.9">
<h2><span class="header-section-number">6.9</span> Titanic Exercises - Part 1</h2>
<p>These exercises cover everything you have learned in this course so far. You will use the background information to provided to train a number of different types of models on this dataset.</p>
<p><strong>Background</strong></p>
<p>The Titanic was a British ocean liner that struck an iceberg and sunk on its maiden voyage in 1912 from the United Kingdom to New York. More than 1,500 of the estimated 2,224 passengers and crew died in the accident, making this one of the largest maritime disasters ever outside of war. The ship carried a wide range of passengers of all ages and both genders, from luxury travelers in first-class to immigrants in the lower classes. However, not all passengers were equally likely to survive the accident. You will use real data about a selection of 891 passengers to predict which passengers survived.</p>
<div class="sourceCode" id="cb624"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb624-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb624-1" aria-hidden="true"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw">require</span>(titanic)) <span class="kw">install.packages</span>(<span class="st">&quot;titanic&quot;</span>)</span></code></pre></div>
<pre><code>## Loading required package: titanic</code></pre>
<div class="sourceCode" id="cb626"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb626-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb626-1" aria-hidden="true"></a><span class="kw">library</span>(titanic)    <span class="co"># loads titanic_train data frame</span></span>
<span id="cb626-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb626-2" aria-hidden="true"></a></span>
<span id="cb626-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb626-3" aria-hidden="true"></a><span class="co"># 3 significant digits</span></span>
<span id="cb626-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb626-4" aria-hidden="true"></a><span class="kw">options</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</span>
<span id="cb626-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb626-5" aria-hidden="true"></a></span>
<span id="cb626-6"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb626-6" aria-hidden="true"></a><span class="co"># clean the data - `titanic_train` is loaded with the titanic package</span></span>
<span id="cb626-7"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb626-7" aria-hidden="true"></a>titanic_clean &lt;-<span class="st"> </span>titanic_train <span class="op">%&gt;%</span></span>
<span id="cb626-8"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb626-8" aria-hidden="true"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Survived =</span> <span class="kw">factor</span>(Survived),</span>
<span id="cb626-9"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb626-9" aria-hidden="true"></a>           <span class="dt">Embarked =</span> <span class="kw">factor</span>(Embarked),</span>
<span id="cb626-10"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb626-10" aria-hidden="true"></a>           <span class="dt">Age =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(Age), <span class="kw">median</span>(Age, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), Age), <span class="co"># NA age to median age</span></span>
<span id="cb626-11"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb626-11" aria-hidden="true"></a>           <span class="dt">FamilySize =</span> SibSp <span class="op">+</span><span class="st"> </span>Parch <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st">    </span><span class="co"># count family members</span></span>
<span id="cb626-12"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb626-12" aria-hidden="true"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">select</span>(Survived,  Sex, Pclass, Age, Fare, SibSp, Parch, FamilySize, Embarked)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Training and test sets</li>
</ol>
<p>Split <code>titanic_clean</code> into test and training sets - after running the setup code, it should have 891 rows and 9 variables.</p>
<p>Set the seed to 42, then use the <strong>caret</strong> package to create a 20% data partition based on the <code>Survived</code> column. Assign the 20% partition to <code>test_set</code> and the remaining 80% partition to <code>train_set</code>.</p>
<p>How many observations are in the training set?</p>
<div class="sourceCode" id="cb627"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb627-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb627-1" aria-hidden="true"></a><span class="co">#set.seed(42) # if using R 3.5 or earlier</span></span>
<span id="cb627-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb627-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">42</span>, <span class="dt">sample.kind =</span> <span class="st">&quot;Rounding&quot;</span>) <span class="co"># if using R 3.6 or later</span></span></code></pre></div>
<pre><code>## Warning in set.seed(42, sample.kind = &quot;Rounding&quot;): non-uniform &#39;Rounding&#39; sampler used</code></pre>
<div class="sourceCode" id="cb629"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb629-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb629-1" aria-hidden="true"></a>test_index &lt;-<span class="st"> </span><span class="kw">createDataPartition</span>(titanic_clean<span class="op">$</span>Survived, <span class="dt">times =</span> <span class="dv">1</span>, <span class="dt">p =</span> <span class="fl">0.2</span>, <span class="dt">list =</span> <span class="ot">FALSE</span>) <span class="co"># create a 20% test set</span></span>
<span id="cb629-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb629-2" aria-hidden="true"></a>test_set &lt;-<span class="st"> </span>titanic_clean[test_index,]</span>
<span id="cb629-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb629-3" aria-hidden="true"></a>train_set &lt;-<span class="st"> </span>titanic_clean[<span class="op">-</span>test_index,]</span>
<span id="cb629-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb629-4" aria-hidden="true"></a></span>
<span id="cb629-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb629-5" aria-hidden="true"></a><span class="kw">nrow</span>(train_set)</span></code></pre></div>
<pre><code>## [1] 712</code></pre>
<p>How many observations are in the test set?</p>
<div class="sourceCode" id="cb631"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb631-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb631-1" aria-hidden="true"></a><span class="kw">nrow</span>(test_set)</span></code></pre></div>
<pre><code>## [1] 179</code></pre>
<p>What proportion of individuals in the training set survived?</p>
<div class="sourceCode" id="cb633"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb633-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb633-1" aria-hidden="true"></a><span class="kw">mean</span>(train_set<span class="op">$</span>Survived <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 0.383</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Baseline prediction by guessing the outcome</li>
</ol>
<p>The simplest prediction method is randomly guessing the outcome without using additional predictors. These methods will help us determine whether our machine learning algorithm performs better than chance. How accurate are two methods of guessing Titanic passenger survival?</p>
<p>Set the seed to 3. For each individual in the test set, randomly guess whether that person survived or not by sampling from the vector <code>c(0,1)</code> (Note: use the default argument setting of prob from the <code>sample</code> function).</p>
<p>What is the accuracy of this guessing method?</p>
<div class="sourceCode" id="cb635"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb635-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb635-1" aria-hidden="true"></a><span class="co">#set.seed(3)</span></span>
<span id="cb635-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb635-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">3</span>, <span class="dt">sample.kind =</span> <span class="st">&quot;Rounding&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in set.seed(3, sample.kind = &quot;Rounding&quot;): non-uniform &#39;Rounding&#39; sampler used</code></pre>
<div class="sourceCode" id="cb637"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb637-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb637-1" aria-hidden="true"></a><span class="co"># guess with equal probability of survival</span></span>
<span id="cb637-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb637-2" aria-hidden="true"></a>guess &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="kw">nrow</span>(test_set), <span class="dt">replace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb637-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb637-3" aria-hidden="true"></a><span class="kw">mean</span>(guess <span class="op">==</span><span class="st"> </span>test_set<span class="op">$</span>Survived)</span></code></pre></div>
<pre><code>## [1] 0.475</code></pre>
<p>3a. Predicting survival by sex</p>
<p>Use the training set to determine whether members of a given sex were more likely to survive or die. Apply this insight to generate survival predictions on the test set.</p>
<p>What proportion of training set females survived?</p>
<div class="sourceCode" id="cb639"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb639-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb639-1" aria-hidden="true"></a>train_set <span class="op">%&gt;%</span></span>
<span id="cb639-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb639-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">group_by</span>(Sex) <span class="op">%&gt;%</span></span>
<span id="cb639-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb639-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">Survived =</span> <span class="kw">mean</span>(Survived <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)) <span class="op">%&gt;%</span></span>
<span id="cb639-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb639-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(Sex <span class="op">==</span><span class="st"> &quot;female&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb639-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb639-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">pull</span>(Survived)</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## [1] 0.731</code></pre>
<p>What proportion of training set males survived?</p>
<div class="sourceCode" id="cb642"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb642-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb642-1" aria-hidden="true"></a>train_set <span class="op">%&gt;%</span></span>
<span id="cb642-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb642-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">group_by</span>(Sex) <span class="op">%&gt;%</span></span>
<span id="cb642-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb642-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">Survived =</span> <span class="kw">mean</span>(Survived <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)) <span class="op">%&gt;%</span></span>
<span id="cb642-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb642-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(Sex <span class="op">==</span><span class="st"> &quot;male&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb642-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb642-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">pull</span>(Survived)</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## [1] 0.197</code></pre>
<p>3b. Predicting survival by sex</p>
<p>Predict survival using sex on the test set: if the survival rate for a sex is over 0.5, predict survival for all individuals of that sex, and predict death if the survival rate for a sex is under 0.5.</p>
<p>What is the accuracy of this sex-based prediction method on the test set?</p>
<div class="sourceCode" id="cb645"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb645-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb645-1" aria-hidden="true"></a>sex_model &lt;-<span class="st"> </span><span class="kw">ifelse</span>(test_set<span class="op">$</span>Sex <span class="op">==</span><span class="st"> &quot;female&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>)    <span class="co"># predict Survived=1 if female, 0 if male</span></span>
<span id="cb645-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb645-2" aria-hidden="true"></a><span class="kw">mean</span>(sex_model <span class="op">==</span><span class="st"> </span>test_set<span class="op">$</span>Survived)    <span class="co"># calculate accuracy</span></span></code></pre></div>
<pre><code>## [1] 0.821</code></pre>
<p>4a. Predicting survival by passenger class</p>
<p>In the training set, which class(es) (Pclass) were passengers more likely to survive than die?</p>
<div class="sourceCode" id="cb647"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb647-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb647-1" aria-hidden="true"></a>train_set <span class="op">%&gt;%</span></span>
<span id="cb647-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb647-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">group_by</span>(Pclass) <span class="op">%&gt;%</span></span>
<span id="cb647-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb647-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">Survived =</span> <span class="kw">mean</span>(Survived <span class="op">==</span><span class="st"> </span><span class="dv">1</span>))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 3 x 2
##   Pclass Survived
##    &lt;int&gt;    &lt;dbl&gt;
## 1      1    0.619
## 2      2    0.5  
## 3      3    0.242</code></pre>
<p>Select ALL that apply.</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A. 1</li>
<li><input type="checkbox" disabled="" />
B. 2</li>
<li><input type="checkbox" disabled="" />
C. 3</li>
</ul>
<p>4b. Predicting survival by passenger class</p>
<p>Predict survival using passenger class on the test set: predict survival if the survival rate for a class is over 0.5, otherwise predict death.</p>
<p>What is the accuracy of this class-based prediction method on the test set?</p>
<div class="sourceCode" id="cb650"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb650-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb650-1" aria-hidden="true"></a>class_model &lt;-<span class="st"> </span><span class="kw">ifelse</span>(test_set<span class="op">$</span>Pclass <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)    <span class="co"># predict survival only if first class</span></span>
<span id="cb650-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb650-2" aria-hidden="true"></a><span class="kw">mean</span>(class_model <span class="op">==</span><span class="st"> </span>test_set<span class="op">$</span>Survived)    <span class="co"># calculate accuracy</span></span></code></pre></div>
<pre><code>## [1] 0.704</code></pre>
<p>4c. Predicting survival by passenger class</p>
<p>Use the training set to group passengers by both sex and passenger class.</p>
<p>Which sex and class combinations were more likely to survive than die?</p>
<div class="sourceCode" id="cb652"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb652-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb652-1" aria-hidden="true"></a>train_set <span class="op">%&gt;%</span></span>
<span id="cb652-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb652-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">group_by</span>(Sex, Pclass) <span class="op">%&gt;%</span></span>
<span id="cb652-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb652-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">Survived =</span> <span class="kw">mean</span>(Survived <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)) <span class="op">%&gt;%</span></span>
<span id="cb652-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb652-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(Survived <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>## `summarise()` regrouping output by &#39;Sex&#39; (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 2 x 3
## # Groups:   Sex [1]
##   Sex    Pclass Survived
##   &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt;
## 1 female      1    0.957
## 2 female      2    0.919</code></pre>
<p>Select ALL that apply.</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A. female 1st class</li>
<li><input type="checkbox" disabled="" checked="" />
B. female 2nd class</li>
<li><input type="checkbox" disabled="" />
C. female 3rd class</li>
<li><input type="checkbox" disabled="" />
D. male 1st class</li>
<li><input type="checkbox" disabled="" />
E. male 2nd class</li>
<li><input type="checkbox" disabled="" />
F. male 3rd class</li>
</ul>
<p>4d. Predicting survival by passenger class</p>
<p>Predict survival using both sex and passenger class on the test set. Predict survival if the survival rate for a sex/class combination is over 0.5, otherwise predict death.</p>
<p>What is the accuracy of this sex- and class-based prediction method on the test set?</p>
<div class="sourceCode" id="cb655"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb655-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb655-1" aria-hidden="true"></a>sex_class_model &lt;-<span class="st"> </span><span class="kw">ifelse</span>(test_set<span class="op">$</span>Sex <span class="op">==</span><span class="st"> &quot;female&quot;</span> <span class="op">&amp;</span><span class="st"> </span>test_set<span class="op">$</span>Pclass <span class="op">!=</span><span class="st"> </span><span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb655-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb655-2" aria-hidden="true"></a><span class="kw">mean</span>(sex_class_model <span class="op">==</span><span class="st"> </span>test_set<span class="op">$</span>Survived)</span></code></pre></div>
<pre><code>## [1] 0.821</code></pre>
<p>5a. Confusion matrix</p>
<p>Use the <code>confusionMatrix()</code> function to create confusion matrices for the sex model, class model, and combined sex and class model. You will need to convert predictions and survival status to factors to use this function.</p>
<div class="sourceCode" id="cb657"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb657-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb657-1" aria-hidden="true"></a><span class="kw">confusionMatrix</span>(<span class="dt">data =</span> <span class="kw">factor</span>(sex_model), <span class="dt">reference =</span> <span class="kw">factor</span>(test_set<span class="op">$</span>Survived))</span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction  0  1
##          0 96 18
##          1 14 51
##                                         
##                Accuracy : 0.821         
##                  95% CI : (0.757, 0.874)
##     No Information Rate : 0.615         
##     P-Value [Acc &gt; NIR] : 1.72e-09      
##                                         
##                   Kappa : 0.619         
##                                         
##  Mcnemar&#39;s Test P-Value : 0.596         
##                                         
##             Sensitivity : 0.873         
##             Specificity : 0.739         
##          Pos Pred Value : 0.842         
##          Neg Pred Value : 0.785         
##              Prevalence : 0.615         
##          Detection Rate : 0.536         
##    Detection Prevalence : 0.637         
##       Balanced Accuracy : 0.806         
##                                         
##        &#39;Positive&#39; Class : 0             
## </code></pre>
<div class="sourceCode" id="cb659"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb659-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb659-1" aria-hidden="true"></a><span class="kw">confusionMatrix</span>(<span class="dt">data =</span> <span class="kw">factor</span>(class_model), <span class="dt">reference =</span> <span class="kw">factor</span>(test_set<span class="op">$</span>Survived))</span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction  0  1
##          0 94 37
##          1 16 32
##                                        
##                Accuracy : 0.704        
##                  95% CI : (0.631, 0.77)
##     No Information Rate : 0.615        
##     P-Value [Acc &gt; NIR] : 0.00788      
##                                        
##                   Kappa : 0.337        
##                                        
##  Mcnemar&#39;s Test P-Value : 0.00601      
##                                        
##             Sensitivity : 0.855        
##             Specificity : 0.464        
##          Pos Pred Value : 0.718        
##          Neg Pred Value : 0.667        
##              Prevalence : 0.615        
##          Detection Rate : 0.525        
##    Detection Prevalence : 0.732        
##       Balanced Accuracy : 0.659        
##                                        
##        &#39;Positive&#39; Class : 0            
## </code></pre>
<div class="sourceCode" id="cb661"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb661-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb661-1" aria-hidden="true"></a><span class="kw">confusionMatrix</span>(<span class="dt">data =</span> <span class="kw">factor</span>(sex_class_model), <span class="dt">reference =</span> <span class="kw">factor</span>(test_set<span class="op">$</span>Survived))</span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction   0   1
##          0 109  31
##          1   1  38
##                                         
##                Accuracy : 0.821         
##                  95% CI : (0.757, 0.874)
##     No Information Rate : 0.615         
##     P-Value [Acc &gt; NIR] : 1.72e-09      
##                                         
##                   Kappa : 0.589         
##                                         
##  Mcnemar&#39;s Test P-Value : 2.95e-07      
##                                         
##             Sensitivity : 0.991         
##             Specificity : 0.551         
##          Pos Pred Value : 0.779         
##          Neg Pred Value : 0.974         
##              Prevalence : 0.615         
##          Detection Rate : 0.609         
##    Detection Prevalence : 0.782         
##       Balanced Accuracy : 0.771         
##                                         
##        &#39;Positive&#39; Class : 0             
## </code></pre>
<p>What is the “positive” class used to calculate confusion matrix metrics?</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A. 0</li>
<li><input type="checkbox" disabled="" />
B. 1</li>
</ul>
<p>Which model has the highest sensitivity?</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. sex only</li>
<li><input type="checkbox" disabled="" />
B. class only</li>
<li><input type="checkbox" disabled="" checked="" />
C. sex and class combined</li>
</ul>
<p>Which model has the highest specificity?</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A. sex only</li>
<li><input type="checkbox" disabled="" />
B. class only</li>
<li><input type="checkbox" disabled="" />
C. sex and class combined</li>
</ul>
<p>Which model has the highest balanced accuracy?</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
A. sex only</li>
<li><input type="checkbox" disabled="" />
B. class only</li>
<li><input type="checkbox" disabled="" />
C. sex and class combined</li>
</ul>
<p>5b. Confusion matrix</p>
<p>What is the maximum value of balanced accuracy? <code>0.806</code></p>
<ol start="6" style="list-style-type: decimal">
<li>F1 scores</li>
</ol>
<p>Use the <code>F_meas()</code> function to calculate <span class="math inline">\(F_1\)</span> scores for the sex model, class model, and combined sex and class model. You will need to convert predictions to factors to use this function.</p>
<p>Which model has the highest <span class="math inline">\(F_1\)</span> score?</p>
<div class="sourceCode" id="cb663"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb663-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb663-1" aria-hidden="true"></a><span class="kw">F_meas</span>(<span class="dt">data =</span> <span class="kw">factor</span>(sex_model), <span class="dt">reference =</span> test_set<span class="op">$</span>Survived)</span></code></pre></div>
<pre><code>## [1] 0.857</code></pre>
<div class="sourceCode" id="cb665"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb665-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb665-1" aria-hidden="true"></a><span class="kw">F_meas</span>(<span class="dt">data =</span> <span class="kw">factor</span>(class_model), <span class="dt">reference =</span> test_set<span class="op">$</span>Survived)</span></code></pre></div>
<pre><code>## [1] 0.78</code></pre>
<div class="sourceCode" id="cb667"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb667-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb667-1" aria-hidden="true"></a><span class="kw">F_meas</span>(<span class="dt">data =</span> <span class="kw">factor</span>(sex_class_model), <span class="dt">reference =</span> test_set<span class="op">$</span>Survived)</span></code></pre></div>
<pre><code>## [1] 0.872</code></pre>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. sex only</li>
<li><input type="checkbox" disabled="" />
B. class only</li>
<li><input type="checkbox" disabled="" checked="" />
C. sex and class combined</li>
</ul>
<p>What is the maximum value of the <span class="math inline">\(F_1\)</span> score? <code>0.872</code></p>
</div>
<div id="titanic-exercises---part-2" class="section level2" number="6.10">
<h2><span class="header-section-number">6.10</span> Titanic Exercises - Part 2</h2>
<ol start="7" style="list-style-type: decimal">
<li>Survival by fare - LDA and QDA</li>
</ol>
<p>Set the seed to 1. Train a model using linear discriminant analysis (LDA) with the <strong>caret</strong> <code>lda</code> method using fare as the only predictor.</p>
<p>What is the accuracy on the test set for the LDA model?</p>
<div class="sourceCode" id="cb669"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb669-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb669-1" aria-hidden="true"></a><span class="co">#set.seed(1) # if using R 3.5 or earlier</span></span>
<span id="cb669-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb669-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>, <span class="dt">sample.kind =</span> <span class="st">&quot;Rounding&quot;</span>) <span class="co"># if using R 3.6 or later</span></span></code></pre></div>
<pre><code>## Warning in set.seed(1, sample.kind = &quot;Rounding&quot;): non-uniform &#39;Rounding&#39; sampler used</code></pre>
<div class="sourceCode" id="cb671"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb671-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb671-1" aria-hidden="true"></a>train_lda &lt;-<span class="st"> </span><span class="kw">train</span>(Survived <span class="op">~</span><span class="st"> </span>Fare, <span class="dt">method =</span> <span class="st">&quot;lda&quot;</span>, <span class="dt">data =</span> train_set)</span>
<span id="cb671-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb671-2" aria-hidden="true"></a>lda_preds &lt;-<span class="st"> </span><span class="kw">predict</span>(train_lda, test_set)</span>
<span id="cb671-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb671-3" aria-hidden="true"></a><span class="kw">mean</span>(lda_preds <span class="op">==</span><span class="st"> </span>test_set<span class="op">$</span>Survived)</span></code></pre></div>
<pre><code>## [1] 0.693</code></pre>
<p>Set the seed to 1. Train a model using quadratic discriminant analysis (QDA) with the <strong>caret</strong> <code>qda</code> method using fare as the only predictor.</p>
<p>What is the accuracy on the test set for the QDA model?</p>
<div class="sourceCode" id="cb673"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb673-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb673-1" aria-hidden="true"></a><span class="co">#set.seed(1) # if using R 3.5 or earlier</span></span>
<span id="cb673-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb673-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>, <span class="dt">sample.kind =</span> <span class="st">&quot;Rounding&quot;</span>) <span class="co"># if using R 3.6 or later</span></span></code></pre></div>
<pre><code>## Warning in set.seed(1, sample.kind = &quot;Rounding&quot;): non-uniform &#39;Rounding&#39; sampler used</code></pre>
<div class="sourceCode" id="cb675"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb675-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb675-1" aria-hidden="true"></a>train_qda &lt;-<span class="st"> </span><span class="kw">train</span>(Survived <span class="op">~</span><span class="st"> </span>Fare, <span class="dt">method =</span> <span class="st">&quot;qda&quot;</span>, <span class="dt">data =</span> train_set)</span>
<span id="cb675-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb675-2" aria-hidden="true"></a>qda_preds &lt;-<span class="st"> </span><span class="kw">predict</span>(train_qda, test_set)</span>
<span id="cb675-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb675-3" aria-hidden="true"></a><span class="kw">mean</span>(qda_preds <span class="op">==</span><span class="st"> </span>test_set<span class="op">$</span>Survived)</span></code></pre></div>
<pre><code>## [1] 0.693</code></pre>
<p>Note: when training models for Titanic Exercises Part 2, please use the S3 method for class formula rather than the default S3 method of <strong>caret</strong> <code>train()</code> (see <code>?caret::train</code> for details).</p>
<ol start="8" style="list-style-type: decimal">
<li>Logistic regression models</li>
</ol>
<p>Set the seed to 1. Train a logistic regression model with the <strong>caret</strong> <code>glm</code> method using age as the only predictor.</p>
<p>What is the accuracy of your model (using age as the only predictor) on the test set ?</p>
<div class="sourceCode" id="cb677"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb677-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb677-1" aria-hidden="true"></a><span class="co">#set.seed(1) # if using R 3.5 or earlier</span></span>
<span id="cb677-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb677-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>, <span class="dt">sample.kind =</span> <span class="st">&quot;Rounding&quot;</span>) <span class="co"># if using R 3.6 or later</span></span></code></pre></div>
<pre><code>## Warning in set.seed(1, sample.kind = &quot;Rounding&quot;): non-uniform &#39;Rounding&#39; sampler used</code></pre>
<div class="sourceCode" id="cb679"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb679-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb679-1" aria-hidden="true"></a>train_glm_age &lt;-<span class="st"> </span><span class="kw">train</span>(Survived <span class="op">~</span><span class="st"> </span>Age, <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>, <span class="dt">data =</span> train_set)</span>
<span id="cb679-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb679-2" aria-hidden="true"></a>glm_preds_age &lt;-<span class="st"> </span><span class="kw">predict</span>(train_glm_age, test_set)</span>
<span id="cb679-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb679-3" aria-hidden="true"></a><span class="kw">mean</span>(glm_preds_age <span class="op">==</span><span class="st"> </span>test_set<span class="op">$</span>Survived)</span></code></pre></div>
<pre><code>## [1] 0.615</code></pre>
<p>Set the seed to 1. Train a logistic regression model with the <strong>caret</strong> <code>glm</code> method using four predictors: sex, class, fare, and age.</p>
<p>What is the accuracy of your model (using these four predictors) on the test set?</p>
<div class="sourceCode" id="cb681"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb681-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb681-1" aria-hidden="true"></a><span class="co">#set.seed(1) # if using R 3.5 or earlier</span></span>
<span id="cb681-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb681-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>, <span class="dt">sample.kind =</span> <span class="st">&quot;Rounding&quot;</span>) <span class="co"># if using R 3.6 or later</span></span></code></pre></div>
<pre><code>## Warning in set.seed(1, sample.kind = &quot;Rounding&quot;): non-uniform &#39;Rounding&#39; sampler used</code></pre>
<div class="sourceCode" id="cb683"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb683-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb683-1" aria-hidden="true"></a>train_glm &lt;-<span class="st"> </span><span class="kw">train</span>(Survived <span class="op">~</span><span class="st"> </span>Sex <span class="op">+</span><span class="st"> </span>Pclass <span class="op">+</span><span class="st"> </span>Fare <span class="op">+</span><span class="st"> </span>Age, <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>, <span class="dt">data =</span> train_set)</span>
<span id="cb683-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb683-2" aria-hidden="true"></a>glm_preds &lt;-<span class="st"> </span><span class="kw">predict</span>(train_glm, test_set)</span>
<span id="cb683-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb683-3" aria-hidden="true"></a><span class="kw">mean</span>(glm_preds <span class="op">==</span><span class="st"> </span>test_set<span class="op">$</span>Survived)</span></code></pre></div>
<pre><code>## [1] 0.849</code></pre>
<p>Set the seed to 1. Train a logistic regression model with the <strong>caret</strong> <code>glm</code> method using all predictors. Ignore warnings about rank-deficient fit.</p>
<p>What is the accuracy of your model (using all predictors) on the test set?</p>
<div class="sourceCode" id="cb685"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb685-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb685-1" aria-hidden="true"></a><span class="co">#set.seed(1) # if using R 3.5 or earlier</span></span>
<span id="cb685-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb685-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>, <span class="dt">sample.kind =</span> <span class="st">&quot;Rounding&quot;</span>) <span class="co"># if using R 3.6 or later</span></span></code></pre></div>
<pre><code>## Warning in set.seed(1, sample.kind = &quot;Rounding&quot;): non-uniform &#39;Rounding&#39; sampler used</code></pre>
<div class="sourceCode" id="cb687"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb687-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb687-1" aria-hidden="true"></a>train_glm_all &lt;-<span class="st"> </span><span class="kw">train</span>(Survived <span class="op">~</span><span class="st"> </span>., <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>, <span class="dt">data =</span> train_set)</span></code></pre></div>
<pre><code>## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == : prediction from a rank-deficient fit may be misleading</code></pre>
<pre><code>## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == : prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == : prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == : prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == : prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == : prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == : prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == : prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == : prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == : prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == : prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == : prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == : prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == : prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == : prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == : prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == : prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == : prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == : prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == : prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == : prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == : prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == : prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == : prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == : prediction from a rank-deficient fit may be misleading</code></pre>
<div class="sourceCode" id="cb690"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb690-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb690-1" aria-hidden="true"></a>glm_all_preds &lt;-<span class="st"> </span><span class="kw">predict</span>(train_glm_all, test_set)</span></code></pre></div>
<pre><code>## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == : prediction from a rank-deficient fit may be misleading</code></pre>
<div class="sourceCode" id="cb692"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb692-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb692-1" aria-hidden="true"></a><span class="kw">mean</span>(glm_all_preds <span class="op">==</span><span class="st"> </span>test_set<span class="op">$</span>Survived)</span></code></pre></div>
<pre><code>## [1] 0.849</code></pre>
<p>9a. kNN model</p>
<p>Set the seed to 6. Train a kNN model on the training set using the <strong>caret</strong> <code>train</code> function. Try tuning with <code>k = seq(3, 51, 2)</code>.</p>
<p>What is the optimal value of the number of neighbors <code>k</code>?</p>
<div class="sourceCode" id="cb694"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb694-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb694-1" aria-hidden="true"></a><span class="co">#set.seed(6)</span></span>
<span id="cb694-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb694-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">6</span>, <span class="dt">sample.kind =</span> <span class="st">&quot;Rounding&quot;</span>) <span class="co"># if using R 3.6 or later</span></span></code></pre></div>
<pre><code>## Warning in set.seed(6, sample.kind = &quot;Rounding&quot;): non-uniform &#39;Rounding&#39; sampler used</code></pre>
<div class="sourceCode" id="cb696"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb696-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb696-1" aria-hidden="true"></a>train_knn &lt;-<span class="st"> </span><span class="kw">train</span>(Survived <span class="op">~</span><span class="st"> </span>.,</span>
<span id="cb696-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb696-2" aria-hidden="true"></a>                   <span class="dt">method =</span> <span class="st">&quot;knn&quot;</span>,</span>
<span id="cb696-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb696-3" aria-hidden="true"></a>                   <span class="dt">data =</span> train_set,</span>
<span id="cb696-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb696-4" aria-hidden="true"></a>                   <span class="dt">tuneGrid =</span> <span class="kw">data.frame</span>(<span class="dt">k =</span> <span class="kw">seq</span>(<span class="dv">3</span>, <span class="dv">51</span>, <span class="dv">2</span>)))</span>
<span id="cb696-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb696-5" aria-hidden="true"></a>train_knn<span class="op">$</span>bestTune</span></code></pre></div>
<pre><code>##    k
## 5 11</code></pre>
<p>9b. kNN model</p>
<p>Plot the kNN model to investigate the relationship between the number of neighbors and accuracy on the training set.</p>
<p>Of these values of <span class="math inline">\(k\)</span>, which yields the highest accuracy?</p>
<div class="sourceCode" id="cb698"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb698-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb698-1" aria-hidden="true"></a><span class="kw">ggplot</span>(train_knn)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-189-1.png" width="672" /></p>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. 7</li>
<li><input type="checkbox" disabled="" checked="" />
B. 11</li>
<li><input type="checkbox" disabled="" />
C. 17</li>
<li><input type="checkbox" disabled="" />
D. 21</li>
</ul>
<p>9c. kNN model</p>
<p>What is the accuracy of the kNN model on the test set?</p>
<div class="sourceCode" id="cb699"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb699-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb699-1" aria-hidden="true"></a>knn_preds &lt;-<span class="st"> </span><span class="kw">predict</span>(train_knn, test_set)</span>
<span id="cb699-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb699-2" aria-hidden="true"></a><span class="kw">mean</span>(knn_preds <span class="op">==</span><span class="st"> </span>test_set<span class="op">$</span>Survived)</span></code></pre></div>
<pre><code>## [1] 0.709</code></pre>
<ol start="10" style="list-style-type: decimal">
<li>Cross-validation</li>
</ol>
<p>Set the seed to 8 and train a new kNN model. Instead of the default training control, use 10-fold cross-validation where each partition consists of 10% of the total. Try tuning with <code>k = seq(3, 51, 2)</code>.</p>
<p>What is the optimal value of <code>k</code> using cross-validation?</p>
<div class="sourceCode" id="cb701"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb701-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb701-1" aria-hidden="true"></a><span class="co">#set.seed(8)</span></span>
<span id="cb701-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb701-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">8</span>, <span class="dt">sample.kind =</span> <span class="st">&quot;Rounding&quot;</span>)    <span class="co"># simulate R 3.5</span></span></code></pre></div>
<pre><code>## Warning in set.seed(8, sample.kind = &quot;Rounding&quot;): non-uniform &#39;Rounding&#39; sampler used</code></pre>
<div class="sourceCode" id="cb703"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb703-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb703-1" aria-hidden="true"></a>train_knn_cv &lt;-<span class="st"> </span><span class="kw">train</span>(Survived <span class="op">~</span><span class="st"> </span>.,</span>
<span id="cb703-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb703-2" aria-hidden="true"></a>                   <span class="dt">method =</span> <span class="st">&quot;knn&quot;</span>,</span>
<span id="cb703-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb703-3" aria-hidden="true"></a>                   <span class="dt">data =</span> train_set,</span>
<span id="cb703-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb703-4" aria-hidden="true"></a>                   <span class="dt">tuneGrid =</span> <span class="kw">data.frame</span>(<span class="dt">k =</span> <span class="kw">seq</span>(<span class="dv">3</span>, <span class="dv">51</span>, <span class="dv">2</span>)),</span>
<span id="cb703-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb703-5" aria-hidden="true"></a>                   <span class="dt">trControl =</span> <span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">10</span>, <span class="dt">p =</span> <span class="fl">0.9</span>))</span>
<span id="cb703-6"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb703-6" aria-hidden="true"></a>train_knn_cv<span class="op">$</span>bestTune</span></code></pre></div>
<pre><code>##   k
## 2 5</code></pre>
<p>What is the accuracy on the test set using the cross-validated kNN model?</p>
<div class="sourceCode" id="cb705"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb705-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb705-1" aria-hidden="true"></a>knn_cv_preds &lt;-<span class="st"> </span><span class="kw">predict</span>(train_knn_cv, test_set)</span>
<span id="cb705-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb705-2" aria-hidden="true"></a><span class="kw">mean</span>(knn_cv_preds <span class="op">==</span><span class="st"> </span>test_set<span class="op">$</span>Survived)</span></code></pre></div>
<pre><code>## [1] 0.648</code></pre>
<p>11a. Classification tree model</p>
<p>Set the seed to 10. Use <strong>caret</strong> to train a decision tree with the <code>rpart</code> method. Tune the complexity parameter with <code>cp = seq(0, 0.05, 0.002)</code>.</p>
<p>What is the optimal value of the complexity parameter (<code>cp</code>)?</p>
<div class="sourceCode" id="cb707"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb707-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb707-1" aria-hidden="true"></a><span class="co">#set.seed(10)</span></span>
<span id="cb707-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb707-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">10</span>, <span class="dt">sample.kind =</span> <span class="st">&quot;Rounding&quot;</span>)    <span class="co"># simulate R 3.5</span></span></code></pre></div>
<pre><code>## Warning in set.seed(10, sample.kind = &quot;Rounding&quot;): non-uniform &#39;Rounding&#39; sampler used</code></pre>
<div class="sourceCode" id="cb709"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb709-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb709-1" aria-hidden="true"></a>train_rpart &lt;-<span class="st"> </span><span class="kw">train</span>(Survived <span class="op">~</span><span class="st"> </span>., </span>
<span id="cb709-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb709-2" aria-hidden="true"></a>                     <span class="dt">method =</span> <span class="st">&quot;rpart&quot;</span>,</span>
<span id="cb709-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb709-3" aria-hidden="true"></a>                     <span class="dt">tuneGrid =</span> <span class="kw">data.frame</span>(<span class="dt">cp =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.002</span>)),</span>
<span id="cb709-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb709-4" aria-hidden="true"></a>                     <span class="dt">data =</span> train_set)</span>
<span id="cb709-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb709-5" aria-hidden="true"></a>train_rpart<span class="op">$</span>bestTune</span></code></pre></div>
<pre><code>##      cp
## 9 0.016</code></pre>
<p>What is the accuracy of the decision tree model on the test set?</p>
<div class="sourceCode" id="cb711"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb711-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb711-1" aria-hidden="true"></a>rpart_preds &lt;-<span class="st"> </span><span class="kw">predict</span>(train_rpart, test_set)</span>
<span id="cb711-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb711-2" aria-hidden="true"></a><span class="kw">mean</span>(rpart_preds <span class="op">==</span><span class="st"> </span>test_set<span class="op">$</span>Survived)</span></code></pre></div>
<pre><code>## [1] 0.838</code></pre>
<p>11b. Classification tree model</p>
<p>Inspect the final model and plot the decision tree.</p>
<div class="sourceCode" id="cb713"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb713-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb713-1" aria-hidden="true"></a>train_rpart<span class="op">$</span>finalModel <span class="co"># inspect final model</span></span></code></pre></div>
<pre><code>## n= 712 
## 
## node), split, n, loss, yval, (yprob)
##       * denotes terminal node
## 
##  1) root 712 273 0 (0.6166 0.3834)  
##    2) Sexmale&gt;=0.5 463  91 0 (0.8035 0.1965)  
##      4) Age&gt;=3.5 449  80 0 (0.8218 0.1782) *
##      5) Age&lt; 3.5 14   3 1 (0.2143 0.7857) *
##    3) Sexmale&lt; 0.5 249  67 1 (0.2691 0.7309)  
##      6) Pclass&gt;=2.5 118  59 0 (0.5000 0.5000)  
##       12) Fare&gt;=23.4 24   3 0 (0.8750 0.1250) *
##       13) Fare&lt; 23.4 94  38 1 (0.4043 0.5957) *
##      7) Pclass&lt; 2.5 131   8 1 (0.0611 0.9389) *</code></pre>
<div class="sourceCode" id="cb715"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb715-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb715-1" aria-hidden="true"></a><span class="co"># make plot of decision tree</span></span>
<span id="cb715-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb715-2" aria-hidden="true"></a><span class="kw">plot</span>(train_rpart<span class="op">$</span>finalModel, <span class="dt">margin =</span> <span class="fl">0.1</span>)</span>
<span id="cb715-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb715-3" aria-hidden="true"></a><span class="kw">text</span>(train_rpart<span class="op">$</span>finalModel)</span></code></pre></div>
<p><img src="img/figures/unnamed-chunk-195-1.png" width="672" /></p>
<p>Which variables are used in the decision tree?</p>
<p>Select ALL that apply.</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" />
A. Survived</li>
<li><input type="checkbox" disabled="" checked="" />
B. Sex</li>
<li><input type="checkbox" disabled="" checked="" />
C. Pclass</li>
<li><input type="checkbox" disabled="" checked="" />
D. Age</li>
<li><input type="checkbox" disabled="" checked="" />
E. Fare</li>
<li><input type="checkbox" disabled="" />
F. Parch</li>
<li><input type="checkbox" disabled="" />
G. Embarked</li>
</ul>
<p>11c. Classification tree model</p>
<p>Using the decision rules generated by the final model, predict whether the following individuals would survive.</p>
<ul>
<li>A 28-year-old male <code>would NOT survive</code></li>
<li>A female in the second passenger class <code>would survive</code></li>
<li>A third-class female who paid a fare of $8 <code>would survive</code></li>
<li>A 5-year-old male with 4 siblings <code>would NOT survive</code></li>
<li>A third-class female who paid a fare of $25 <code>would NOT survive</code></li>
<li>A first-class 17-year-old female with 2 siblings <code>would survive</code></li>
<li>A first-class 17-year-old male with 2 siblings <code>would NOT survive</code></li>
</ul>
<ol start="12" style="list-style-type: decimal">
<li>Random forest model</li>
</ol>
<p>Set the seed to 14. Use the <strong>caret</strong> <code>train()</code> function with the <code>rf</code> method to train a random forest. Test values of <code>mtry = seq(1:7)</code>. Set <code>ntree</code> to 100.</p>
<p>What <code>mtry</code> value maximizes accuracy?</p>
<div class="sourceCode" id="cb716"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb716-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb716-1" aria-hidden="true"></a><span class="co">#set.seed(14)</span></span>
<span id="cb716-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb716-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">14</span>, <span class="dt">sample.kind =</span> <span class="st">&quot;Rounding&quot;</span>)    <span class="co"># simulate R 3.5</span></span></code></pre></div>
<pre><code>## Warning in set.seed(14, sample.kind = &quot;Rounding&quot;): non-uniform &#39;Rounding&#39; sampler used</code></pre>
<div class="sourceCode" id="cb718"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb718-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb718-1" aria-hidden="true"></a>train_rf &lt;-<span class="st"> </span><span class="kw">train</span>(Survived <span class="op">~</span><span class="st"> </span>.,</span>
<span id="cb718-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb718-2" aria-hidden="true"></a>                  <span class="dt">data =</span> train_set,</span>
<span id="cb718-3"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb718-3" aria-hidden="true"></a>                  <span class="dt">method =</span> <span class="st">&quot;rf&quot;</span>,</span>
<span id="cb718-4"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb718-4" aria-hidden="true"></a>                  <span class="dt">ntree =</span> <span class="dv">100</span>,</span>
<span id="cb718-5"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb718-5" aria-hidden="true"></a>                  <span class="dt">tuneGrid =</span> <span class="kw">data.frame</span>(<span class="dt">mtry =</span> <span class="kw">seq</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>)))</span>
<span id="cb718-6"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb718-6" aria-hidden="true"></a>train_rf<span class="op">$</span>bestTune</span></code></pre></div>
<pre><code>##   mtry
## 2    2</code></pre>
<p>What is the accuracy of the random forest model on the test set?</p>
<div class="sourceCode" id="cb720"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb720-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb720-1" aria-hidden="true"></a>rf_preds &lt;-<span class="st"> </span><span class="kw">predict</span>(train_rf, test_set)</span>
<span id="cb720-2"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb720-2" aria-hidden="true"></a><span class="kw">mean</span>(rf_preds <span class="op">==</span><span class="st"> </span>test_set<span class="op">$</span>Survived)</span></code></pre></div>
<pre><code>## [1] 0.844</code></pre>
<p>Use <code>varImp()</code> on the random forest model object to determine the importance of various predictors to the random forest model.</p>
<p>What is the most important variable?</p>
<div class="sourceCode" id="cb722"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb722-1"><a href="section-5-classification-with-more-than-two-classes-and-the-caret-package.html#cb722-1" aria-hidden="true"></a><span class="kw">varImp</span>(train_rf)    <span class="co"># first row</span></span></code></pre></div>
<pre><code>## rf variable importance
## 
##            Overall
## Sexmale    100.000
## Fare        65.091
## Age         45.533
## Pclass      32.529
## FamilySize  18.275
## SibSp        7.881
## Parch        7.150
## EmbarkedS    2.839
## EmbarkedQ    0.122
## EmbarkedC    0.000</code></pre>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="section-4-distance-knn-cross-validation-and-generative-models.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="section-6-model-fitting-and-recommendation-systems-overview.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
